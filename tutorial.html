<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 3. Tutorial</title>
<link rel="stylesheet" href="mvl.css" type="text/css" />
<meta name="generator" content="DocBook XSL Stylesheets V1.69.1 + chunker.py v1.9.1" />
<link rel="start" href="index.html" title="{book-title}" />
<link rel="up" href="" title="" />
<link rel="prev" href="installing.html" title="Chapter 2. Installing and Upgrading MySQL" />
<link rel="next" href="programs.html" title="Chapter 4. MySQL Programs" />
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1378437679*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
       // 'This copy of the manual is more than 90 days old. We encourage you to download a ' +
       // 'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
	     '这份手册是90天前的版本,我们强烈建议你你去这里下载一个最新版本<a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">第 3 章. 教程</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="installing.html">上一章</a> </td>
<th width="60%" align="center"></th>
<td width="20%" align="right"> <a accesskey="n" href="programs.html">下一章</a></td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="tutorial"></a>第 3 章. 教程</h1>

</div>

</div>

</div>
<div class="toc">
<p><b>内容列表</b></p>
<dl>
  <dt><span class="section"><a href="tutorial.html#connecting-disconnecting">3.1. 连接和断开服务器</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#entering-queries">3.2. 输入查询</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#database-use">3.3. 创建并使用数据库</a></span></dt><dd><dl><dt><span class="section"><a href="tutorial.html#creating-database">3.3.1. 创建和选中该数据库</a></span></dt><dt><span class="section"><a href="tutorial.html#creating-tables">3.3.2. 创建表</a></span></dt><dt><span class="section"><a href="tutorial.html#loading-tables">3.3.3. 将数据装入表</a></span></dt><dt><span class="section"><a href="tutorial.html#retrieving-data">3.3.4. 从表中检索信息</a></span></dt></dl></dd><dt><span class="section"><a href="tutorial.html#getting-information">3.4. 获取数据库和表的信</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#batch-mode">3.5. 在批处理模式下使用<span class="command"><strong>mysql</strong></span></a></span></dt>
  <dt><span class="section"><a href="tutorial.html#examples">3.6. 常见查询示例</a></span></dt>
  <dd><dl>
    <dt><span class="section"><a href="tutorial.html#example-maximum-column">3.6.1. 列的最大值</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#example-maximum-row">3.6.2. 拥有某个列的最大值的行</a></span></dt><dt><span class="section"><a href="tutorial.html#example-maximum-column-group">3.6.3. 列的分组最大值</a></span></dt><dt><span class="section"><a href="tutorial.html#example-maximum-column-group-row">3.6.4. 拥有某列的分组最大值的行</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#example-user-variables">3.6.5. 使用用户变量</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#example-foreign-keys">3.6.6. 使用外键</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#searching-on-two-keys">3.6.7. 根据2个键来查询</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#calculating-days">3.6.8. 计算每天的访问量</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#example-auto-increment">3.6.9. 使用 <code class="literal">AUTO_INCREMENT</code></a></span></dt>
  </dl></dd><dt><span class="section"><a href="tutorial.html#apache">3.7. 和Apache一起使用MySQL</a></span></dt></dl>
</div>
<a class="indexterm" name="idp6840832"></a><a class="indexterm" name="idp6841904"></a><a class="indexterm" name="idp6843392"></a><a class="indexterm" name="idp6844880"></a>
<p>
    本章通过一个使用 <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 客户端程序来创建并使用示例数据库的教程来介绍MySQL。 <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> (我们通常会叫做<span class="quote">“<span class="quote">终端监视器</span>”</span>,或者就直接叫做
    <span class="quote">“<span class="quote">监视器</span>”</span>) 可以作为一个交互式程序,它能够连接到MySQL服务器,执行查询,查看结果集。
    <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 也可以使用批处理模式来执行预先准备好的SQL脚本文件。这两种使用<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 的方式在这章里都会提及。  </p>
<p>
    调用--help选项可以查看<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>提供的所有选项列表</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --help</code></strong>
</pre>
<p>
    本章假定 <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 客户端程序已经被安装在你的电脑上, 并且也有一个MySQL服务器可供连接使用。否则,请联系你的MySQL管理员(如果你是管理员,你需要查阅相关手册, 
    <a class="xref" href="server-administration.html" title="Chapter 5. MySQL Server Administration">第 5 章 5, <i>MySQL服务器管理</i></a>.)  </p>
<p>
  本周描述了建立和使用一个数据库的全过程。如果你只对访问已有的数据库感兴趣,你可以跳过描述建立数据库和表的章节。</p>
<p>
    由于本章只是个教程,省略了很多细节内容,你可以通过查阅手册来获取相关主题的详细内容。</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="connecting-disconnecting"></a>3.1. 连接和断开服务器</h2>
</div>
</div>
</div>
<a class="indexterm" name="idp6860560"></a><a class="indexterm" name="idp6862048"></a><a class="indexterm" name="idp6863536"></a><a class="indexterm" name="idp6865024"></a>
<p>
      当调用 <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>来连接服务器，你需要提供一个MySQL用户名，很可能还需要一个密码；如果MySQL服务器端没有安装在你登录的机器上,你还需要知道MySQL服务器的主机名。联系你的管理员来得到连接服务器的相关选项(包括：主机名，用户名，密码等)。当你知道这些正确的选项后，你将以下面方式来连接MySQL服务器：
    </p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -h <em class="replaceable"><code>host</code></em> -u <em class="replaceable"><code>user</code></em> -p</code></strong>
Enter password: <strong class="userinput"><code>********</code></strong>
</pre>
<p>
      <code class="literal">host</code>和<code class="literal">user</code> 分别代表你的要连接的MySQL服务器主机名和MySQL用户名，将它们替换成正确的设置值。  <code class="literal">********</code> 代表你的密码，在<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 客户端显示<code class="literal">&quot;Enter
      password:&quot;</code>提示符时候输入。.    </p>
<p>
      如果输入正确，你将会看到 <code class="literal">&quot;mysql&gt;&quot;</code> 提示符后的一些介绍信息</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -h <em class="replaceable"><code>host</code></em> -u <em class="replaceable"><code>user</code></em> -p</code></strong>
Enter password: <strong class="userinput"><code>********</code></strong>
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 25338 to server version: 5.6.15-standard

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt;
</pre>
<p><code class="literal">"mysql&gt;"</code>提示符告诉你<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>已经准备好了,等待你的命令输入。  </p>
<p>
      如果你登录本机运行的MySQL服务器，你可以省略主机名, 连接命令如下:</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u <em class="replaceable"><code>user</code></em> -p</code></strong>
</pre>
<p>
      当你尝试登录MySQL时, 你得到了以下错误信息：y<span class="errortext">ERROR 2002 (HY000): Can't connect to local MySQL server
      through socket '/tmp/mysql.sock' (2)</span>, 这意味着MySQL服务器守护进程(Unix平台)没有在运行或者MySQL服务(Windows平台)没有启动。联系管理员或者根据你的操作系统来查阅相关章节
      <a class="xref" href="installing.html" title="Chapter 2. Installing and Upgrading MySQL">(第 2 章 <i>安装和升级MySQlL</i></a>   </p>
<p>
      当你遇到其它的登录问题后,你可以查阅章节<a class="xref" href="error-handling.html#common-errors" title="C.5.2. Common Errors When Using MySQL Programs">(Section C.5.2, “使用MySQL程序的常见错误”)</a>来解决。</p>
<p>
    一些MySQL安装允许匿名(未命名)用户在本机登录MySQL服务器。如果是这样,你调用<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>无需其它任何选项就可以连接MySQL服务器：</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql</code></strong>
</pre>
    <p>
      在你连接成功后，你可以在 <code class="literal">&quot;mysql&gt;&quot;</code>提示符下输入<code class="literal">QUIT</code> (或<code class="literal">\q</code>)来断开连接</p>
    <pre class="programlisting">mysql&gt; <strong class="userinput"><code>QUIT</code></strong>
Bye
</pre>
    <p>
    在Unix平台上，你也可以使用Control+D来断开MySQL连接。</p>
    <p>
      下面章节的大多数例子都假定你已经连接上MySQL服务器了，由<code class="literal">"mysql&gt;""</code> 提示符来标明。
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="entering-queries"></a>3.2. 输入查询</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp6896992"></a><a class="indexterm" name="idp6898480"></a><a class="indexterm" name="idp6899968"></a>
<p>
      正如先前章节所说的，确保你已经连接上了MySQL服务器，连接上数服务器并不会选中某个数据库,本章内容仅连接就足够使用了。知道如何发起查询比马上学习创建表，给表装载数据，表中检索数据等知识更重要。本章节描述了输入命令的基本原则，通过尝试一些查询可以让你熟悉了解<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>是如何工作的。   </p>
<p>
      这是个询问MySQL服务器来告诉你它的版本号和当前日期的简单命令。在<code class="literal">mysql&gt;</code>提示符下输入以下命令并敲下回车：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT VERSION(), CURRENT_DATE;</code></strong>
+--------------+--------------+
| VERSION()    | CURRENT_DATE |
+--------------+--------------+
| 5.6.1-m4-log | 2010-08-06   |
+--------------+--------------+
1 row in set (0.01 sec)
mysql&gt;
</pre>
    <p>
      这个查询说明了<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>一些特点：
      
</p>
    <div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
          一个命令通常包含着一条分号结尾的SQL语句。(有些语句例外不需要分号，例如刚才说的<code class="literal">QUIT</code>语句，后面我们还会遇到其它这样的语句)        </p>
</li><li class="listitem"><p>用户发出一个命令后，<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>把命令发送到服务器去执行并返回结果集,然后打印出一个新的<code class="literal">"mysql&gt;"</code>提示符来表明它又准备好接受其它命令。
        </p></li><li class="listitem">
          <p>
          <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>用表格(行和列)来输出查询结果。第一行显示每列的标签，剩下行就是查询结果。通常列标签是数取自数据库表中的字段名。如果你检索的是表达式而非表字段(就和上面例子一样)，<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>就用表达式自身来标识列。</p>
        </li><li class="listitem">
          <p>
          <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a> 会显示查询返回行数和查询执行时间，它提供了服务器的性能的一个大致概念。这个值是不精确的，因为它表示的是时钟时间,而非CPU或者机器时间，他手诸如系统负载和网络延迟的影响。(为了简洁起见,本章的其他例子我们可能会不显示返回行数)</p>
        </li></ul>
</div>
<p>
    关键字不区分大小写，下面的查询等效：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT VERSION(), CURRENT_DATE;</code></strong>
mysql&gt; <strong class="userinput"><code>select version(), current_date;</code></strong>
mysql&gt; <strong class="userinput"><code>SeLeCt vErSiOn(), current_DATE;</code></strong>
</pre>
<p>
      下面是另外一类的查询，它演示了<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>可以作为简单的计算器来使用   </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT SIN(PI()/4), (4+1)*5;</code></strong>
+------------------+---------+
| SIN(PI()/4)      | (4+1)*5 |
+------------------+---------+
| 0.70710678118655 |      25 |
+------------------+---------+
1 row in set (0.02 sec)
</pre>
<p>
    到目前为止，都是非常短的单行查询语句。你可以在一行中输入多条语句，只需在每个语句后面以;来分隔</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT VERSION(); SELECT NOW();</code></strong>
+--------------+
| VERSION()    |
+--------------+
| 5.6.1-m4-log |
+--------------+
1 row in set (0.00 sec)
+---------------------+
| NOW()               |
+---------------------+
| 2010-08-06 12:17:13 |
+---------------------+
1 row in set (0.00 sec)
</pre>
<p>
      一个命令不必全部输入在一行里，较长的命令可以输入在多行里。<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a> 会根据语句中的&quot;;&quot;来判断语句是否结束，而不是根据一行的结尾来判断。(换句话说<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>接受任意格式的输入：它会暂存输入的行而不直到遇到&quot;;&quot;才会执行暂存的语句)    </p>
<p>
    这是个简单的多行语句： </p>
    <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT</code></strong>
    -&gt; <strong class="userinput"><code>USER()</code></strong>
    -&gt; <strong class="userinput"><code>,</code></strong>
    -&gt; <strong class="userinput"><code>CURRENT_DATE;</code></strong>
+---------------+--------------+
| USER()        | CURRENT_DATE |
+---------------+--------------+
| jon@localhost | 2010-08-06   |
+---------------+--------------+
</pre>
    <p>
      在上面的例子中，注意到当你输入多行查询语句的第一行后， <code class="literal">mysql&gt;</code>提示符变成了<code class="literal">-&gt;</code>。
    这就是<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>语句还没有输完,它在等待接下来的输入。提示符是个很好的朋友，因为它提供了有价值的反馈。如果你接受了它的反馈，你就会懂得<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>在等待什么。</p>
    <p>
      如果你决定不执行正在输入的命令，输入<code class="literal">\c</code>就可以取消它：
    </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT</code></strong>
    -&gt; <strong class="userinput"><code>USER()</code></strong>
    -&gt; <strong class="userinput"><code>\c</code></strong>
mysql&gt;
</pre>
<p>
      这里你可以看到,当输入<code class="literal">\c</code>后，提示符变回为 <code class="literal">mysql&gt;</code> ，它告诉我们t <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>已经准备好来接收新的命令。</p>
<p>
      下面表格列出了每个你可能会看到的提示符，并简述了这些提示符在<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>中锁代表的含义
</p>
<a class="indexterm" name="idp6944880"></a>
<div class="informaltable">
<table summary="This table lists MySQL prompts and describes the meaning
        of each." border="1"><colgroup><col><col></colgroup><thead><tr>
  <th scope="col">提示符</th>
  <th scope="col">含义</th>
</tr></thead><tbody><tr><td scope="row"><code class="literal">mysql&gt;</code></td>
<td>准备好接收新命令。</td>
</tr><tr><td scope="row"><code class="literal">-&gt;</code></td>
<td>等待多行命令的下一行内容。</td>
</tr><tr><td scope="row"><code class="literal">'&gt;</code></td>
<td>等待下一行，等待以单引号(<span class="quote">“<code class="literal">'</code>”</span>)开始的字符串的结束。</td>
</tr><tr><td scope="row"><code class="literal">"&gt;</code></td>
<td>等待下一行，等待以双引号(<span class="quote">“<code class="literal">&quot;</code>”</span>)开始的字符串的结束。</td>
</tr><tr><td scope="row"><code class="literal">`&gt;</code></td>
<td>等待下一行，等待反斜点(<span class="quote">“<code class="literal">`</code>”</span>)开始的标识符的结束。</td>
</tr><tr><td scope="row"><code class="literal">/*&gt;</code></td>
<td>等待下一行，等待 <code class="literal">/*</code>开始的注释的结束。</td>
</tr></tbody></table>
</div>
<p>
      你打算在一个单行里面输入一个命令时，偶尔会忘记输入;来结束语句，这时意外的变成多行语句。这种情况下， <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>
      会继续等待下一步输入：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER()</code></strong>
    -&gt;
</pre>
<p>
      如果出现这种情况(你认为你已经输完了语句，但它只返回一个<code class="literal">-&gt;</code> prompt)提示符)，很可能是 <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>在等待";"。如果你没有注意到提示符所代表的意思，你将呆坐在那里直到你意识到这个。然后输入&quot;;&quot;来结束语句，<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>来执行它： </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER()</code></strong>
    -&gt; <strong class="userinput"><code>;</code></strong>
+---------------+
| USER()        |
+---------------+
| jon@localhost |
+---------------+
</pre>
<p><code class="literal">'&gt;</code> 和 <code class="literal">"&gt;</code> 提示符只出现在字符串收集过程中(提示MySQL在等待字符串的结束)。在MySQL中， <span class="quote">“<code class="literal">'</code>”</span>或者<span class="quote">“<code class="literal">&quot;</code>”字符都可以用作字符串限定符</span> (比如：
      <code class="literal">'hello'</code>和<code class="literal">"goodbye"</code>)，
      <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>允许跨越多行的字符串。当看到  <code class="literal">'&gt;</code>或者
      <code class="literal">"&gt;</code> 提示符时， 它表明已经输入以<span class="quote">“<code class="literal">'</code>”</span>或<span class="quote">“<code class="literal">&quot;</code>”字符</span>开头的一行字符串了，但还没有输入终止字符串的匹配引号。下面是一个由于粗心大意而忘记输入引号的例子：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM my_table WHERE name = 'Smith AND age &lt; 30;</code></strong>
    '&gt;
</pre>
<p>假如你输入了s <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>语句，然后敲下回车键来等待结果，然而什么结果都没有出现，除了出现了<code class="literal">'&gt;</code> 提示符。它告诉你<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a> 还在等待余下的未结束的字符串内容。(有没看到语句哪里错了，是字符串<code class="literal">'Smith</code>缺失了另外一个单引号') </p>
<p>
      遇到这种情况，你该怎么做？最简单的方式就是取消这个命令。但你不能直接输入<code class="literal">\c</code>，因为<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>还在等待字符串的结束。正确的方法是先输入引号(<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>认为字符串已经结束了),然后再输入<code class="literal">\c</code>：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM my_table WHERE name = 'Smith AND age &lt; 30;</code></strong>
    '&gt; <strong class="userinput"><code>'\c</code></strong>
mysql&gt;
</pre>
<p>
      提示符变回<code class="literal">mysql&gt;</code>,
      表明<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>已经准备好接收新命令。</p>
<p><code class="literal">`&gt;</code> 提示符和<code class="literal">'&gt;</code>、<code class="literal">"&gt;</code> 提示符类似, 它你已经开始但没有结束以`&gt; 开始的识别符。</p>
<p>知道<code class="literal">'&gt;</code>,
      <code class="literal">"&gt;</code>, 和 <code class="literal">`&gt;</code> 提示符是非常重要的，因为当你错误输入了一个未终止的字符，任何后面你输入的行都将被<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>忽略,即使你输入<code class="literal">QUIT</code>也会被忽略。这个可能比较让人困惑，可能在你想取消当前命令前还不知道要输入输入终止引号 。 </p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="database-use"></a>3.3. 创建并使用数据库</h2>

</div>

</div>

</div>
<div class="toc">
<dl>
  <dt><span class="section"><a href="tutorial.html#creating-database">3.3.1. 创建和选择该数据库</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#creating-tables">3.3.2. 创建表</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#loading-tables">3.3.3. 将数据装入表</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#retrieving-data">3.3.4. 从表中检索信息</a></span></dt>
</dl>
</div>
<a class="indexterm" name="idp7004144"></a><a class="indexterm" name="idp7005632"></a><a class="indexterm" name="idp7007120"></a>
<p>
    当你知道了如何输入命令，便可以访问数据库了。</p>
<p>
      假设你家里有一些宠物(你家是个&quot;动物园&quot;)，并且你想跟踪它们的各种信息，你可以创建一些表来记录你得数据并根据你的需要来载入它们。接着你可以从表中检索数据来回答动物不同种类的问题。本章显示如何完成以下操作。  (your menagerie)</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
          创建一个数据库
        </p>
</li><li class="listitem">
  <p>
          创建一个表</p>
</li><li class="listitem">
  <p>
          装载数据到表中</p>
</li><li class="listitem">
  <p>
          用多种方法从表中检索数据。</p>
</li><li class="listitem">
          <p>
          使用多个表</p>
        </li></ul>
</div>
<p>
      动物园数据库非常简单(特意的)，但这个简单数据库不难想象成为现实生活场景 。例如，一个农夫可以使用这样的数据库来追踪家畜，或者一个兽医来追踪病畜记录＋ or by a
      veterinarian to keep track of patient records. 从MySQL网站上可以获取到后面章节用到的包含一些样例查询和数据的动物园分发版示例数据库。在<a class="ulink" href="http://dev.mysql.com/doc/" target="_top">http://dev.mysql.com/doc/</a>网站有压缩tar包和zip两种格式的分发版可以下载</p>
<p>使用<a class="link" href="sql-syntax.html#show" title="13.7.5. SHOW Syntax"><code class="literal">SHOW</code></a> 命令可以罗列服务器上存在哪些数据库： </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW DATABASES;</code></strong>
+----------+
| Database |
+----------+
| mysql    |
| test     |
| tmp      |
+----------+
</pre>
<p><code class="literal">mysql</code>数据库码数了用户的访问权限。<code class="literal">test</code>数据库一般是用户的测试场所。
    </p>
<p>
      你机器上的显示的数据库列表可能与什么结果不相同；如果你没有<a class="link" href="sql-syntax.html#show-databases" title="13.7.5.15. SHOW DATABASES Syntax"><code class="literal">SHOW DATABASES</code></a>权限,使用<a class="link" href="sql-syntax.html#show-databases" title="13.7.5.15. SHOW DATABASES Syntax"><code class="literal">SHOW DATABASES</code></a>也无法显示出数据库列表，详情参见 <a class="xref" href="sql-syntax.html#show-databases" title="13.7.5.15. SHOW DATABASES Syntax">13.7.5.15 节, “<code class="literal">SHOW DATABASES</code>语法”</a>.    </p>
<p>如果存在<code class="literal">test</code>数据库，尝试去访问它：    </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>USE test</code></strong>
Database changed
</pre>
<p>
      <a class="link" href="sql-syntax.html#use" title="13.8.4. USE Syntax"><code class="literal">USE</code></a>和<code class="literal">QUIT</code>类似，并不需要分号。(如果你喜欢，你可以使用分号来结束这样的语句，这是无害的) 
      <a class="link" href="sql-syntax.html#use" title="13.8.4. USE Syntax"><code class="literal">USE</code></a> 语句使用上也是特殊的:必须写在一行语句内。</p>
<p>
      你可以在后面的例子中使用<code class="literal">test</code>数据库(只要你能访问)，但是你在test数据库常见的任何对象多可以被其他可以访问test数据库的人删除掉。所以，你最好向你的MySQL管理员允许你使用自己的数据库。
      Su假使你想调用<code class="literal">menagerie</code>数据库。
      MySQL管理得执行以下语句来授权：    </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>GRANT ALL ON menagerie.* TO 'your_mysql_name'@'your_client_host';</code></strong>
</pre>
<p><code class="literal">your_mysql_name</code> 就是你的MySQL登录帐户，i<code class="literal">your_client_host</code> 就是你用来登录服务器的主机。</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="creating-database"></a>3.3.1. 创建并使用数据库</h3>
</div>
</div>
</div>
<a class="indexterm" name="idp7036320"></a><a class="indexterm" name="idp7037808"></a>
<p>
      如果管理员在设置你的权限时候给你创建了数据库，你可以直接使用它，否则你得自己创建一个：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE DATABASE menagerie;</code></strong>
</pre>
<p>
        在Unix平台下，数据库名称是区分大小写的(和SQL关键字不同)，所以你必须使用<code class="literal">menagerie</code>来访问你的数据库，而不同用诸如
        <code class="literal">Menagerie</code>，<code class="literal">MENAGERIE</code>，或者其它名字。这个对表名也一样。(在Windows平台，这个限制不存在，尽管在一个查询里必须以同样的大小写来引用数据库和表。但是,由于种种原因，最好还是使用和建立数据库一样的大小写)</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">注意</div>
<p xmlns="">
          如果你在建库时遇到诸如<span class="errortext">ERROR 1044 (42000):
          Access denied for user 'monty'@'localhost' to database
          'menagerie'</span>的错误，这意味着你的帐户没有这个操作的权限，你可以联系管理员或者参见 <a class="xref" href="security.html#privilege-system" title="6.2. The MySQL Access Privilege System">6.2, “MySQL访问权限系统”</a>。</p>
</div>
<p>
      创建数据库后并没有选择使用它，你必须明确操作，使<code class="literal">menagerie</code>成为当前数据库必须使用以下命</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>USE menagerie</code></strong>
Database changed
</pre>
<p>
        你的数据库只需要创建一次，但是你必须每次开始<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>会话时选择使用它。你可以根据上面的例子使用<a class="link" href="sql-syntax.html#use" title="13.8.4. USE Syntax"><code class="literal">USE</code></a>语句来实现。或者你可以在调用<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>时候，通过命令行来选择数据库， 只需要在提供的连接参数后面指定数据库名就可以了。例如：</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -h <em class="replaceable"><code>host</code></em> -u <em class="replaceable"><code>user</code></em> -p menagerie</code></strong>
Enter password: <strong class="userinput"><code>********</code></strong>
</pre>
<div xmlns="http://www.w3.org/1999/xhtml" class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
重要提示
</div>
<p xmlns="">
          <code class="literal">menagerie</code>在刚才显示的命令行里不是你的密码，如果你想在<code class="literal">-p</code>属性后面提供你的密码，你必须保证后面无空格(例如这样<code class="literal">-pmypassword</code>,，而不是<code class="literal">-p
          mypassword</code>)。 但是，不建议在命令行里输入密码，因为这样容易被系统其他的登陆用户窥探到。</p>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">注意</div>
<p xmlns="">
          你可以使用<a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
          <a class="link" href="functions.html#function_database"><code class="literal">DATABASE()</code></a>.语句来查看当前你在用哪个数据库</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="creating-tables"></a>3.3.2. 创建一个表</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7063600"></a><a class="indexterm" name="idp7065088"></a>
<p>
        创建数据库很简单， <a class="link" href="sql-syntax.html#show-tables" title="13.7.5.38. SHOW TABLES Syntax"><code class="literal">SHOW TABLES</code></a> 可以看出数据库目前是空的：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
Empty set (0.00 sec)
</pre>
<p>
        比较难的是如何设计决定数据库的结构：你需要那些表，每个表需要哪些字段。      </p>
<p>
        你需要一个包含着所有宠物数据的表。它可以称为<code class="literal">pet</code><code class="literal"></code>表，它至少包含着每个动物的名字。因为这些动物的名字不是我们最感兴趣的信息，所以这个表还需要包含其它信息。比如你的家庭中超过一个人饲养着宠物，你可能需要罗列每个宠物的主人。你很可能需要记录其它的基本描述信息，例如它们的种类和性别。</p>
<p>
        年龄呢?这可能很有趣，但是它存储到数据库中不是个好主意。年龄会随着时间流逝而改变，这意味着你得经常更新你的记录。而保存一个固定值例如出生日期是个较好的方式。当你需要年龄时，你可以通过计算它的出生日期和当前日期的差额来计算它。MySQL提供了一些函数用于日期的计算，因此计算年龄并不复杂。保存出生日期还有其它好处：</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
            你可以使用这个数据库来实现生成宠物的生日提醒。(可能你觉得这类查询有点傻，但这个和从商务数据库中找出下月或者下周生日的客户来发送祝福是同一类型的问题，都属于计算机辅助个人联系功能)          </p>
</li><li class="listitem">
  <p>
            你可以根据相关日期而不是当前日期来计算年龄。例如，你可以保存死亡日期到数据库里，然后很容易计算出宠物们去世时候的年龄。</p>
</li></ul>
</div>
<p>
      你可以想到pet表中其它类型的有用信息，但以下内容足够使用了，如名字，主人，种类，性别，生日和死亡日期。</p>
<p>
      Use  <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> 语句详细说明了你的表的布局：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE pet (name VARCHAR(20), owner VARCHAR(20),</code></strong>
    -&gt; <strong class="userinput"><code>species VARCHAR(20), sex CHAR(1), birth DATE, death DATE);</code></strong>
</pre>
<p>
        <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>很适合用于<code class="literal">name</code>，<code class="literal">owner</code>，和
        <code class="literal">species</code>这些字段，因为这些字段值长度都不确定。这些字段长度需要定义成一样，也不需要都定义成 <code class="literal">20</code>。你可以选择<code class="literal">1</code>到<code class="literal">65535</code>之间任一长度，选择一个最合理的值。如果你选择的值不合适，后来需要更长的字段， MySQL提供了 <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> 语句来修改字段长度。</p>
<p>
        Several types of values can be chosen to represent sex in animal
        records, such as <code class="literal">'m'</code> and
        <code class="literal">'f'</code>, or perhaps <code class="literal">'male'</code> and
        <code class="literal">'female'</code>. It is simplest to use the single
        characters <code class="literal">'m'</code> and <code class="literal">'f'</code>.
      </p><p>
        The use of the <a class="link" href="data-types.html#datetime" title="11.3.1. The DATE, DATETIME, and TIMESTAMP Types"><code class="literal">DATE</code></a> data type for
        the <code class="literal">birth</code> and <code class="literal">death</code>
        columns is a fairly obvious choice.
      </p><p>
        Once you have created a table, <a class="link" href="sql-syntax.html#show-tables" title="13.7.5.38. SHOW TABLES Syntax"><code class="literal">SHOW
        TABLES</code></a> should produce some output:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
+---------------------+
| Tables in menagerie |
+---------------------+
| pet                 |
+---------------------+
</pre><p>
        To verify that your table was created the way you expected, use
        a <a class="link" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a> statement:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>DESCRIBE pet;</code></strong>
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| name    | varchar(20) | YES  |     | NULL    |       |
| owner   | varchar(20) | YES  |     | NULL    |       |
| species | varchar(20) | YES  |     | NULL    |       |
| sex     | char(1)     | YES  |     | NULL    |       |
| birth   | date        | YES  |     | NULL    |       |
| death   | date        | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+
</pre><p>
        You can use <a class="link" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a> any time,
        for example, if you forget the names of the columns in your
        table or what types they have.
      </p><p>
        For more information about MySQL data types, see
        <a class="xref" href="data-types.html" title="Chapter 11. Data Types">Chapter 11, <i>Data Types</i></a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="loading-tables"></a>3.3.3. 将数据装入表</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7104176"></a><a class="indexterm" name="idp7105664"></a><a class="indexterm" name="idp7107152"></a><p>
        After creating your table, you need to populate it. The
        <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA</code></a> and
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements are useful for
        this.
      </p><p>
        Suppose that your pet records can be described as shown here.
        (Observe that MySQL expects dates in
        <code class="literal">'YYYY-MM-DD'</code> format; this may be different
        from what you are used to.)
</p>
<div class="informaltable">
<table summary="This table illustrates the example of pet
records mentioned in the preceding text." border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">name</th><th scope="col">owner</th><th scope="col">species</th><th scope="col">sex</th><th scope="col">birth</th><th scope="col">death</th></tr></thead><tbody><tr><td scope="row">Fluffy</td><td>Harold</td><td>cat</td><td>f</td><td>1993-02-04</td><td> </td></tr><tr><td scope="row">Claws</td><td>Gwen</td><td>cat</td><td>m</td><td>1994-03-17</td><td> </td></tr><tr><td scope="row">Buffy</td><td>Harold</td><td>dog</td><td>f</td><td>1989-05-13</td><td> </td></tr><tr><td scope="row">Fang</td><td>Benny</td><td>dog</td><td>m</td><td>1990-08-27</td><td> </td></tr><tr><td scope="row">Bowser</td><td>Diane</td><td>dog</td><td>m</td><td>1979-08-31</td><td>1995-07-29</td></tr><tr><td scope="row">Chirpy</td><td>Gwen</td><td>bird</td><td>f</td><td>1998-09-11</td><td> </td></tr><tr><td scope="row">Whistler</td><td>Gwen</td><td>bird</td><td> </td><td>1997-12-09</td><td> </td></tr><tr><td scope="row">Slim</td><td>Benny</td><td>snake</td><td>m</td><td>1996-04-29</td><td> </td></tr></tbody></table>
</div>
<p>
        Because you are beginning with an empty table, an easy way to
        populate it is to create a text file containing a row for each
        of your animals, then load the contents of the file into the
        table with a single statement.
      </p><p>
        You could create a text file <code class="filename">pet.txt</code>
        containing one record per line, with values separated by tabs,
        and given in the order in which the columns were listed in the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. For
        missing values (such as unknown sexes or death dates for animals
        that are still living), you can use <code class="literal">NULL</code>
        values. To represent these in your text file, use
        <code class="literal">\N</code> (backslash, capital-N). For example, the
        record for Whistler the bird would look like this (where the
        whitespace between values is a single tab character):
      </p><pre class="programlisting">Whistler        Gwen    bird    \N      1997-12-09      \N</pre><p>
        To load the text file <code class="filename">pet.txt</code> into the
        <code class="literal">pet</code> table, use this statement:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>LOAD DATA LOCAL INFILE '/path/pet.txt' INTO TABLE pet;</code></strong>
</pre><p>
        If you created the file on Windows with an editor that uses
        <code class="literal">\r\n</code> as a line terminator, you should use
        this statement instead:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>LOAD DATA LOCAL INFILE '/path/pet.txt' INTO TABLE pet</code></strong>
    -&gt; <strong class="userinput"><code>LINES TERMINATED BY '\r\n';</code></strong>
</pre><p>
        (On an Apple machine running OS X, you would likely want to use
        <code class="literal">LINES TERMINATED BY '\r'</code>.)
      </p><p>
        You can specify the column value separator and end of line
        marker explicitly in the <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD
        DATA</code></a> statement if you wish, but the defaults are tab
        and linefeed. These are sufficient for the statement to read the
        file <code class="filename">pet.txt</code> properly.
      </p><p>
        If the statement fails, it is likely that your MySQL
        installation does not have local file capability enabled by
        default. See <a class="xref" href="security.html#load-data-local" title="6.1.6. Security Issues with LOAD DATA LOCAL">Section 6.1.6, “Security Issues with <code class="literal">LOAD
      DATA LOCAL</code>”</a>, for information
        on how to change this.
      </p><p>
        When you want to add new records one at a time, the
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement is useful. In
        its simplest form, you supply values for each column, in the
        order in which the columns were listed in the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. Suppose
        that Diane gets a new hamster named <span class="quote">“<span class="quote">Puffball.</span>”</span> You
        could add a new record using an
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement like this:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>INSERT INTO pet</code></strong>
    -&gt; <strong class="userinput"><code>VALUES ('Puffball','Diane','hamster','f','1999-03-30',NULL);</code></strong>
</pre><p>
        String and date values are specified as quoted strings here.
        Also, with <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>, you can insert
        <code class="literal">NULL</code> directly to represent a missing value.
        You do not use <code class="literal">\N</code> like you do with
        <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA</code></a>.
      </p><p>
        From this example, you should be able to see that there would be
        a lot more typing involved to load your records initially using
        several <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements rather
        than a single <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA</code></a>
        statement.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="retrieving-data"></a>3.3.4. Retrieving Information from a Table</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="tutorial.html#selecting-all">3.3.4.1. Selecting All Data</a></span></dt><dt><span class="section"><a href="tutorial.html#selecting-rows">3.3.4.2. Selecting Particular Rows</a></span></dt><dt><span class="section"><a href="tutorial.html#selecting-columns">3.3.4.3. Selecting Particular Columns</a></span></dt><dt><span class="section"><a href="tutorial.html#sorting-rows">3.3.4.4. Sorting Rows</a></span></dt><dt><span class="section"><a href="tutorial.html#date-calculations">3.3.4.5. Date Calculations</a></span></dt><dt><span class="section"><a href="tutorial.html#working-with-null">3.3.4.6. Working with <code class="literal">NULL</code> Values</a></span></dt><dt><span class="section"><a href="tutorial.html#pattern-matching">3.3.4.7. Pattern Matching</a></span></dt><dt><span class="section"><a href="tutorial.html#counting-rows">3.3.4.8. Counting Rows</a></span></dt><dt><span class="section"><a href="tutorial.html#multiple-tables">3.3.4.9. Using More Than one Table</a></span></dt></dl>
</div>
<a class="indexterm" name="idp7171872"></a><a class="indexterm" name="idp7173360"></a><a class="indexterm" name="idp7174848"></a><a class="indexterm" name="idp7176336"></a><p>
        The <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement is used to
        pull information from a table. The general form of the statement
        is:
      </p><pre class="programlisting">SELECT <em class="replaceable"><code>what_to_select</code></em>
FROM <em class="replaceable"><code>which_table</code></em>
WHERE <em class="replaceable"><code>conditions_to_satisfy</code></em>;
</pre><p>
        <em class="replaceable"><code>what_to_select</code></em> indicates what you
        want to see. This can be a list of columns, or
        <code class="literal">*</code> to indicate <span class="quote">“<span class="quote">all columns.</span>”</span>
        <em class="replaceable"><code>which_table</code></em> indicates the table from
        which you want to retrieve data. The <code class="literal">WHERE</code>
        clause is optional. If it is present,
        <em class="replaceable"><code>conditions_to_satisfy</code></em> specifies one
        or more conditions that rows must satisfy to qualify for
        retrieval.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="selecting-all"></a>3.3.4.1. Selecting All Data</h4>
</div>
</div>
</div>
<p>
          The simplest form of <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
          retrieves everything from a table:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet;</code></strong>
+----------+--------+---------+------+------------+------------+
| name     | owner  | species | sex  | birth      | death      |
+----------+--------+---------+------+------------+------------+
| Fluffy   | Harold | cat     | f    | 1993-02-04 | NULL       |
| Claws    | Gwen   | cat     | m    | 1994-03-17 | NULL       |
| Buffy    | Harold | dog     | f    | 1989-05-13 | NULL       |
| Fang     | Benny  | dog     | m    | 1990-08-27 | NULL       |
| Bowser   | Diane  | dog     | m    | 1979-08-31 | 1995-07-29 |
| Chirpy   | Gwen   | bird    | f    | 1998-09-11 | NULL       |
| Whistler | Gwen   | bird    | NULL | 1997-12-09 | NULL       |
| Slim     | Benny  | snake   | m    | 1996-04-29 | NULL       |
| Puffball | Diane  | hamster | f    | 1999-03-30 | NULL       |
+----------+--------+---------+------+------------+------------+
</pre><p>
          This form of <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> is useful
          if you want to review your entire table, for example, after
          you've just loaded it with your initial data set. For example,
          you may happen to think that the birth date for Bowser doesn't
          seem quite right. Consulting your original pedigree papers,
          you find that the correct birth year should be 1989, not 1979.
        </p><p>
          There are at least two ways to fix this:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Edit the file <code class="filename">pet.txt</code> to correct the
              error, then empty the table and reload it using
              <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> and
              <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA</code></a>:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>DELETE FROM pet;</code></strong>
mysql&gt; <strong class="userinput"><code>LOAD DATA LOCAL INFILE 'pet.txt' INTO TABLE pet;</code></strong>
</pre><p>
              However, if you do this, you must also re-enter the record
              for Puffball.
            </p></li><li class="listitem"><p>
              Fix only the erroneous record with an
              <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> statement:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>UPDATE pet SET birth = '1989-08-31' WHERE name = 'Bowser';</code></strong>
</pre><p>
              The <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> changes only the
              record in question and does not require you to reload the
              table.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="selecting-rows"></a>3.3.4.2. Selecting Particular Rows</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7203568"></a><a class="indexterm" name="idp7205056"></a><p>
          As shown in the preceding section, it is easy to retrieve an
          entire table. Just omit the <code class="literal">WHERE</code> clause
          from the <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement. But
          typically you don't want to see the entire table, particularly
          when it becomes large. Instead, you're usually more interested
          in answering a particular question, in which case you specify
          some constraints on the information you want. Let's look at
          some selection queries in terms of questions about your pets
          that they answer.
        </p><p>
          You can select only particular rows from your table. For
          example, if you want to verify the change that you made to
          Bowser's birth date, select Bowser's record like this:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name = 'Bowser';</code></strong>
+--------+-------+---------+------+------------+------------+
| name   | owner | species | sex  | birth      | death      |
+--------+-------+---------+------+------------+------------+
| Bowser | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+-------+---------+------+------------+------------+
</pre><p>
          The output confirms that the year is correctly recorded as
          1989, not 1979.
        </p><p>
          String comparisons normally are case-insensitive, so you can
          specify the name as <code class="literal">'bowser'</code>,
          <code class="literal">'BOWSER'</code>, and so forth. The query result is
          the same.
        </p><p>
          You can specify conditions on any column, not just
          <code class="literal">name</code>. For example, if you want to know
          which animals were born during or after 1998, test the
          <code class="literal">birth</code> column:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE birth &gt;= '1998-1-1';</code></strong>
+----------+-------+---------+------+------------+-------+
| name     | owner | species | sex  | birth      | death |
+----------+-------+---------+------+------------+-------+
| Chirpy   | Gwen  | bird    | f    | 1998-09-11 | NULL  |
| Puffball | Diane | hamster | f    | 1999-03-30 | NULL  |
+----------+-------+---------+------+------------+-------+
</pre><p>
          You can combine conditions, for example, to locate female
          dogs:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE species = 'dog' AND sex = 'f';</code></strong>
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</pre><p>
          The preceding query uses the <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
          logical operator. There is also an
          <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a> operator:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE species = 'snake' OR species = 'bird';</code></strong>
+----------+-------+---------+------+------------+-------+
| name     | owner | species | sex  | birth      | death |
+----------+-------+---------+------+------------+-------+
| Chirpy   | Gwen  | bird    | f    | 1998-09-11 | NULL  |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL  |
| Slim     | Benny | snake   | m    | 1996-04-29 | NULL  |
+----------+-------+---------+------+------------+-------+
</pre><p>
          <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a> and
          <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a> may be intermixed, although
          <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a> has higher precedence than
          <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>. If you use both operators, it
          is a good idea to use parentheses to indicate explicitly how
          conditions should be grouped:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE (species = 'cat' AND sex = 'm')</code></strong>
    -&gt; <strong class="userinput"><code>OR (species = 'dog' AND sex = 'f');</code></strong>
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="selecting-columns"></a>3.3.4.3. Selecting Particular Columns</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7231264"></a><a class="indexterm" name="idp7232752"></a><p>
          If you do not want to see entire rows from your table, just
          name the columns in which you are interested, separated by
          commas. For example, if you want to know when your animals
          were born, select the <code class="literal">name</code> and
          <code class="literal">birth</code> columns:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet;</code></strong>
+----------+------------+
| name     | birth      |
+----------+------------+
| Fluffy   | 1993-02-04 |
| Claws    | 1994-03-17 |
| Buffy    | 1989-05-13 |
| Fang     | 1990-08-27 |
| Bowser   | 1989-08-31 |
| Chirpy   | 1998-09-11 |
| Whistler | 1997-12-09 |
| Slim     | 1996-04-29 |
| Puffball | 1999-03-30 |
+----------+------------+
</pre><p>
          To find out who owns pets, use this query:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT owner FROM pet;</code></strong>
+--------+
| owner  |
+--------+
| Harold |
| Gwen   |
| Harold |
| Benny  |
| Diane  |
| Gwen   |
| Gwen   |
| Benny  |
| Diane  |
+--------+
</pre><a class="indexterm" name="idp7240064"></a><p>
          Notice that the query simply retrieves the
          <code class="literal">owner</code> column from each record, and some of
          them appear more than once. To minimize the output, retrieve
          each unique output record just once by adding the keyword
          <code class="literal">DISTINCT</code>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT DISTINCT owner FROM pet;</code></strong>
+--------+
| owner  |
+--------+
| Benny  |
| Diane  |
| Gwen   |
| Harold |
+--------+
</pre><p>
          You can use a <code class="literal">WHERE</code> clause to combine row
          selection with column selection. For example, to get birth
          dates for dogs and cats only, use this query:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, species, birth FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>WHERE species = 'dog' OR species = 'cat';</code></strong>
+--------+---------+------------+
| name   | species | birth      |
+--------+---------+------------+
| Fluffy | cat     | 1993-02-04 |
| Claws  | cat     | 1994-03-17 |
| Buffy  | dog     | 1989-05-13 |
| Fang   | dog     | 1990-08-27 |
| Bowser | dog     | 1989-08-31 |
+--------+---------+------------+
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sorting-rows"></a>3.3.4.4. Sorting Rows</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7249552"></a><a class="indexterm" name="idp7250624"></a><a class="indexterm" name="idp7252112"></a><a class="indexterm" name="idp7253600"></a><a class="indexterm" name="idp7255088"></a><p>
          You may have noticed in the preceding examples that the result
          rows are displayed in no particular order. It is often easier
          to examine query output when the rows are sorted in some
          meaningful way. To sort a result, use an <code class="literal">ORDER
          BY</code> clause.
        </p><p>
          Here are animal birthdays, sorted by date:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet ORDER BY birth;</code></strong>
+----------+------------+
| name     | birth      |
+----------+------------+
| Buffy    | 1989-05-13 |
| Bowser   | 1989-08-31 |
| Fang     | 1990-08-27 |
| Fluffy   | 1993-02-04 |
| Claws    | 1994-03-17 |
| Slim     | 1996-04-29 |
| Whistler | 1997-12-09 |
| Chirpy   | 1998-09-11 |
| Puffball | 1999-03-30 |
+----------+------------+
</pre><p>
          On character type columns, sorting—like all other
          comparison operations—is normally performed in a
          case-insensitive fashion. This means that the order is
          undefined for columns that are identical except for their
          case. You can force a case-sensitive sort for a column by
          using <a class="link" href="functions.html#operator_binary"><code class="literal">BINARY</code></a> like so:
          <code class="literal">ORDER BY BINARY
          <em class="replaceable"><code>col_name</code></em></code>.
        </p><p>
          The default sort order is ascending, with smallest values
          first. To sort in reverse (descending) order, add the
          <code class="literal">DESC</code> keyword to the name of the column you
          are sorting by:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet ORDER BY birth DESC;</code></strong>
+----------+------------+
| name     | birth      |
+----------+------------+
| Puffball | 1999-03-30 |
| Chirpy   | 1998-09-11 |
| Whistler | 1997-12-09 |
| Slim     | 1996-04-29 |
| Claws    | 1994-03-17 |
| Fluffy   | 1993-02-04 |
| Fang     | 1990-08-27 |
| Bowser   | 1989-08-31 |
| Buffy    | 1989-05-13 |
+----------+------------+
</pre><p>
          You can sort on multiple columns, and you can sort different
          columns in different directions. For example, to sort by type
          of animal in ascending order, then by birth date within animal
          type in descending order (youngest animals first), use the
          following query:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, species, birth FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>ORDER BY species, birth DESC;</code></strong>
+----------+---------+------------+
| name     | species | birth      |
+----------+---------+------------+
| Chirpy   | bird    | 1998-09-11 |
| Whistler | bird    | 1997-12-09 |
| Claws    | cat     | 1994-03-17 |
| Fluffy   | cat     | 1993-02-04 |
| Fang     | dog     | 1990-08-27 |
| Bowser   | dog     | 1989-08-31 |
| Buffy    | dog     | 1989-05-13 |
| Puffball | hamster | 1999-03-30 |
| Slim     | snake   | 1996-04-29 |
+----------+---------+------------+
</pre><p>
          The <code class="literal">DESC</code> keyword applies only to the column
          name immediately preceding it (<code class="literal">birth</code>); it
          does not affect the <code class="literal">species</code> column sort
          order.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="date-calculations"></a>3.3.4.5. Date Calculations</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7273312"></a><a class="indexterm" name="idp7274384"></a><a class="indexterm" name="idp7275872"></a><a class="indexterm" name="idp7277360"></a><p>
          MySQL provides several functions that you can use to perform
          calculations on dates, for example, to calculate ages or
          extract parts of dates.
        </p><p>
          To determine how many years old each of your pets is, use the
          <a class="link" href="functions.html#function_timestampdiff"><code class="literal">TIMESTAMPDIFF()</code></a> function. Its
          arguments are the unit in which you want the result expressed,
          and the two date for which to take the difference. The
          following query shows, for each pet, the birth date, the
          current date, and the age in years. An
          <span class="emphasis"><em>alias</em></span> (<code class="literal">age</code>) is used to
          make the final output column label more meaningful.
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth, CURDATE(),</code></strong>
    -&gt; <strong class="userinput"><code>TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet;</code></strong>
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
+----------+------------+------------+------+
</pre><p>
          The query works, but the result could be scanned more easily
          if the rows were presented in some order. This can be done by
          adding an <code class="literal">ORDER BY name</code> clause to sort the
          output by name:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth, CURDATE(),</code></strong>
    -&gt; <strong class="userinput"><code>TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet ORDER BY name;</code></strong>
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
+----------+------------+------------+------+
</pre><p>
          To sort the output by <code class="literal">age</code> rather than
          <code class="literal">name</code>, just use a different <code class="literal">ORDER
          BY</code> clause:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth, CURDATE(),</code></strong>
    -&gt; <strong class="userinput"><code>TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet ORDER BY age;</code></strong>
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
+----------+------------+------------+------+
</pre><p>
          A similar query can be used to determine age at death for
          animals that have died. You determine which animals these are
          by checking whether the <code class="literal">death</code> value is
          <code class="literal">NULL</code>. Then, for those with
          non-<code class="literal">NULL</code> values, compute the difference
          between the <code class="literal">death</code> and
          <code class="literal">birth</code> values:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth, death,</code></strong>
    -&gt; <strong class="userinput"><code>TIMESTAMPDIFF(YEAR,birth,death) AS age</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet WHERE death IS NOT NULL ORDER BY age;</code></strong>
+--------+------------+------------+------+
| name   | birth      | death      | age  |
+--------+------------+------------+------+
| Bowser | 1989-08-31 | 1995-07-29 |    5 |
+--------+------------+------------+------+
</pre><p>
          The query uses <code class="literal">death IS NOT NULL</code> rather
          than <code class="literal">death &lt;&gt; NULL</code> because
          <code class="literal">NULL</code> is a special value that cannot be
          compared using the usual comparison operators. This is
          discussed later. See <a class="xref" href="tutorial.html#working-with-null" title="3.3.4.6. Working with NULL Values">Section 3.3.4.6, “Working with <code class="literal">NULL</code> Values”</a>.
        </p><p>
          What if you want to know which animals have birthdays next
          month? For this type of calculation, year and day are
          irrelevant; you simply want to extract the month part of the
          <code class="literal">birth</code> column. MySQL provides several
          functions for extracting parts of dates, such as
          <a class="link" href="functions.html#function_year"><code class="literal">YEAR()</code></a>,
          <a class="link" href="functions.html#function_month"><code class="literal">MONTH()</code></a>, and
          <a class="link" href="functions.html#function_dayofmonth"><code class="literal">DAYOFMONTH()</code></a>.
          <a class="link" href="functions.html#function_month"><code class="literal">MONTH()</code></a> is the appropriate
          function here. To see how it works, run a simple query that
          displays the value of both <code class="literal">birth</code> and
          <a class="link" href="functions.html#function_month"><code class="literal">MONTH(birth)</code></a>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth, MONTH(birth) FROM pet;</code></strong>
+----------+------------+--------------+
| name     | birth      | MONTH(birth) |
+----------+------------+--------------+
| Fluffy   | 1993-02-04 |            2 |
| Claws    | 1994-03-17 |            3 |
| Buffy    | 1989-05-13 |            5 |
| Fang     | 1990-08-27 |            8 |
| Bowser   | 1989-08-31 |            8 |
| Chirpy   | 1998-09-11 |            9 |
| Whistler | 1997-12-09 |           12 |
| Slim     | 1996-04-29 |            4 |
| Puffball | 1999-03-30 |            3 |
+----------+------------+--------------+
</pre><p>
          Finding animals with birthdays in the upcoming month is also
          simple. Suppose that the current month is April. Then the
          month value is <code class="literal">4</code> and you can look for
          animals born in May (month <code class="literal">5</code>) like this:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet WHERE MONTH(birth) = 5;</code></strong>
+-------+------------+
| name  | birth      |
+-------+------------+
| Buffy | 1989-05-13 |
+-------+------------+
</pre><p>
          There is a small complication if the current month is
          December. You cannot merely add one to the month number
          (<code class="literal">12</code>) and look for animals born in month
          <code class="literal">13</code>, because there is no such month.
          Instead, you look for animals born in January (month
          <code class="literal">1</code>).
        </p><p>
          You can write the query so that it works no matter what the
          current month is, so that you do not have to use the number
          for a particular month.
          <a class="link" href="functions.html#function_date-add"><code class="literal">DATE_ADD()</code></a> enables you to add a
          time interval to a given date. If you add a month to the value
          of <a class="link" href="functions.html#function_curdate"><code class="literal">CURDATE()</code></a>, then extract the
          month part with <a class="link" href="functions.html#function_month"><code class="literal">MONTH()</code></a>, the
          result produces the month in which to look for birthdays:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>WHERE MONTH(birth) = MONTH(DATE_ADD(CURDATE(),INTERVAL 1 MONTH));</code></strong>
</pre><p>
          A different way to accomplish the same task is to add
          <code class="literal">1</code> to get the next month after the current
          one after using the modulo function (<code class="literal">MOD</code>)
          to wrap the month value to <code class="literal">0</code> if it is
          currently <code class="literal">12</code>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>WHERE MONTH(birth) = MOD(MONTH(CURDATE()), 12) + 1;</code></strong>
</pre><p>
          <a class="link" href="functions.html#function_month"><code class="literal">MONTH()</code></a> returns a number
          between <code class="literal">1</code> and <code class="literal">12</code>. And
          <a class="link" href="functions.html#function_mod"><code class="literal">MOD(something,12)</code></a> returns a
          number between <code class="literal">0</code> and <code class="literal">11</code>.
          So the addition has to be after the
          <a class="link" href="functions.html#function_mod"><code class="literal">MOD()</code></a>, otherwise we would go
          from November (<code class="literal">11</code>) to January
          (<code class="literal">1</code>).
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="working-with-null"></a>3.3.4.6. Working with <code class="literal">NULL</code> Values</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7341824"></a><a class="indexterm" name="idp7342896"></a><p>
          The <code class="literal">NULL</code> value can be surprising until you
          get used to it. Conceptually, <code class="literal">NULL</code> means
          <span class="quote">“<span class="quote">a missing unknown value</span>”</span> and it is treated
          somewhat differently from other values.
        </p><p>
          To test for <code class="literal">NULL</code>, use the
          <a class="link" href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a> and <a class="link" href="functions.html#operator_is-not-null"><code class="literal">IS
          NOT NULL</code></a> operators, as shown here:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT 1 IS NULL, 1 IS NOT NULL;</code></strong>
+-----------+---------------+
| 1 IS NULL | 1 IS NOT NULL |
+-----------+---------------+
|         0 |             1 |
+-----------+---------------+
</pre><p>
          You cannot use arithmetic comparison operators such as
          <a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>,
          <a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>, or
          <a class="link" href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a> to
          test for <code class="literal">NULL</code>. To demonstrate this for
          yourself, try the following query:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT 1 = NULL, 1 &lt;&gt; NULL, 1 &lt; NULL, 1 &gt; NULL;</code></strong>
+----------+-----------+----------+----------+
| 1 = NULL | 1 &lt;&gt; NULL | 1 &lt; NULL | 1 &gt; NULL |
+----------+-----------+----------+----------+
|     NULL |      NULL |     NULL |     NULL |
+----------+-----------+----------+----------+
</pre><p>
          Because the result of any arithmetic comparison with
          <code class="literal">NULL</code> is also <code class="literal">NULL</code>, you
          cannot obtain any meaningful results from such comparisons.
        </p><p>
          In MySQL, <code class="literal">0</code> or <code class="literal">NULL</code>
          means false and anything else means true. The default truth
          value from a boolean operation is <code class="literal">1</code>.
        </p><p>
          This special treatment of <code class="literal">NULL</code> is why, in
          the previous section, it was necessary to determine which
          animals are no longer alive using <code class="literal">death IS NOT
          NULL</code> instead of <code class="literal">death &lt;&gt;
          NULL</code>.
        </p><p>
          Two <code class="literal">NULL</code> values are regarded as equal in a
          <code class="literal">GROUP BY</code>.
        </p><p>
          When doing an <code class="literal">ORDER BY</code>,
          <code class="literal">NULL</code> values are presented first if you do
          <code class="literal">ORDER BY ... ASC</code> and last if you do
          <code class="literal">ORDER BY ... DESC</code>.
        </p><p>
          A common error when working with <code class="literal">NULL</code> is to
          assume that it is not possible to insert a zero or an empty
          string into a column defined as <code class="literal">NOT NULL</code>,
          but this is not the case. These are in fact values, whereas
          <code class="literal">NULL</code> means <span class="quote">“<span class="quote">not having a
          value.</span>”</span> You can test this easily enough by using
          <code class="literal">IS [NOT] NULL</code> as shown:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT 0 IS NULL, 0 IS NOT NULL, '' IS NULL, '' IS NOT NULL;</code></strong>
+-----------+---------------+------------+----------------+
| 0 IS NULL | 0 IS NOT NULL | '' IS NULL | '' IS NOT NULL |
+-----------+---------------+------------+----------------+
|         0 |             1 |          0 |              1 |
+-----------+---------------+------------+----------------+
</pre><p>
          Thus it is entirely possible to insert a zero or empty string
          into a <code class="literal">NOT NULL</code> column, as these are in
          fact <code class="literal">NOT NULL</code>. See
          <a class="xref" href="error-handling.html#problems-with-null" title="C.5.5.3. Problems with NULL Values">Section C.5.5.3, “Problems with <code class="literal">NULL</code> Values”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="pattern-matching"></a>3.3.4.7. Pattern Matching</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7378544"></a><a class="indexterm" name="idp7379616"></a><a class="indexterm" name="idp7381104"></a><p>
          MySQL provides standard SQL pattern matching as well as a form
          of pattern matching based on extended regular expressions
          similar to those used by Unix utilities such as
          <span class="command"><strong>vi</strong></span>, <span class="command"><strong>grep</strong></span>, and
          <span class="command"><strong>sed</strong></span>.
        </p><p>
          SQL pattern matching enables you to use
          <span class="quote">“<span class="quote"><code class="literal">_</code></span>”</span> to match any single
          character and <span class="quote">“<span class="quote"><code class="literal">%</code></span>”</span> to match an
          arbitrary number of characters (including zero characters). In
          MySQL, SQL patterns are case-insensitive by default. Some
          examples are shown here. You do not use <code class="literal">=</code>
          or <code class="literal">&lt;&gt;</code> when you use SQL patterns; use
          the <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> or
          <a class="link" href="functions.html#operator_not-like"><code class="literal">NOT LIKE</code></a> comparison operators
          instead.
        </p><p>
          To find names beginning with
          <span class="quote">“<span class="quote"><code class="literal">b</code></span>”</span>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name LIKE 'b%';</code></strong>
+--------+--------+---------+------+------------+------------+
| name   | owner  | species | sex  | birth      | death      |
+--------+--------+---------+------+------------+------------+
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |
| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+--------+---------+------+------------+------------+
</pre><p>
          To find names ending with
          <span class="quote">“<span class="quote"><code class="literal">fy</code></span>”</span>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name LIKE '%fy';</code></strong>
+--------+--------+---------+------+------------+-------+
| name   | owner  | species | sex  | birth      | death |
+--------+--------+---------+------+------------+-------+
| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |
+--------+--------+---------+------+------------+-------+
</pre><p>
          To find names containing a
          <span class="quote">“<span class="quote"><code class="literal">w</code></span>”</span>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name LIKE '%w%';</code></strong>
+----------+-------+---------+------+------------+------------+
| name     | owner | species | sex  | birth      | death      |
+----------+-------+---------+------+------------+------------+
| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |
| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |
+----------+-------+---------+------+------------+------------+
</pre><p>
          To find names containing exactly five characters, use five
          instances of the <span class="quote">“<span class="quote"><code class="literal">_</code></span>”</span> pattern
          character:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name LIKE '_____';</code></strong>
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</pre><p>
          The other type of pattern matching provided by MySQL uses
          extended regular expressions. When you test for a match for
          this type of pattern, use the
          <a class="link" href="functions.html#operator_regexp"><code class="literal">REGEXP</code></a> and <a class="link" href="functions.html#operator_not-regexp"><code class="literal">NOT
          REGEXP</code></a> operators (or
          <a class="link" href="functions.html#operator_regexp"><code class="literal">RLIKE</code></a> and
          <a class="link" href="functions.html#operator_not-regexp"><code class="literal">NOT RLIKE</code></a>,
          which are synonyms).
        </p><p>
          The following list describes some characteristics of extended
          regular expressions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <span class="quote">“<span class="quote"><code class="literal">.</code></span>”</span> matches any single
              character.
            </p></li><li class="listitem"><p>
              A character class <span class="quote">“<span class="quote"><code class="literal">[...]</code></span>”</span>
              matches any character within the brackets. For example,
              <span class="quote">“<span class="quote"><code class="literal">[abc]</code></span>”</span> matches
              <span class="quote">“<span class="quote"><code class="literal">a</code></span>”</span>,
              <span class="quote">“<span class="quote"><code class="literal">b</code></span>”</span>, or
              <span class="quote">“<span class="quote"><code class="literal">c</code></span>”</span>. To name a range of
              characters, use a dash.
              <span class="quote">“<span class="quote"><code class="literal">[a-z]</code></span>”</span> matches any
              letter, whereas <span class="quote">“<span class="quote"><code class="literal">[0-9]</code></span>”</span>
              matches any digit.
            </p></li><li class="listitem"><p>
              <span class="quote">“<span class="quote"><code class="literal">*</code></span>”</span> matches zero or more
              instances of the thing preceding it. For example,
              <span class="quote">“<span class="quote"><code class="literal">x*</code></span>”</span> matches any number of
              <span class="quote">“<span class="quote"><code class="literal">x</code></span>”</span> characters,
              <span class="quote">“<span class="quote"><code class="literal">[0-9]*</code></span>”</span> matches any
              number of digits, and <span class="quote">“<span class="quote"><code class="literal">.*</code></span>”</span>
              matches any number of anything.
            </p></li><li class="listitem"><p>
              A <a class="link" href="functions.html#operator_regexp"><code class="literal">REGEXP</code></a> pattern match
              succeeds if the pattern matches anywhere in the value
              being tested. (This differs from a
              <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> pattern match, which
              succeeds only if the pattern matches the entire value.)
            </p></li><li class="listitem"><p>
              To anchor a pattern so that it must match the beginning or
              end of the value being tested, use
              <span class="quote">“<span class="quote"><code class="literal">^</code></span>”</span> at the beginning or
              <span class="quote">“<span class="quote"><code class="literal">$</code></span>”</span> at the end of the
              pattern.
</p></li></ul>
</div>
<p>
          To demonstrate how extended regular expressions work, the
          <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> queries shown previously are
          rewritten here to use <a class="link" href="functions.html#operator_regexp"><code class="literal">REGEXP</code></a>.
        </p><p>
          To find names beginning with
          <span class="quote">“<span class="quote"><code class="literal">b</code></span>”</span>, use
          <span class="quote">“<span class="quote"><code class="literal">^</code></span>”</span> to match the beginning of
          the name:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP '^b';</code></strong>
+--------+--------+---------+------+------------+------------+
| name   | owner  | species | sex  | birth      | death      |
+--------+--------+---------+------+------------+------------+
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |
| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+--------+---------+------+------------+------------+
</pre><p>
          If you really want to force a
          <a class="link" href="functions.html#operator_regexp"><code class="literal">REGEXP</code></a> comparison to be case
          sensitive, use the <a class="link" href="functions.html#operator_binary"><code class="literal">BINARY</code></a> keyword
          to make one of the strings a binary string. This query matches
          only lowercase <span class="quote">“<span class="quote"><code class="literal">b</code></span>”</span> at the
          beginning of a name:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP BINARY '^b';</code></strong>
</pre><p>
          To find names ending with
          <span class="quote">“<span class="quote"><code class="literal">fy</code></span>”</span>, use
          <span class="quote">“<span class="quote"><code class="literal">$</code></span>”</span> to match the end of the
          name:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP 'fy$';</code></strong>
+--------+--------+---------+------+------------+-------+
| name   | owner  | species | sex  | birth      | death |
+--------+--------+---------+------+------------+-------+
| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |
+--------+--------+---------+------+------------+-------+
</pre><p>
          To find names containing a
          <span class="quote">“<span class="quote"><code class="literal">w</code></span>”</span>, use this query:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP 'w';</code></strong>
+----------+-------+---------+------+------------+------------+
| name     | owner | species | sex  | birth      | death      |
+----------+-------+---------+------+------------+------------+
| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |
| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |
+----------+-------+---------+------+------------+------------+
</pre><p>
          Because a regular expression pattern matches if it occurs
          anywhere in the value, it is not necessary in the previous
          query to put a wildcard on either side of the pattern to get
          it to match the entire value like it would be if you used an
          SQL pattern.
        </p><p>
          To find names containing exactly five characters, use
          <span class="quote">“<span class="quote"><code class="literal">^</code></span>”</span> and
          <span class="quote">“<span class="quote"><code class="literal">$</code></span>”</span> to match the beginning and
          end of the name, and five instances of
          <span class="quote">“<span class="quote"><code class="literal">.</code></span>”</span> in between:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP '^.....$';</code></strong>
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</pre><p>
          You could also write the previous query using the
          <code class="literal">{<em class="replaceable"><code>n</code></em>}</code>
          (<span class="quote">“<span class="quote">repeat-<em class="replaceable"><code>n</code></em>-times</span>”</span>)
          operator:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP '^.{5}$';</code></strong>
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</pre><p>
          <a class="xref" href="functions.html#regexp" title="12.5.2. Regular Expressions">Section 12.5.2, “Regular Expressions”</a>, provides more information about the
          syntax for regular expressions.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="counting-rows"></a>3.3.4.8. Counting Rows</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7456512"></a><a class="indexterm" name="idp7458000"></a><a class="indexterm" name="idp7459488"></a><p>
          Databases are often used to answer the question, <span class="quote">“<span class="quote">How
          often does a certain type of data occur in a table?</span>”</span>
          For example, you might want to know how many pets you have, or
          how many pets each owner has, or you might want to perform
          various kinds of census operations on your animals.
        </p><p>
          Counting the total number of animals you have is the same
          question as <span class="quote">“<span class="quote">How many rows are in the
          <code class="literal">pet</code> table?</span>”</span> because there is one
          record per pet. <a class="link" href="functions.html#function_count"><code class="literal">COUNT(*)</code></a> counts
          the number of rows, so the query to count your animals looks
          like this:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT COUNT(*) FROM pet;</code></strong>
+----------+
| COUNT(*) |
+----------+
|        9 |
+----------+
</pre><p>
          Earlier, you retrieved the names of the people who owned pets.
          You can use <a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a> if you want
          to find out how many pets each owner has:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT owner, COUNT(*) FROM pet GROUP BY owner;</code></strong>
+--------+----------+
| owner  | COUNT(*) |
+--------+----------+
| Benny  |        2 |
| Diane  |        2 |
| Gwen   |        3 |
| Harold |        2 |
+--------+----------+
</pre><p>
          The preceding query uses <code class="literal">GROUP BY</code> to group
          all records for each <code class="literal">owner</code>. The use of
          <a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a> in conjunction with
          <code class="literal">GROUP BY</code> is useful for characterizing your
          data under various groupings. The following examples show
          different ways to perform animal census operations.
        </p><p>
          Number of animals per species:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT species, COUNT(*) FROM pet GROUP BY species;</code></strong>
+---------+----------+
| species | COUNT(*) |
+---------+----------+
| bird    |        2 |
| cat     |        2 |
| dog     |        3 |
| hamster |        1 |
| snake   |        1 |
+---------+----------+
</pre><p>
          Number of animals per sex:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT sex, COUNT(*) FROM pet GROUP BY sex;</code></strong>
+------+----------+
| sex  | COUNT(*) |
+------+----------+
| NULL |        1 |
| f    |        4 |
| m    |        4 |
+------+----------+
</pre><p>
          (In this output, <code class="literal">NULL</code> indicates that the
          sex is unknown.)
        </p><p>
          Number of animals per combination of species and sex:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT species, sex, COUNT(*) FROM pet GROUP BY species, sex;</code></strong>
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| bird    | NULL |        1 |
| bird    | f    |        1 |
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
| hamster | f    |        1 |
| snake   | m    |        1 |
+---------+------+----------+
</pre><p>
          You need not retrieve an entire table when you use
          <a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a>. For example, the
          previous query, when performed just on dogs and cats, looks
          like this:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT species, sex, COUNT(*) FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>WHERE species = 'dog' OR species = 'cat'</code></strong>
    -&gt; <strong class="userinput"><code>GROUP BY species, sex;</code></strong>
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
+---------+------+----------+
</pre><p>
          Or, if you wanted the number of animals per sex only for
          animals whose sex is known:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT species, sex, COUNT(*) FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>WHERE sex IS NOT NULL</code></strong>
    -&gt; <strong class="userinput"><code>GROUP BY species, sex;</code></strong>
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| bird    | f    |        1 |
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
| hamster | f    |        1 |
| snake   | m    |        1 |
+---------+------+----------+
</pre><p>
          If you name columns to select in addition to the
          <a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a> value, a <code class="literal">GROUP
          BY</code> clause should be present that names those same
          columns. Otherwise, the following occurs:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the
              <a class="link" href="server-administration.html#sqlmode_only_full_group_by"><code class="literal">ONLY_FULL_GROUP_BY</code></a> SQL
              mode is enabled, an error occurs:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET sql_mode = 'ONLY_FULL_GROUP_BY';</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT owner, COUNT(*) FROM pet;</code></strong>
ERROR 1140 (42000): Mixing of GROUP columns (MIN(),MAX(),COUNT()...)
with no GROUP columns is illegal if there is no GROUP BY clause
</pre></li><li class="listitem"><p>
              If <a class="link" href="server-administration.html#sqlmode_only_full_group_by"><code class="literal">ONLY_FULL_GROUP_BY</code></a> is
              not enabled, the query is processed by treating all rows
              as a single group, but the value selected for each named
              column is indeterminate. The server is free to select the
              value from any row:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET sql_mode = '';</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT owner, COUNT(*) FROM pet;</code></strong>
+--------+----------+
| owner  | COUNT(*) |
+--------+----------+
| Harold |        8 | 
+--------+----------+
1 row in set (0.00 sec)
</pre></li></ul>
</div>
<p>
          See also <a class="xref" href="functions.html#group-by-extensions" title="12.17.3. MySQL Extensions to GROUP BY">Section 12.17.3, “MySQL Extensions to <code class="literal">GROUP BY</code>”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="multiple-tables"></a>3.3.4.9. Using More Than one Table</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7501616"></a><p>
          The <code class="literal">pet</code> table keeps track of which pets you
          have. If you want to record other information about them, such
          as events in their lives like visits to the vet or when
          litters are born, you need another table. What should this
          table look like? It needs to contain the following
          information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The pet name so that you know which animal each event
              pertains to.
            </p></li><li class="listitem"><p>
              A date so that you know when the event occurred.
            </p></li><li class="listitem"><p>
              A field to describe the event.
            </p></li><li class="listitem"><p>
              An event type field, if you want to be able to categorize
              events.
</p></li></ul>
</div>
<p>
          Given these considerations, the <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
          TABLE</code></a> statement for the <code class="literal">event</code>
          table might look like this:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE event (name VARCHAR(20), date DATE,</code></strong>
    -&gt; <strong class="userinput"><code>type VARCHAR(15), remark VARCHAR(255));</code></strong>
</pre><p>
          As with the <code class="literal">pet</code> table, it is easiest to
          load the initial records by creating a tab-delimited text file
          containing the following information.
</p>
<div class="informaltable">
<table summary="This table represents pet record data
            that will appear in a tab delimited text file, as described
in the preceding text." border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col">name</th><th scope="col">date</th><th scope="col">type</th><th scope="col">remark</th></tr></thead><tbody><tr><td scope="row">Fluffy</td><td>1995-05-15</td><td>litter</td><td>4 kittens, 3 female, 1 male</td></tr><tr><td scope="row">Buffy</td><td>1993-06-23</td><td>litter</td><td>5 puppies, 2 female, 3 male</td></tr><tr><td scope="row">Buffy</td><td>1994-06-19</td><td>litter</td><td>3 puppies, 3 female</td></tr><tr><td scope="row">Chirpy</td><td>1999-03-21</td><td>vet</td><td>needed beak straightened</td></tr><tr><td scope="row">Slim</td><td>1997-08-03</td><td>vet</td><td>broken rib</td></tr><tr><td scope="row">Bowser</td><td>1991-10-12</td><td>kennel</td><td> </td></tr><tr><td scope="row">Fang</td><td>1991-10-12</td><td>kennel</td><td> </td></tr><tr><td scope="row">Fang</td><td>1998-08-28</td><td>birthday</td><td>Gave him a new chew toy</td></tr><tr><td scope="row">Claws</td><td>1998-03-17</td><td>birthday</td><td>Gave him a new flea collar</td></tr><tr><td scope="row">Whistler</td><td>1998-12-09</td><td>birthday</td><td>First birthday</td></tr></tbody></table>
</div>
<p>
          Load the records like this:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>LOAD DATA LOCAL INFILE 'event.txt' INTO TABLE event;</code></strong>
</pre><p>
          Based on what you have learned from the queries that you have
          run on the <code class="literal">pet</code> table, you should be able to
          perform retrievals on the records in the
          <code class="literal">event</code> table; the principles are the same.
          But when is the <code class="literal">event</code> table by itself
          insufficient to answer questions you might ask?
        </p><p>
          Suppose that you want to find out the ages at which each pet
          had its litters. We saw earlier how to calculate ages from two
          dates. The litter date of the mother is in the
          <code class="literal">event</code> table, but to calculate her age on
          that date you need her birth date, which is stored in the
          <code class="literal">pet</code> table. This means the query requires
          both tables:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT pet.name,</code></strong>
    -&gt; <strong class="userinput"><code>(YEAR(date)-YEAR(birth)) - (RIGHT(date,5)&lt;RIGHT(birth,5)) AS age,</code></strong>
    -&gt; <strong class="userinput"><code>remark</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet INNER JOIN event</code></strong>
    -&gt; <strong class="userinput"><code>  ON pet.name = event.name</code></strong>
    -&gt; <strong class="userinput"><code>WHERE event.type = 'litter';</code></strong>
+--------+------+-----------------------------+
| name   | age  | remark                      |
+--------+------+-----------------------------+
| Fluffy |    2 | 4 kittens, 3 female, 1 male |
| Buffy  |    4 | 5 puppies, 2 female, 3 male |
| Buffy  |    5 | 3 puppies, 3 female         |
+--------+------+-----------------------------+
</pre><p>
          There are several things to note about this query:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The <code class="literal">FROM</code> clause joins two tables
              because the query needs to pull information from both of
              them.
            </p></li><li class="listitem"><p>
              When combining (joining) information from multiple tables,
              you need to specify how records in one table can be
              matched to records in the other. This is easy because they
              both have a <code class="literal">name</code> column. The query uses
              an <code class="literal">ON</code> clause to match up records in the
              two tables based on the <code class="literal">name</code> values.
            </p><p>
              The query uses an <code class="literal">INNER JOIN</code> to combine
              the tables. An <code class="literal">INNER JOIN</code> permits rows
              from either table to appear in the result if and only if
              both tables meet the conditions specified in the
              <code class="option">ON</code> clause. In this example, the
              <code class="literal">ON</code> clause specifies that the
              <code class="literal">name</code> column in the
              <code class="literal">pet</code> table must match the
              <code class="literal">name</code> column in the
              <code class="literal">event</code> table. If a name appears in one
              table but not the other, the row will not appear in the
              result because the condition in the <code class="literal">ON</code>
              clause fails.
            </p></li><li class="listitem"><p>
              Because the <code class="literal">name</code> column occurs in both
              tables, you must be specific about which table you mean
              when referring to the column. This is done by prepending
              the table name to the column name.
</p></li></ul>
</div>
<p>
          You need not have two different tables to perform a join.
          Sometimes it is useful to join a table to itself, if you want
          to compare records in a table to other records in that same
          table. For example, to find breeding pairs among your pets,
          you can join the <code class="literal">pet</code> table with itself to
          produce candidate pairs of males and females of like species:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT p1.name, p1.sex, p2.name, p2.sex, p1.species</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet AS p1 INNER JOIN pet AS p2</code></strong>
    -&gt; <strong class="userinput"><code>  ON p1.species = p2.species AND p1.sex = 'f' AND p2.sex = 'm';</code></strong>
+--------+------+--------+------+---------+
| name   | sex  | name   | sex  | species |
+--------+------+--------+------+---------+
| Fluffy | f    | Claws  | m    | cat     |
| Buffy  | f    | Fang   | m    | dog     |
| Buffy  | f    | Bowser | m    | dog     |
+--------+------+--------+------+---------+
</pre><p>
          In this query, we specify aliases for the table name to refer
          to the columns and keep straight which instance of the table
          each column reference is associated with.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="getting-information"></a>3.4. Getting Information About Databases and Tables</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp7574560"></a><a class="indexterm" name="idp7576048"></a><a class="indexterm" name="idp7577536"></a><p>
      What if you forget the name of a database or table, or what the
      structure of a given table is (for example, what its columns are
      called)? MySQL addresses this problem through several statements
      that provide information about the databases and tables it
      supports.
    </p><p>
      You have previously seen <a class="link" href="sql-syntax.html#show-databases" title="13.7.5.15. SHOW DATABASES Syntax"><code class="literal">SHOW
      DATABASES</code></a>, which lists the databases managed by the
      server. To find out which database is currently selected, use the
      <a class="link" href="functions.html#function_database"><code class="literal">DATABASE()</code></a> function:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT DATABASE();</code></strong>
+------------+
| DATABASE() |
+------------+
| menagerie  |
+------------+
</pre><p>
      If you have not yet selected any database, the result is
      <code class="literal">NULL</code>.
    </p><p>
      To find out what tables the default database contains (for
      example, when you are not sure about the name of a table), use
      this command:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
+---------------------+
| Tables_in_menagerie |
+---------------------+
| event               |
| pet                 |
+---------------------+
</pre><p>
      The name of the column in the output produced by this statement is
      always
      <code class="literal">Tables_in_<em class="replaceable"><code>db_name</code></em></code>,
      where <em class="replaceable"><code>db_name</code></em> is the name of the
      database. See <a class="xref" href="sql-syntax.html#show-tables" title="13.7.5.38. SHOW TABLES Syntax">Section 13.7.5.38, “<code class="literal">SHOW TABLES</code> Syntax”</a>, for more information.
    </p><p>
      If you want to find out about the structure of a table, the
      <a class="link" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a> statement is useful; it
      displays information about each of a table's columns:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>DESCRIBE pet;</code></strong>
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| name    | varchar(20) | YES  |     | NULL    |       |
| owner   | varchar(20) | YES  |     | NULL    |       |
| species | varchar(20) | YES  |     | NULL    |       |
| sex     | char(1)     | YES  |     | NULL    |       |
| birth   | date        | YES  |     | NULL    |       |
| death   | date        | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+
</pre><p>
      <code class="literal">Field</code> indicates the column name,
      <code class="literal">Type</code> is the data type for the column,
      <code class="literal">NULL</code> indicates whether the column can contain
      <code class="literal">NULL</code> values, <code class="literal">Key</code> indicates
      whether the column is indexed, and <code class="literal">Default</code>
      specifies the column's default value. <code class="literal">Extra</code>
      displays special information about columns: If a column was
      created with the <code class="literal">AUTO_INCREMENT</code> option, the
      value will be <code class="literal">auto_increment</code> rather than empty.
    </p><p>
      <code class="literal">DESC</code> is a short form of
      <a class="link" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a>. See
      <a class="xref" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax">Section 13.8.1, “<code class="literal">DESCRIBE</code> Syntax”</a>, for more information.
    </p><p>
      You can obtain the <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
      statement necessary to create an existing table using the
      <a class="link" href="sql-syntax.html#show-create-table" title="13.7.5.12. SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a> statement. See
      <a class="xref" href="sql-syntax.html#show-create-table" title="13.7.5.12. SHOW CREATE TABLE Syntax">Section 13.7.5.12, “<code class="literal">SHOW CREATE TABLE</code> Syntax”</a>.
    </p><p>
      If you have indexes on a table, <code class="literal">SHOW INDEX FROM
      <em class="replaceable"><code>tbl_name</code></em></code> produces information
      about them. See <a class="xref" href="sql-syntax.html#show-index" title="13.7.5.23. SHOW INDEX Syntax">Section 13.7.5.23, “<code class="literal">SHOW INDEX</code> Syntax”</a>, for more about this
      statement.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="batch-mode"></a>3.5. Using <span class="command"><strong>mysql</strong></span> in Batch Mode</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp7608464"></a><a class="indexterm" name="idp7609952"></a><a class="indexterm" name="idp7611024"></a><a class="indexterm" name="idp7612512"></a><a class="indexterm" name="idp7613584"></a><a class="indexterm" name="idp7615072"></a><p>
      In the previous sections, you used <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>
      interactively to enter queries and view the results. You can also
      run <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> in batch mode. To do this, put the
      commands you want to run in a file, then tell
      <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> to read its input from the file:
    </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql &lt; <em class="replaceable"><code>batch-file</code></em></code></strong>
</pre><p>
      If you are running <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> under Windows and have
      some special characters in the file that cause problems, you can
      do this:
    </p><pre class="programlisting">C:\&gt; <strong class="userinput"><code>mysql -e "source <em class="replaceable"><code>batch-file</code></em>"</code></strong>
</pre><p>
      If you need to specify connection parameters on the command line,
      the command might look like this:
    </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -h <em class="replaceable"><code>host</code></em> -u <em class="replaceable"><code>user</code></em> -p &lt; <em class="replaceable"><code>batch-file</code></em></code></strong>
Enter password: <strong class="userinput"><code>********</code></strong>
</pre><p>
      When you use <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> this way, you are creating a
      script file, then executing the script.
    </p><p>
      If you want the script to continue even if some of the statements
      in it produce errors, you should use the
      <a class="link" href="programs.html#option_mysql_force"><code class="option">--force</code></a> command-line option.
    </p><p>
      Why use a script? Here are a few reasons:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If you run a query repeatedly (say, every day or every week),
          making it a script enables you to avoid retyping it each time
          you execute it.
        </p></li><li class="listitem"><p>
          You can generate new queries from existing ones that are
          similar by copying and editing script files.
        </p></li><li class="listitem"><p>
          Batch mode can also be useful while you're developing a query,
          particularly for multiple-line commands or multiple-statement
          sequences of commands. If you make a mistake, you don't have
          to retype everything. Just edit your script to correct the
          error, then tell <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> to execute it again.
        </p></li><li class="listitem"><p>
          If you have a query that produces a lot of output, you can run
          the output through a pager rather than watching it scroll off
          the top of your screen:
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql &lt; <em class="replaceable"><code>batch-file</code></em> | more</code></strong>
</pre></li><li class="listitem"><p>
          You can catch the output in a file for further processing:
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql &lt; <em class="replaceable"><code>batch-file</code></em> &gt; mysql.out</code></strong>
</pre></li><li class="listitem"><p>
          You can distribute your script to other people so that they
          can also run the commands.
        </p></li><li class="listitem"><p>
          Some situations do not allow for interactive use, for example,
          when you run a query from a <span class="command"><strong>cron</strong></span> job. In
          this case, you must use batch mode.
</p></li></ul>
</div>
<p>
      The default output format is different (more concise) when you run
      <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> in batch mode than when you use it
      interactively. For example, the output of <code class="literal">SELECT DISTINCT
      species FROM pet</code> looks like this when
      <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> is run interactively:
    </p><pre class="programlisting">+---------+
| species |
+---------+
| bird    |
| cat     |
| dog     |
| hamster |
| snake   |
+---------+</pre><p>
      In batch mode, the output looks like this instead:
    </p><pre class="programlisting">species
bird
cat
dog
hamster
snake</pre><p>
      If you want to get the interactive output format in batch mode,
      use <code class="literal">mysql -t</code>. To echo to the output the
      commands that are executed, use <code class="literal">mysql -vvv</code>.
    </p><a class="indexterm" name="idp7650336"></a><a class="indexterm" name="idp7651424"></a><a class="indexterm" name="idp7652512"></a><a class="indexterm" name="idp7653616"></a><p>
      You can also use scripts from the <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> prompt
      by using the <code class="literal">source</code> command or
      <code class="literal">\.</code> command:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>source <em class="replaceable"><code>filename</code></em>;</code></strong>
mysql&gt; <strong class="userinput"><code>\. <em class="replaceable"><code>filename</code></em></code></strong>
</pre><p>
      See <a class="xref" href="programs.html#mysql-batch-commands" title="4.5.1.5. Executing SQL Statements from a Text File">Section 4.5.1.5, “Executing SQL Statements from a Text File”</a>, for more information.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="examples"></a>3.6. Examples of Common Queries</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="tutorial.html#example-maximum-column">3.6.1. The Maximum Value for a Column</a></span></dt><dt><span class="section"><a href="tutorial.html#example-maximum-row">3.6.2. The Row Holding the Maximum of a Certain Column</a></span></dt><dt><span class="section"><a href="tutorial.html#example-maximum-column-group">3.6.3. Maximum of Column per Group</a></span></dt><dt><span class="section"><a href="tutorial.html#example-maximum-column-group-row">3.6.4. The Rows Holding the Group-wise Maximum of a Certain Column</a></span></dt><dt><span class="section"><a href="tutorial.html#example-user-variables">3.6.5. Using User-Defined Variables</a></span></dt><dt><span class="section"><a href="tutorial.html#example-foreign-keys">3.6.6. Using Foreign Keys</a></span></dt><dt><span class="section"><a href="tutorial.html#searching-on-two-keys">3.6.7. Searching on Two Keys</a></span></dt><dt><span class="section"><a href="tutorial.html#calculating-days">3.6.8. Calculating Visits Per Day</a></span></dt><dt><span class="section"><a href="tutorial.html#example-auto-increment">3.6.9. Using <code class="literal">AUTO_INCREMENT</code></a></span></dt></dl>
</div>
<a class="indexterm" name="idp7662384"></a><a class="indexterm" name="idp7663872"></a><p>
      Here are examples of how to solve some common problems with MySQL.
    </p><p>
      Some of the examples use the table <code class="literal">shop</code> to hold
      the price of each article (item number) for certain traders
      (dealers). Supposing that each trader has a single fixed price per
      article, then (<code class="literal">article</code>,
      <code class="literal">dealer</code>) is a primary key for the records.
    </p><p>
      Start the command-line tool <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> and select a
      database:
    </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql <em class="replaceable"><code>your-database-name</code></em></code></strong>
</pre><p>
      (In most MySQL installations, you can use the database named
      <code class="literal">test</code>).
    </p><p>
      You can create and populate the example table with these
      statements:
    </p><pre class="programlisting">CREATE TABLE shop (
    article INT(4) UNSIGNED ZEROFILL DEFAULT '0000' NOT NULL,
    dealer  CHAR(20)                 DEFAULT ''     NOT NULL,
    price   DOUBLE(16,2)             DEFAULT '0.00' NOT NULL,
    PRIMARY KEY(article, dealer));
INSERT INTO shop VALUES
    (1,'A',3.45),(1,'B',3.99),(2,'A',10.99),(3,'B',1.45),
    (3,'C',1.69),(3,'D',1.25),(4,'D',19.95);</pre><p>
      After issuing the statements, the table should have the following
      contents:
    </p><pre class="programlisting">SELECT * FROM shop;

+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0001 | A      |  3.45 |
|    0001 | B      |  3.99 |
|    0002 | A      | 10.99 |
|    0003 | B      |  1.45 |
|    0003 | C      |  1.69 |
|    0003 | D      |  1.25 |
|    0004 | D      | 19.95 |
+---------+--------+-------+</pre>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-maximum-column"></a>3.6.1. The Maximum Value for a Column</h3>
</div>
</div>
</div>
<p>
        <span class="quote">“<span class="quote">What is the highest item number?</span>”</span>
      </p><pre class="programlisting">SELECT MAX(article) AS article FROM shop;

+---------+
| article |
+---------+
|       4 |
+---------+</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-maximum-row"></a>3.6.2. The Row Holding the Maximum of a Certain Column</h3>

</div>

</div>

</div>
<p>
        <span class="emphasis"><em>Task: Find the number, dealer, and price of the most
        expensive article.</em></span>
      </p><p>
        This is easily done with a subquery:
      </p><pre class="programlisting">SELECT article, dealer, price
FROM   shop
WHERE  price=(SELECT MAX(price) FROM shop);

+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0004 | D      | 19.95 |
+---------+--------+-------+</pre><p>
        Other solutions are to use a <code class="literal">LEFT JOIN</code> or to
        sort all rows descending by price and get only the first row
        using the MySQL-specific <code class="literal">LIMIT</code> clause:
      </p><pre class="programlisting">SELECT s1.article, s1.dealer, s1.price
FROM shop s1
LEFT JOIN shop s2 ON s1.price &lt; s2.price
WHERE s2.article IS NULL;

SELECT article, dealer, price
FROM shop
ORDER BY price DESC
LIMIT 1;</pre>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          If there were several most expensive articles, each with a
          price of 19.95, the <code class="literal">LIMIT</code> solution would
          show only one of them.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-maximum-column-group"></a>3.6.3. Maximum of Column per Group</h3>

</div>

</div>

</div>
<p>
        <span class="emphasis"><em>Task: Find the highest price per article.</em></span>
      </p><pre class="programlisting">SELECT article, MAX(price) AS price
FROM   shop
GROUP BY article;

+---------+-------+
| article | price |
+---------+-------+
|    0001 |  3.99 |
|    0002 | 10.99 |
|    0003 |  1.69 |
|    0004 | 19.95 |
+---------+-------+</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-maximum-column-group-row"></a>3.6.4. The Rows Holding the Group-wise Maximum of a Certain Column</h3>

</div>

</div>

</div>
<p>
        <span class="emphasis"><em>Task: For each article, find the dealer or dealers
        with the most expensive price.</em></span>
      </p><p>
        This problem can be solved with a subquery like this one:
      </p><pre class="programlisting">SELECT article, dealer, price
FROM   shop s1
WHERE  price=(SELECT MAX(s2.price)
              FROM shop s2
              WHERE s1.article = s2.article);

+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0001 | B      |  3.99 |
|    0002 | A      | 10.99 |
|    0003 | C      |  1.69 |
|    0004 | D      | 19.95 |
+---------+--------+-------+</pre><p>
        The preceding example uses a correlated subquery, which can be
        inefficient (see <a class="xref" href="sql-syntax.html#correlated-subqueries" title="13.2.10.7. Correlated Subqueries">Section 13.2.10.7, “Correlated Subqueries”</a>). Other
        possibilities for solving the problem are to use an uncorrelated
        subquery in the <code class="literal">FROM</code> clause or a
        <code class="literal">LEFT JOIN</code>.
      </p><p>
        Uncorrelated subquery:
      </p><pre class="programlisting">SELECT s1.article, dealer, s1.price
FROM shop s1
JOIN (
  SELECT article, MAX(price) AS price
  FROM shop
  GROUP BY article) AS s2
  ON s1.article = s2.article AND s1.price = s2.price;</pre><p>
        <code class="literal">LEFT JOIN</code>:
      </p><pre class="programlisting">SELECT s1.article, s1.dealer, s1.price
FROM shop s1
LEFT JOIN shop s2 ON s1.article = s2.article AND s1.price &lt; s2.price
WHERE s2.article IS NULL;</pre><p>
        The <code class="literal">LEFT JOIN</code> works on the basis that when
        <code class="literal">s1.price</code> is at its maximum value, there is no
        <code class="literal">s2.price</code> with a greater value and the
        <code class="literal">s2</code> rows values will be
        <code class="literal">NULL</code>. See <a class="xref" href="sql-syntax.html#join" title="13.2.9.2. JOIN Syntax">Section 13.2.9.2, “<code class="literal">JOIN</code> Syntax”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-user-variables"></a>3.6.5. Using User-Defined Variables</h3>

</div>

</div>

</div>
<p>
        You can employ MySQL user variables to remember results without
        having to store them in temporary variables in the client. (See
        <a class="xref" href="language-structure.html#user-variables" title="9.4. User-Defined Variables">Section 9.4, “User-Defined Variables”</a>.)
      </p><p>
        For example, to find the articles with the highest and lowest
        price you can do this:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT @min_price:=MIN(price),@max_price:=MAX(price) FROM shop;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT * FROM shop WHERE price=@min_price OR price=@max_price;</code></strong>
+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0003 | D      |  1.25 |
|    0004 | D      | 19.95 |
+---------+--------+-------+
</pre>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          It is also possible to store the name of a database object
          such as a table or a column in a user variable and then to use
          this variable in an SQL statement; however, this requires the
          use of a prepared statement. See
          <a class="xref" href="sql-syntax.html#sql-syntax-prepared-statements" title="13.5. SQL Syntax for Prepared Statements">Section 13.5, “SQL Syntax for Prepared Statements”</a>, for more
          information.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-foreign-keys"></a>3.6.6. Using Foreign Keys</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7711248"></a><a class="indexterm" name="idp7712320"></a><p>
        In MySQL, <code class="literal">InnoDB</code> tables support checking of
        foreign key constraints. See
        <a class="xref" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine">Section 14.2, “The <code class="literal">InnoDB</code> Storage Engine”</a>, and
        <a class="xref" href="introduction.html#ansi-diff-foreign-keys" title="1.8.5.4. Foreign Key Differences">Section 1.8.5.4, “Foreign Key Differences”</a>.
      </p><p>
        A foreign key constraint is not required merely to join two
        tables. For storage engines other than
        <code class="literal">InnoDB</code>, it is possible when defining a column
        to use a <code class="literal">REFERENCES
        <em class="replaceable"><code>tbl_name</code></em>(<em class="replaceable"><code>col_name</code></em>)</code>
        clause, which has no actual effect, and <span class="emphasis"><em>serves only as
        a memo or comment to you that the column which you are currently
        defining is intended to refer to a column in another
        table</em></span>. It is extremely important to realize when
        using this syntax that:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL does not perform any sort of <code class="literal">CHECK</code>
            to make sure that <em class="replaceable"><code>col_name</code></em>
            actually exists in <em class="replaceable"><code>tbl_name</code></em> (or
            even that <em class="replaceable"><code>tbl_name</code></em> itself
            exists).
          </p></li><li class="listitem"><p>
            MySQL does not perform any sort of action on
            <em class="replaceable"><code>tbl_name</code></em> such as deleting rows in
            response to actions taken on rows in the table which you are
            defining; in other words, this syntax induces no <code class="literal">ON
            DELETE</code> or <code class="literal">ON UPDATE</code> behavior
            whatsoever. (Although you can write an <code class="literal">ON
            DELETE</code> or <code class="literal">ON UPDATE</code> clause as
            part of the <code class="literal">REFERENCES</code> clause, it is also
            ignored.)
          </p></li><li class="listitem"><p>
            This syntax creates a <span class="emphasis"><em>column</em></span>; it does
            <span class="bold"><strong>not</strong></span> create any sort of
            index or key.
</p></li></ul>
</div>
<p>
        You can use a column so created as a join column, as shown here:
      </p><pre class="programlisting">CREATE TABLE person (
    id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    name CHAR(60) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE shirt (
    id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    style ENUM('t-shirt', 'polo', 'dress') NOT NULL,
    color ENUM('red', 'blue', 'orange', 'white', 'black') NOT NULL,
    owner SMALLINT UNSIGNED NOT NULL REFERENCES person(id),
    PRIMARY KEY (id)
);

INSERT INTO person VALUES (NULL, 'Antonio Paz');

SELECT @last := LAST_INSERT_ID();

INSERT INTO shirt VALUES
(NULL, 'polo', 'blue', @last),
(NULL, 'dress', 'white', @last),
(NULL, 't-shirt', 'blue', @last);

INSERT INTO person VALUES (NULL, 'Lilliana Angelovska');

SELECT @last := LAST_INSERT_ID();

INSERT INTO shirt VALUES
(NULL, 'dress', 'orange', @last),
(NULL, 'polo', 'red', @last),
(NULL, 'dress', 'blue', @last),
(NULL, 't-shirt', 'white', @last);

SELECT * FROM person;
+----+---------------------+
| id | name                |
+----+---------------------+
|  1 | Antonio Paz         |
|  2 | Lilliana Angelovska |
+----+---------------------+

SELECT * FROM shirt;
+----+---------+--------+-------+
| id | style   | color  | owner |
+----+---------+--------+-------+
|  1 | polo    | blue   |     1 |
|  2 | dress   | white  |     1 |
|  3 | t-shirt | blue   |     1 |
|  4 | dress   | orange |     2 |
|  5 | polo    | red    |     2 |
|  6 | dress   | blue   |     2 |
|  7 | t-shirt | white  |     2 |
+----+---------+--------+-------+


SELECT s.* FROM person p INNER JOIN shirt s
   ON s.owner = p.id
 WHERE p.name LIKE 'Lilliana%'
   AND s.color &lt;&gt; 'white';

+----+-------+--------+-------+
| id | style | color  | owner |
+----+-------+--------+-------+
|  4 | dress | orange |     2 |
|  5 | polo  | red    |     2 |
|  6 | dress | blue   |     2 |
+----+-------+--------+-------+</pre><p>
        When used in this fashion, the <code class="literal">REFERENCES</code>
        clause is not displayed in the output of
        <a class="link" href="sql-syntax.html#show-create-table" title="13.7.5.12. SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a>:
      </p><pre class="programlisting">SHOW CREATE TABLE shirt\G
*************************** 1. row ***************************
Table: shirt
Create Table: CREATE TABLE `shirt` (
`id` smallint(5) unsigned NOT NULL auto_increment,
`style` enum('t-shirt','polo','dress') NOT NULL,
`color` enum('red','blue','orange','white','black') NOT NULL,
`owner` smallint(5) unsigned NOT NULL,
PRIMARY KEY  (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1</pre><p>
        The use of <code class="literal">REFERENCES</code> in this way as a
        comment or <span class="quote">“<span class="quote">reminder</span>”</span> in a column definition works
        with <code class="literal">MyISAM</code> tables.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="searching-on-two-keys"></a>3.6.7. Searching on Two Keys</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7741840"></a><a class="indexterm" name="idp7742880"></a><a class="indexterm" name="idp7743952"></a><a class="indexterm" name="idp7745440"></a><p>
        An <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a> using a single key is well
        optimized, as is the handling of
        <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>.
      </p><p>
        The one tricky case is that of searching on two different keys
        combined with <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>:
      </p><pre class="programlisting">SELECT field1_index, field2_index FROM test_table
WHERE field1_index = '1' OR  field2_index = '1'</pre><p>
        This case is optimized. See
        <a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.4. Index Merge Optimization">Section 8.2.1.4, “Index Merge Optimization”</a>.
      </p><p>
        You can also solve the problem efficiently by using a
        <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a> that combines the output of
        two separate <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements.
        See <a class="xref" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax">Section 13.2.9.4, “<code class="literal">UNION</code> Syntax”</a>.
      </p><p>
        Each <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> searches only one key
        and can be optimized:
      </p><pre class="programlisting">SELECT field1_index, field2_index
    FROM test_table WHERE field1_index = '1'
UNION
SELECT field1_index, field2_index
FROM test_table WHERE field2_index = '1';</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="calculating-days"></a>3.6.8. Calculating Visits Per Day</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7758144"></a><a class="indexterm" name="idp7759216"></a><a class="indexterm" name="idp7760288"></a><a class="indexterm" name="idp7761376"></a><p>
        The following example shows how you can use the bit group
        functions to calculate the number of days per month a user has
        visited a Web page.
      </p><pre class="programlisting">CREATE TABLE t1 (year YEAR(4), month INT(2) UNSIGNED ZEROFILL,
             day INT(2) UNSIGNED ZEROFILL);
INSERT INTO t1 VALUES(2000,1,1),(2000,1,20),(2000,1,30),(2000,2,2),
            (2000,2,23),(2000,2,23);</pre><p>
        The example table contains year-month-day values representing
        visits by users to the page. To determine how many different
        days in each month these visits occur, use this query:
      </p><pre class="programlisting">SELECT year,month,BIT_COUNT(BIT_OR(1&lt;&lt;day)) AS days FROM t1
       GROUP BY year,month;</pre><p>
        Which returns:
      </p><pre class="programlisting">+------+-------+------+
| year | month | days |
+------+-------+------+
| 2000 |    01 |    3 |
| 2000 |    02 |    2 |
+------+-------+------+</pre><p>
        The query calculates how many different days appear in the table
        for each year/month combination, with automatic removal of
        duplicate entries.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-auto-increment"></a>3.6.9. Using <code class="literal">AUTO_INCREMENT</code></h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7770112"></a><a class="indexterm" name="idp7771184"></a><a class="indexterm" name="idp7772256"></a><p>
        The <code class="literal">AUTO_INCREMENT</code> attribute can be used to
        generate a unique identity for new rows:
      </p><pre class="programlisting">CREATE TABLE animals (
     id MEDIUMINT NOT NULL AUTO_INCREMENT,
     name CHAR(30) NOT NULL,
     PRIMARY KEY (id)
);

INSERT INTO animals (name) VALUES
    ('dog'),('cat'),('penguin'),
    ('lax'),('whale'),('ostrich');

SELECT * FROM animals;</pre><p>
        Which returns:
      </p><pre class="programlisting">+----+---------+
| id | name    |
+----+---------+
|  1 | dog     |
|  2 | cat     |
|  3 | penguin |
|  4 | lax     |
|  5 | whale   |
|  6 | ostrich |
+----+---------+</pre><p>
        No value was specified for the <code class="literal">AUTO_INCREMENT</code>
        column, so MySQL assigned sequence numbers automatically. You
        can also explicitly assign <code class="literal">NULL</code> or 0 to the
        column to generate sequence numbers.
      </p><p>
        You can retrieve the most recent
        <code class="literal">AUTO_INCREMENT</code> value with the
        <a class="link" href="functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a> SQL function or
        the <a class="link" href="connectors-apis.html#mysql-insert-id" title="22.8.7.37. mysql_insert_id()"><code class="literal">mysql_insert_id()</code></a> C API
        function. These functions are connection-specific, so their
        return values are not affected by another connection which is
        also performing inserts.
      </p><p>
        Use the smallest integer data type for the
        <code class="literal">AUTO_INCREMENT</code> column that is large enough to
        hold the maximum sequence value you will need. When the column
        reaches the upper limit of the data type, the next attempt to
        generate a sequence number fails. Use the
        <code class="literal">UNSIGNED</code> attribute if possible to allow a
        greater range. For example, if you use
        <a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">TINYINT</code></a>, the maximum permissible
        sequence number is 127. For
        <a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">TINYINT
        UNSIGNED</code></a>, the maximum is 255. See
        <a class="xref" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT">Section 11.2.1, “Integer Types (Exact Value) - <code class="literal">INTEGER</code>,
        <code class="literal">INT</code>, <code class="literal">SMALLINT</code>,
        <code class="literal">TINYINT</code>, <code class="literal">MEDIUMINT</code>,
        <code class="literal">BIGINT</code>”</a> for the ranges of all the
        integer types.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          For a multiple-row insert,
          <a class="link" href="functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a> and
          <a class="link" href="connectors-apis.html#mysql-insert-id" title="22.8.7.37. mysql_insert_id()"><code class="literal">mysql_insert_id()</code></a> actually
          return the <code class="literal">AUTO_INCREMENT</code> key from the
          <span class="emphasis"><em>first</em></span> of the inserted rows. This enables
          multiple-row inserts to be reproduced correctly on other
          servers in a replication setup.
</p>
</div>
<p>
        If the <code class="literal">AUTO_INCREMENT</code> column is part of
        multiple indexes, MySQL generates sequence values using the
        index that begins with the <code class="literal">AUTO_INCREMENT</code>
        column, if there is one. For example, if the
        <code class="literal">animals</code> table contained indexes
        <code class="literal">PRIMARY KEY (grp, id)</code> and <code class="literal">INDEX
        (id)</code>, MySQL would ignore the <code class="literal">PRIMARY
        KEY</code> for generating sequence values. As a result, the
        table would contain a single sequence, not a sequence per
        <code class="literal">grp</code> value.
      </p><p>
        To start with an <code class="literal">AUTO_INCREMENT</code> value other
        than 1, set that value with <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a> or <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
        like this:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER TABLE tbl AUTO_INCREMENT = 100;</code></strong>
</pre>
<h4><a name="idp7803424"></a>
        InnoDB Notes
</h4>
<p>
        For <code class="literal">InnoDB</code> tables, be careful if you modify
        the column containing the auto-increment value in the middle of
        a sequence of <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements.
        For example, if you use an <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>
        statement to put a new, larger value in the auto-increment
        column, a subsequent <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> could
        encounter a <span class="quote">“<span class="quote">Duplicate entry</span>”</span> error. The test
        whether an auto-increment value is already present occurs if you
        do a <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> followed by more
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements, or when you
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> the transaction, but not
        after an <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> statement.
</p>
<h4><a name="idp7811760"></a>
        MyISAM Notes
</h4>
<p>
        For <code class="literal">MyISAM</code> tables, you can specify
        <code class="literal">AUTO_INCREMENT</code> on a secondary column in a
        multiple-column index. In this case, the generated value for the
        <code class="literal">AUTO_INCREMENT</code> column is calculated as
        <a class="link" href="functions.html#function_max"><code class="literal">MAX(<em class="replaceable"><code>auto_increment_column</code></em>)
        + 1 WHERE
        prefix=<em class="replaceable"><code>given-prefix</code></em></code></a>. This
        is useful when you want to put data into ordered groups.
      </p><pre class="programlisting">CREATE TABLE animals (
    grp ENUM('fish','mammal','bird') NOT NULL,
    id MEDIUMINT NOT NULL AUTO_INCREMENT,
    name CHAR(30) NOT NULL,
    PRIMARY KEY (grp,id)
) ENGINE=MyISAM;

INSERT INTO animals (grp,name) VALUES
    ('mammal','dog'),('mammal','cat'),
    ('bird','penguin'),('fish','lax'),('mammal','whale'),
    ('bird','ostrich');

SELECT * FROM animals ORDER BY grp,id;</pre><p>
        Which returns:
      </p><pre class="programlisting">+--------+----+---------+
| grp    | id | name    |
+--------+----+---------+
| fish   |  1 | lax     |
| mammal |  1 | dog     |
| mammal |  2 | cat     |
| mammal |  3 | whale   |
| bird   |  1 | penguin |
| bird   |  2 | ostrich |
+--------+----+---------+</pre><p>
        In this case (when the <code class="literal">AUTO_INCREMENT</code> column
        is part of a multiple-column index),
        <code class="literal">AUTO_INCREMENT</code> values are reused if you
        delete the row with the biggest
        <code class="literal">AUTO_INCREMENT</code> value in any group. This
        happens even for <code class="literal">MyISAM</code> tables, for which
        <code class="literal">AUTO_INCREMENT</code> values normally are not
        reused.
</p>
<h4><a name="idp7823200"></a>
        Further Reading
</h4>
<p>
        More information about <code class="literal">AUTO_INCREMENT</code> is
        available here:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            How to assign the <code class="literal">AUTO_INCREMENT</code>
            attribute to a column: <a class="xref" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax">Section 13.1.17, “<code class="literal">CREATE TABLE</code> Syntax”</a>, and
            <a class="xref" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax">Section 13.1.7, “<code class="literal">ALTER TABLE</code> Syntax”</a>.
          </p></li><li class="listitem"><p>
            How <code class="literal">AUTO_INCREMENT</code> behaves depending on
            the <a class="link" href="server-administration.html#sqlmode_no_auto_value_on_zero"><code class="literal">NO_AUTO_VALUE_ON_ZERO</code></a>
            SQL mode: <a class="xref" href="server-administration.html#server-sql-mode" title="5.1.7. Server SQL Modes">Section 5.1.7, “Server SQL Modes”</a>.
          </p></li><li class="listitem"><p>
            How to use the
            <a class="link" href="functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a> function to
            find the row that contains the most recent
            <code class="literal">AUTO_INCREMENT</code> value:
            <a class="xref" href="functions.html#information-functions" title="12.14. Information Functions">Section 12.14, “Information Functions”</a>.
          </p></li><li class="listitem"><p>
            Setting the <code class="literal">AUTO_INCREMENT</code> value to be
            used: <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">AUTO_INCREMENT</code> and replication:
            <a class="xref" href="replication.html#replication-features-auto-increment" title="16.4.1.1. Replication and AUTO_INCREMENT">Section 16.4.1.1, “Replication and <code class="literal">AUTO_INCREMENT</code>”</a>.
          </p></li><li class="listitem"><p>
            Server-system variables related to
            <code class="literal">AUTO_INCREMENT</code>
            (<a class="link" href="replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a>
            and <a class="link" href="replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a>)
            that can be used for replication:
            <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apache"></a>3.7. Using MySQL with Apache</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp7843152"></a><p>
      There are programs that let you authenticate your users from a
      MySQL database and also let you write your log files into a MySQL
      table.
    </p><p>
      You can change the Apache logging format to be easily readable by
      MySQL by putting the following into the Apache configuration file:
    </p><pre class="programlisting">LogFormat \
        "\"%h\",%{%Y%m%d%H%M%S}t,%&gt;s,\"%b\",\"%{Content-Type}o\",  \
        \"%U\",\"%{Referer}i\",\"%{User-Agent}i\""</pre><p>
      To load a log file in that format into MySQL, you can use a
      statement something like this:
    </p><pre class="programlisting">LOAD DATA INFILE '<em class="replaceable"><code>/local/access_log</code></em>' INTO TABLE <em class="replaceable"><code>tbl_name</code></em>
FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"' ESCAPED BY '\\'
</pre><p>
      The named table should be created to have columns that correspond
      to those that the <code class="literal">LogFormat</code> line writes to the
      log file.
</p>
</div>

</div>
<div class="copyright-footer">
    Copyright © 1997, 2013, Oracle and/or its affiliates. All
    rights reserved.
<a href="preface.html#legalnotice">法律信息</a>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="installing.html">上一章</a></td>
<td width="20%" align="center"><a accesskey="u" href="">页首</a></td>
<td width="40%" align="right"> <a accesskey="n" href="programs.html">下一章</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">第 2 章  安装和升级MySQL</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">首页</a></td>
<td width="40%" align="right" valign="top">第 4 章 MySQL相关程序</td>
</tr>
</table>
</div>
</body>
</html>
