<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 3. Tutorial</title>
<link rel="stylesheet" href="mvl.css" type="text/css" />
<meta name="generator" content="DocBook XSL Stylesheets V1.69.1 + chunker.py v1.9.1" />
<link rel="start" href="index.html" title="{book-title}" />
<link rel="up" href="" title="" />
<link rel="prev" href="installing.html" title="Chapter 2. Installing and Upgrading MySQL" />
<link rel="next" href="programs.html" title="Chapter 4. MySQL Programs" />
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1378437679*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
       // 'This copy of the manual is more than 90 days old. We encourage you to download a ' +
       // 'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
	     '这份手册是90天前的版本,我们强烈建议你你去这里下载一个最新版本<a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">第 3 章. 教程</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="installing.html">上一章</a> </td>
<th width="60%" align="center"></th>
<td width="20%" align="right"> <a accesskey="n" href="programs.html">下一章</a></td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="tutorial"></a>第 3 章. 教程</h1>

</div>

</div>

</div>
<div class="toc">
<p><b>内容列表</b></p>
<dl>
  <dt><span class="section"><a href="tutorial.html#connecting-disconnecting">3.1. 连接和断开服务器</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#entering-queries">3.2. 输入查询</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#database-use">3.3. 创建并使用数据库</a></span></dt><dd><dl><dt><span class="section"><a href="tutorial.html#creating-database">3.3.1. 创建和选中该数据库</a></span></dt><dt><span class="section"><a href="tutorial.html#creating-tables">3.3.2. 创建表</a></span></dt><dt><span class="section"><a href="tutorial.html#loading-tables">3.3.3. 将数据装入表</a></span></dt><dt><span class="section"><a href="tutorial.html#retrieving-data">3.3.4. 从表中检索信息</a></span></dt></dl></dd><dt><span class="section"><a href="tutorial.html#getting-information">3.4. 获取数据库和表的信息</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#batch-mode">3.5. 在批处理模式下使用<span class="command"><strong>mysql</strong></span></a></span></dt>
  <dt><span class="section"><a href="tutorial.html#examples">3.6. 常见查询示例</a></span></dt>
  <dd><dl>
    <dt><span class="section"><a href="tutorial.html#example-maximum-column">3.6.1. 列的最大值</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#example-maximum-row">3.6.2. 拥有某列最大值的行</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#example-maximum-column-group">3.6.3. 列的分组最大值</a></span></dt><dt><span class="section"><a href="tutorial.html#example-maximum-column-group-row">3.6.4. 拥有某列的分组最大值的行</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#example-user-variables">3.6.5. 使用用户变量</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#example-foreign-keys">3.6.6. 使用外键</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#searching-on-two-keys">3.6.7. 根据2个键来查询</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#calculating-days">3.6.8. 计算每天的访问量</a></span></dt>
    <dt><span class="section"><a href="tutorial.html#example-auto-increment">3.6.9. 使用 <code class="literal">AUTO_INCREMENT</code></a></span></dt>
  </dl></dd><dt><span class="section"><a href="tutorial.html#apache">3.7. 和Apache一起使用MySQL</a></span></dt></dl>
</div>
<a class="indexterm" name="idp6840832"></a><a class="indexterm" name="idp6841904"></a><a class="indexterm" name="idp6843392"></a><a class="indexterm" name="idp6844880"></a>
<p>
    本章通过一个使用 <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 客户端程序来创建并使用示例数据库的教程来介绍MySQL。 <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> (我们通常会叫做<span class="quote">“<span class="quote">终端监视器</span>”</span>,或者就直接叫做
    <span class="quote">“<span class="quote">监视器</span>”</span>) 可以作为一个交互式程序,它能够连接到MySQL服务器,执行查询,查看结果集。
    <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 也可以使用批处理模式来执行预先准备好的SQL脚本文件。这两种使用<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 的方式在这章里都会提及。  </p>
<p>
    调用--help选项可以查看<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>提供的所有选项列表</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --help</code></strong>
</pre>
<p>
    本章假定 <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 客户端程序已经被安装在你的电脑上, 并且也有一个MySQL服务器可供连接使用。否则,请联系你的MySQL管理员(如果你是管理员,你需要查阅相关手册, 
    <a class="xref" href="server-administration.html" title="Chapter 5. MySQL Server Administration">第 5 章 5, <i>MySQL服务器管理</i></a>.)  </p>
<p>
  本周描述了建立和使用一个数据库的全过程。如果你只对访问已有的数据库感兴趣,你可以跳过描述建立数据库和表的章节。</p>
<p>
    由于本章只是个教程,省略了很多细节内容,你可以通过查阅手册来获取相关主题的详细内容。</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="connecting-disconnecting"></a>3.1. 连接和断开服务器</h2>
</div>
</div>
</div>
<a class="indexterm" name="idp6860560"></a><a class="indexterm" name="idp6862048"></a><a class="indexterm" name="idp6863536"></a><a class="indexterm" name="idp6865024"></a>
<p>
      当调用 <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>来连接服务器，你需要提供一个MySQL用户名，很可能还需要一个密码；如果MySQL服务器端没有安装在你登录的机器上,你还需要知道MySQL服务器的主机名。联系你的管理员来得到连接服务器的相关选项(包括：主机名，用户名，密码等)。当你知道这些正确的选项后，你将以下面方式来连接MySQL服务器：
    </p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -h <em class="replaceable"><code>host</code></em> -u <em class="replaceable"><code>user</code></em> -p</code></strong>
Enter password: <strong class="userinput"><code>********</code></strong>
</pre>
<p>
      <code class="literal">host</code>和<code class="literal">user</code> 分别代表你的要连接的MySQL服务器主机名和MySQL用户名，将它们替换成正确的设置值。  <code class="literal">********</code> 代表你的密码，在<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 客户端显示<code class="literal">&quot;Enter
      password:&quot;</code>提示符时候输入。.    </p>
<p>
      如果输入正确，你将会看到 <code class="literal">&quot;mysql&gt;&quot;</code> 提示符后的一些介绍信息</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -h <em class="replaceable"><code>host</code></em> -u <em class="replaceable"><code>user</code></em> -p</code></strong>
Enter password: <strong class="userinput"><code>********</code></strong>
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 25338 to server version: 5.6.15-standard

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt;
</pre>
<p><code class="literal">"mysql&gt;"</code>提示符告诉你<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>已经准备好了,等待你的命令输入。  </p>
<p>
      如果你登录本机运行的MySQL服务器，你可以省略主机名, 连接命令如下:</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u <em class="replaceable"><code>user</code></em> -p</code></strong>
</pre>
<p>
      当你尝试登录MySQL时, 你得到了以下错误信息：y<span class="errortext">ERROR 2002 (HY000): Can't connect to local MySQL server
      through socket '/tmp/mysql.sock' (2)</span>, 这意味着MySQL服务器守护进程(Unix平台)没有在运行或者MySQL服务(Windows平台)没有启动。联系管理员或者根据你的操作系统来查阅相关章节
      <a class="xref" href="installing.html" title="Chapter 2. Installing and Upgrading MySQL">(第 2 章 <i>安装和升级MySQlL</i></a>   </p>
<p>
      当你遇到其它的登录问题后,你可以查阅章节<a class="xref" href="error-handling.html#common-errors" title="C.5.2. Common Errors When Using MySQL Programs">(Section C.5.2, “使用MySQL程序的常见错误”)</a>来解决。</p>
<p>
    一些MySQL安装允许匿名(未命名)用户在本机登录MySQL服务器。如果是这样,你调用<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>无需其它任何选项就可以连接MySQL服务器：</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql</code></strong>
</pre>
    <p>
      在你连接成功后，你可以在 <code class="literal">&quot;mysql&gt;&quot;</code>提示符下输入<code class="literal">QUIT</code> (或<code class="literal">\q</code>)来断开连接</p>
    <pre class="programlisting">mysql&gt; <strong class="userinput"><code>QUIT</code></strong>
Bye
</pre>
    <p>
    在Unix平台上，你也可以使用Control+D来断开MySQL连接。</p>
    <p>
      下面章节的大多数例子都假定你已经连接上MySQL服务器了，由<code class="literal">"mysql&gt;""</code> 提示符来标明。
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="entering-queries"></a>3.2. 输入查询</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp6896992"></a><a class="indexterm" name="idp6898480"></a><a class="indexterm" name="idp6899968"></a>
<p>
      正如先前章节所说的，确保你已经连接上了MySQL服务器，连接上数服务器并不会选中某个数据库,本章内容仅连接就足够使用了。知道如何发起查询比马上学习创建表，给表装载数据，表中检索数据等知识更重要。本章节描述了输入命令的基本原则，通过尝试一些查询可以让你熟悉了解<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>是如何工作的。   </p>
<p>
      这是个询问MySQL服务器来告诉你它的版本号和当前日期的简单命令。在<code class="literal">mysql&gt;</code>提示符下输入以下命令并敲下回车：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT VERSION(), CURRENT_DATE;</code></strong>
+--------------+--------------+
| VERSION()    | CURRENT_DATE |
+--------------+--------------+
| 5.6.1-m4-log | 2010-08-06   |
+--------------+--------------+
1 row in set (0.01 sec)
mysql&gt;
</pre>
    <p>
      这个查询说明了<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>一些特点：
      
</p>
    <div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
          一个命令通常包含着一条分号结尾的SQL语句。(有些语句例外不需要分号，例如刚才说的<code class="literal">QUIT</code>语句，后面我们还会遇到其它这样的语句)        </p>
</li><li class="listitem"><p>用户发出一个命令后，<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>把命令发送到服务器去执行并返回结果集,然后打印出一个新的<code class="literal">"mysql&gt;"</code>提示符来表明它又准备好接受其它命令。
        </p></li><li class="listitem">
          <p>
          <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>用表格(行和列)来输出查询结果。第一行显示每列的标签，剩下行就是查询结果。通常列标签是数取自数据库表中的字段名。如果你检索的是表达式而非表字段(就和上面例子一样)，<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>就用表达式自身来标识列。</p>
        </li><li class="listitem">
          <p>
          <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a> 会显示查询返回行数和查询执行时间，它提供了服务器的性能的一个大致概念。这个值是不精确的，因为它表示的是时钟时间,而非CPU或者机器时间，他手诸如系统负载和网络延迟的影响。(为了简洁起见,本章的其他例子我们可能会不显示返回行数)</p>
        </li></ul>
</div>
<p>
    关键字不区分大小写，下面的查询等效：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT VERSION(), CURRENT_DATE;</code></strong>
mysql&gt; <strong class="userinput"><code>select version(), current_date;</code></strong>
mysql&gt; <strong class="userinput"><code>SeLeCt vErSiOn(), current_DATE;</code></strong>
</pre>
<p>
      下面是另外一类的查询，它演示了<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>可以作为简单的计算器来使用   </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT SIN(PI()/4), (4+1)*5;</code></strong>
+------------------+---------+
| SIN(PI()/4)      | (4+1)*5 |
+------------------+---------+
| 0.70710678118655 |      25 |
+------------------+---------+
1 row in set (0.02 sec)
</pre>
<p>
    到目前为止，都是非常短的单行查询语句。你可以在一行中输入多条语句，只需在每个语句后面以;来分隔</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT VERSION(); SELECT NOW();</code></strong>
+--------------+
| VERSION()    |
+--------------+
| 5.6.1-m4-log |
+--------------+
1 row in set (0.00 sec)
+---------------------+
| NOW()               |
+---------------------+
| 2010-08-06 12:17:13 |
+---------------------+
1 row in set (0.00 sec)
</pre>
<p>
      一个命令不必全部输入在一行里，较长的命令可以输入在多行里。<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a> 会根据语句中的&quot;;&quot;来判断语句是否结束，而不是根据一行的结尾来判断。(换句话说<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>接受任意格式的输入：它会暂存输入的行而不直到遇到&quot;;&quot;才会执行暂存的语句)    </p>
<p>
    这是个简单的多行语句： </p>
    <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT</code></strong>
    -&gt; <strong class="userinput"><code>USER()</code></strong>
    -&gt; <strong class="userinput"><code>,</code></strong>
    -&gt; <strong class="userinput"><code>CURRENT_DATE;</code></strong>
+---------------+--------------+
| USER()        | CURRENT_DATE |
+---------------+--------------+
| jon@localhost | 2010-08-06   |
+---------------+--------------+
</pre>
    <p>
      在上面的例子中，注意到当你输入多行查询语句的第一行后， <code class="literal">mysql&gt;</code>提示符变成了<code class="literal">-&gt;</code>。
    这就是<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>语句还没有输完,它在等待接下来的输入。提示符是个很好的朋友，因为它提供了有价值的反馈。如果你接受了它的反馈，你就会懂得<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>在等待什么。</p>
    <p>
      如果你决定不执行正在输入的命令，输入<code class="literal">\c</code>就可以取消它：
    </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT</code></strong>
    -&gt; <strong class="userinput"><code>USER()</code></strong>
    -&gt; <strong class="userinput"><code>\c</code></strong>
mysql&gt;
</pre>
<p>
      这里你可以看到,当输入<code class="literal">\c</code>后，提示符变回为 <code class="literal">mysql&gt;</code> ，它告诉我们t <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>已经准备好来接收新的命令。</p>
<p>
      下面表格列出了每个你可能会看到的提示符，并简述了这些提示符在<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>中锁代表的含义
</p>
<a class="indexterm" name="idp6944880"></a>
<div class="informaltable">
<table summary="This table lists MySQL prompts and describes the meaning
        of each." border="1"><colgroup><col><col></colgroup><thead><tr>
  <th scope="col">提示符</th>
  <th scope="col">含义</th>
</tr></thead><tbody><tr><td scope="row"><code class="literal">mysql&gt;</code></td>
<td>准备好接收新命令。</td>
</tr><tr><td scope="row"><code class="literal">-&gt;</code></td>
<td>等待多行命令的下一行内容。</td>
</tr><tr><td scope="row"><code class="literal">'&gt;</code></td>
<td>等待下一行，等待以单引号(<span class="quote">“<code class="literal">'</code>”</span>)开始的字符串的结束。</td>
</tr><tr><td scope="row"><code class="literal">"&gt;</code></td>
<td>等待下一行，等待以双引号(<span class="quote">“<code class="literal">&quot;</code>”</span>)开始的字符串的结束。</td>
</tr><tr><td scope="row"><code class="literal">`&gt;</code></td>
<td>等待下一行，等待反斜点(<span class="quote">“<code class="literal">`</code>”</span>)开始的标识符的结束。</td>
</tr><tr><td scope="row"><code class="literal">/*&gt;</code></td>
<td>等待下一行，等待 <code class="literal">/*</code>开始的注释的结束。</td>
</tr></tbody></table>
</div>
<p>
      你打算在一个单行里面输入一个命令时，偶尔会忘记输入;来结束语句，这时意外的变成多行语句。这种情况下， <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>
      会继续等待下一步输入：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER()</code></strong>
    -&gt;
</pre>
<p>
      如果出现这种情况(你认为你已经输完了语句，但它只返回一个<code class="literal">-&gt;</code> prompt)提示符)，很可能是 <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>在等待";"。如果你没有注意到提示符所代表的意思，你将呆坐在那里直到你意识到这个。然后输入&quot;;&quot;来结束语句，<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>来执行它： </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER()</code></strong>
    -&gt; <strong class="userinput"><code>;</code></strong>
+---------------+
| USER()        |
+---------------+
| jon@localhost |
+---------------+
</pre>
<p><code class="literal">'&gt;</code> 和 <code class="literal">"&gt;</code> 提示符只出现在字符串收集过程中(提示MySQL在等待字符串的结束)。在MySQL中， <span class="quote">“<code class="literal">'</code>”</span>或者<span class="quote">“<code class="literal">&quot;</code>”字符都可以用作字符串限定符</span> (比如：
      <code class="literal">'hello'</code>和<code class="literal">"goodbye"</code>)，
      <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>允许跨越多行的字符串。当看到  <code class="literal">'&gt;</code>或者
      <code class="literal">"&gt;</code> 提示符时， 它表明已经输入以<span class="quote">“<code class="literal">'</code>”</span>或<span class="quote">“<code class="literal">&quot;</code>”字符</span>开头的一行字符串了，但还没有输入终止字符串的匹配引号。下面是一个由于粗心大意而忘记输入引号的例子：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM my_table WHERE name = 'Smith AND age &lt; 30;</code></strong>
    '&gt;
</pre>
<p>假如你输入了s <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>语句，然后敲下回车键来等待结果，然而什么结果都没有出现，除了出现了<code class="literal">'&gt;</code> 提示符。它告诉你<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a> 还在等待余下的未结束的字符串内容。(有没看到语句哪里错了，是字符串<code class="literal">'Smith</code>缺失了另外一个单引号') </p>
<p>
      遇到这种情况，你该怎么做？最简单的方式就是取消这个命令。但你不能直接输入<code class="literal">\c</code>，因为<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>还在等待字符串的结束。正确的方法是先输入引号(<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>认为字符串已经结束了),然后再输入<code class="literal">\c</code>：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM my_table WHERE name = 'Smith AND age &lt; 30;</code></strong>
    '&gt; <strong class="userinput"><code>'\c</code></strong>
mysql&gt;
</pre>
<p>
      提示符变回<code class="literal">mysql&gt;</code>,
      表明<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>已经准备好接收新命令。</p>
<p><code class="literal">`&gt;</code> 提示符和<code class="literal">'&gt;</code>、<code class="literal">"&gt;</code> 提示符类似, 它你已经开始但没有结束以`&gt; 开始的识别符。</p>
<p>知道<code class="literal">'&gt;</code>,
      <code class="literal">"&gt;</code>, 和 <code class="literal">`&gt;</code> 提示符是非常重要的，因为当你错误输入了一个未终止的字符，任何后面你输入的行都将被<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql客户端</strong></span></a>忽略,即使你输入<code class="literal">QUIT</code>也会被忽略。这个可能比较让人困惑，可能在你想取消当前命令前还不知道要输入输入终止引号 。 </p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="database-use"></a>3.3. 创建并使用数据库</h2>

</div>

</div>

</div>
<div class="toc">
<dl>
  <dt><span class="section"><a href="tutorial.html#creating-database">3.3.1. 创建和选择该数据库</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#creating-tables">3.3.2. 创建表</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#loading-tables">3.3.3. 将数据装入表</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#retrieving-data">3.3.4. 从表中检索信息</a></span></dt>
</dl>
</div>
<a class="indexterm" name="idp7004144"></a><a class="indexterm" name="idp7005632"></a><a class="indexterm" name="idp7007120"></a>
<p>
    当你知道了如何输入命令，便可以访问数据库了。</p>
<p>
      假设你家里有一些宠物(你家是个&quot;动物园&quot;)，并且你想跟踪它们的各种信息，你可以创建一些表来记录你得数据并根据你的需要来载入它们。接着你可以从表中检索数据来回答动物不同种类的问题。本章显示如何完成以下操作。  (your menagerie)</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
          创建一个数据库
        </p>
</li><li class="listitem">
  <p>
          创建一个表</p>
</li><li class="listitem">
  <p>
          装载数据到表中</p>
</li><li class="listitem">
  <p>
          用多种方法从表中检索数据。</p>
</li><li class="listitem">
          <p>
          使用多个表</p>
        </li></ul>
</div>
<p>
      动物园数据库非常简单(特意的)，但这个简单数据库不难想象成为现实生活场景 。例如，一个农夫可以使用这样的数据库来追踪家畜，或者一个兽医来追踪病畜记录＋ or by a
      veterinarian to keep track of patient records. 从MySQL网站上可以获取到后面章节用到的包含一些样例查询和数据的动物园分发版示例数据库。在<a class="ulink" href="http://dev.mysql.com/doc/" target="_top">http://dev.mysql.com/doc/</a>网站有压缩tar包和zip两种格式的分发版可以下载</p>
<p>使用<a class="link" href="sql-syntax.html#show" title="13.7.5. SHOW Syntax"><code class="literal">SHOW</code></a> 命令可以罗列服务器上存在哪些数据库： </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW DATABASES;</code></strong>
+----------+
| Database |
+----------+
| mysql    |
| test     |
| tmp      |
+----------+
</pre>
<p><code class="literal">mysql</code>数据库码数了用户的访问权限。<code class="literal">test</code>数据库一般是用户的测试场所。
    </p>
<p>
      你机器上的显示的数据库列表可能与什么结果不相同；如果你没有<a class="link" href="sql-syntax.html#show-databases" title="13.7.5.15. SHOW DATABASES Syntax"><code class="literal">SHOW DATABASES</code></a>权限,使用<a class="link" href="sql-syntax.html#show-databases" title="13.7.5.15. SHOW DATABASES Syntax"><code class="literal">SHOW DATABASES</code></a>也无法显示出数据库列表，详情参见 <a class="xref" href="sql-syntax.html#show-databases" title="13.7.5.15. SHOW DATABASES Syntax">13.7.5.15 节, “<code class="literal">SHOW DATABASES</code>语法”</a>.    </p>
<p>如果存在<code class="literal">test</code>数据库，尝试去访问它：    </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>USE test</code></strong>
Database changed
</pre>
<p>
      <a class="link" href="sql-syntax.html#use" title="13.8.4. USE Syntax"><code class="literal">USE</code></a>和<code class="literal">QUIT</code>类似，并不需要分号。(如果你喜欢，你可以使用分号来结束这样的语句，这是无害的) 
      <a class="link" href="sql-syntax.html#use" title="13.8.4. USE Syntax"><code class="literal">USE</code></a> 语句使用上也是特殊的:必须写在一行语句内。</p>
<p>
      你可以在后面的例子中使用<code class="literal">test</code>数据库(只要你能访问)，但是你在test数据库常见的任何对象多可以被其他可以访问test数据库的人删除掉。所以，你最好向你的MySQL管理员允许你使用自己的数据库。
      Su假使你想调用<code class="literal">menagerie</code>数据库。
      MySQL管理得执行以下语句来授权：    </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>GRANT ALL ON menagerie.* TO 'your_mysql_name'@'your_client_host';</code></strong>
</pre>
<p><code class="literal">your_mysql_name</code> 就是你的MySQL登录帐户，i<code class="literal">your_client_host</code> 就是你用来登录服务器的主机。</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="creating-database"></a>3.3.1. 创建并使用数据库</h3>
</div>
</div>
</div>
<a class="indexterm" name="idp7036320"></a><a class="indexterm" name="idp7037808"></a>
<p>
      如果管理员在设置你的权限时候给你创建了数据库，你可以直接使用它，否则你得自己创建一个：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE DATABASE menagerie;</code></strong>
</pre>
<p>
        在Unix平台下，数据库名称是区分大小写的(和SQL关键字不同)，所以你必须使用<code class="literal">menagerie</code>来访问你的数据库，而不同用诸如
        <code class="literal">Menagerie</code>，<code class="literal">MENAGERIE</code>，或者其它名字。这个对表名也一样。(在Windows平台，这个限制不存在，尽管在一个查询里必须以同样的大小写来引用数据库和表。但是,由于种种原因，最好还是使用和建立数据库一样的大小写)</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">注意</div>
<p xmlns="">
          如果你在建库时遇到诸如<span class="errortext">ERROR 1044 (42000):
          Access denied for user 'monty'@'localhost' to database
          'menagerie'</span>的错误，这意味着你的帐户没有这个操作的权限，你可以联系管理员或者参见 <a class="xref" href="security.html#privilege-system" title="6.2. The MySQL Access Privilege System">6.2, “MySQL访问权限系统”</a>。</p>
</div>
<p>
      创建数据库后并没有选择使用它，你必须明确操作，使<code class="literal">menagerie</code>成为当前数据库必须使用以下命</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>USE menagerie</code></strong>
Database changed
</pre>
<p>
        你的数据库只需要创建一次，但是你必须每次开始<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>会话时选择使用它。你可以根据上面的例子使用<a class="link" href="sql-syntax.html#use" title="13.8.4. USE Syntax"><code class="literal">USE</code></a>语句来实现。或者你可以在调用<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>时候，通过命令行来选择数据库， 只需要在提供的连接参数后面指定数据库名就可以了。例如：</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -h <em class="replaceable"><code>host</code></em> -u <em class="replaceable"><code>user</code></em> -p menagerie</code></strong>
Enter password: <strong class="userinput"><code>********</code></strong>
</pre>
<div xmlns="http://www.w3.org/1999/xhtml" class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
重要提示
</div>
<p xmlns="">
          <code class="literal">menagerie</code>在刚才显示的命令行里不是你的密码，如果你想在<code class="literal">-p</code>属性后面提供你的密码，你必须保证后面无空格(例如这样<code class="literal">-pmypassword</code>,，而不是<code class="literal">-p
          mypassword</code>)。 但是，不建议在命令行里输入密码，因为这样容易被系统其他的登陆用户窥探到。</p>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">注意</div>
<p xmlns="">
          你可以使用<a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
          <a class="link" href="functions.html#function_database"><code class="literal">DATABASE()</code></a>.语句来查看当前你在用哪个数据库</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="creating-tables"></a>3.3.2. 创建一个表</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7063600"></a><a class="indexterm" name="idp7065088"></a>
<p>
        创建数据库很简单， <a class="link" href="sql-syntax.html#show-tables" title="13.7.5.38. SHOW TABLES Syntax"><code class="literal">SHOW TABLES</code></a> 可以看出数据库目前是空的：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
Empty set (0.00 sec)
</pre>
<p>
        比较难的是如何设计决定数据库的结构：你需要那些表，每个表需要哪些字段。      </p>
<p>
        你需要一个包含着所有宠物数据的表。它可以称为<code class="literal">pet</code><code class="literal"></code>表，它至少包含着每个动物的名字。因为这些动物的名字不是我们最感兴趣的信息，所以这个表还需要包含其它信息。比如你的家庭中超过一个人饲养着宠物，你可能需要罗列每个宠物的主人。你很可能需要记录其它的基本描述信息，例如它们的种类和性别。</p>
<p>
        年龄呢?这可能很有趣，但是它存储到数据库中不是个好主意。年龄会随着时间流逝而改变，这意味着你得经常更新你的记录。而保存一个固定值例如出生日期是个较好的方式。当你需要年龄时，你可以通过计算它的出生日期和当前日期的差额来计算它。MySQL提供了一些函数用于日期的计算，因此计算年龄并不复杂。保存出生日期还有其它好处：</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
            你可以使用这个数据库来实现生成宠物的生日提醒。(可能你觉得这类查询有点傻，但这个和从商务数据库中找出下月或者下周生日的客户来发送祝福是同一类型的问题，都属于计算机辅助个人联系功能)          </p>
</li><li class="listitem">
  <p>
            你可以根据相关日期而不是当前日期来计算年龄。例如，你可以保存死亡日期到数据库里，然后很容易计算出宠物们去世时候的年龄。</p>
</li></ul>
</div>
<p>
      你可以想到pet表中其它类型的有用信息，但以下内容足够使用了，如名字，主人，种类，性别，生日和死亡日期。</p>
<p>
      Use  <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> 语句详细说明了你的表的布局：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE pet (name VARCHAR(20), owner VARCHAR(20),</code></strong>
    -&gt; <strong class="userinput"><code>species VARCHAR(20), sex CHAR(1), birth DATE, death DATE);</code></strong>
</pre>
<p>
        <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>很适合用于<code class="literal">name</code>，<code class="literal">owner</code>，和
        <code class="literal">species</code>这些字段，因为这些字段值长度都不确定。这些字段长度需要定义成一样，也不需要都定义成 <code class="literal">20</code>。你可以选择<code class="literal">1</code>到<code class="literal">65535</code>之间任一长度，选择一个最合理的值。如果你选择的值不合适，后来需要更长的字段， MySQL提供了 <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> 语句来修改字段长度。</p>
<p>
        多种类型都可以用作动物性别字段，比如 <code class="literal">'m'</code>和<code class="literal">'f'</code>，也可以使用<code class="literal">'male'</code>和<code class="literal">'female'</code>。使用单字符<code class="literal">'m'</code>和<code class="literal">'f'</code>来表示性别是最简单的.      </p>
<p><code class="literal">birth</code>和<code class="literal">death</code>字段很明显应该使用<a class="link" href="data-types.html#datetime" title="11.3.1. The DATE, DATETIME, and TIMESTAMP Types"><code class="literal">DATE</code></a>数据类型。</p>
<p>
        一旦你创建了表，<a class="link" href="sql-syntax.html#show-tables" title="13.7.5.38. SHOW TABLES Syntax"><code class="literal">SHOW
        TABLES</code></a> 将会产生一些输出：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
+---------------------+
| Tables in menagerie |
+---------------------+
| pet                 |
+---------------------+
</pre>
<p>
        验证创建的表是否符合预期，可以使用 <a class="link" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a>语句：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>DESCRIBE pet;</code></strong>
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| name    | varchar(20) | YES  |     | NULL    |       |
| owner   | varchar(20) | YES  |     | NULL    |       |
| species | varchar(20) | YES  |     | NULL    |       |
| sex     | char(1)     | YES  |     | NULL    |       |
| birth   | date        | YES  |     | NULL    |       |
| death   | date        | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+
</pre>
<p>
      你可以随时使用<a class="link" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a> 语句，比如你忘记了表的字段名字或者字段数据类型时。</p>
<p>
        想要知道更多MySQL数据类型的信息，请参阅
        <a class="xref" href="data-types.html" title="Chapter 11. Data Types">第 11 章 <i>数据类型</i></a> 。 </p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="loading-tables"></a>3.3.3. 将数据装入表</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7104176"></a><a class="indexterm" name="idp7105664"></a><a class="indexterm" name="idp7107152"></a>
<p>
        创建表之后,你需要给它填入内容。After creating your table, you need to populate it. The
        <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA</code></a> and
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements are useful for
        this.
      </p>
<p>
        假设你创建的pet表数据如下表所示：
        (注意到MySQL中默认日期格式是<code class="literal">'YYYY-MM-DD'</code>；它可能和你平常使用的不一致)</p>
<div class="informaltable">
<table summary="This table illustrates the example of pet
records mentioned in the preceding text." border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">name</th><th scope="col">owner</th><th scope="col">species</th><th scope="col">sex</th><th scope="col">birth</th><th scope="col">death</th></tr></thead><tbody><tr><td scope="row">Fluffy</td><td>Harold</td><td>cat</td><td>f</td><td>1993-02-04</td><td> </td></tr><tr><td scope="row">Claws</td><td>Gwen</td><td>cat</td><td>m</td><td>1994-03-17</td><td> </td></tr><tr><td scope="row">Buffy</td><td>Harold</td><td>dog</td><td>f</td><td>1989-05-13</td><td> </td></tr><tr><td scope="row">Fang</td><td>Benny</td><td>dog</td><td>m</td><td>1990-08-27</td><td> </td></tr><tr><td scope="row">Bowser</td><td>Diane</td><td>dog</td><td>m</td><td>1979-08-31</td><td>1995-07-29</td></tr><tr><td scope="row">Chirpy</td><td>Gwen</td><td>bird</td><td>f</td><td>1998-09-11</td><td> </td></tr><tr><td scope="row">Whistler</td><td>Gwen</td><td>bird</td><td> </td><td>1997-12-09</td><td> </td></tr><tr><td scope="row">Slim</td><td>Benny</td><td>snake</td><td>m</td><td>1996-04-29</td><td> </td></tr></tbody></table>
</div>
<p>
        因为你是从一个空表开始的，填充表的一个简单方法是创建一个文本文件，每个动物存成一行文本，然后使用一个语句将文本内容载入到表中。</p>
<p>
        你创建了<code class="filename">pet.txt</code>的文本文件，每个记录一行，它使用Tab符来分隔每个值，依照        <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>语句中的字段顺序来给值。对于不存在的值(例如未知的性别和未知的死亡日期因为动物还活着) ，你可以使用<code class="literal">NULL</code>
        值来保存。 在文本中可以使用<code class="literal">\N</code>来代替(反斜杠+大写字母N)。下面就是一个名叫Whistler的鸟的记录示例(记录中的空白就是一个Tab符)：      </p>
<pre class="programlisting">Whistler        Gwen    bird    \N      1997-12-09      \N</pre>
      <p>
      将文本文件<code class="filename">pet.txt</code>数据载入到<code class="literal">pet</code>表，需要使用以下语句：</p>
      <pre class="programlisting">mysql&gt; <strong class="userinput"><code>LOAD DATA LOCAL INFILE '/path/pet.txt' INTO TABLE pet;</code></strong>
</pre>
      <p>
        如果文本文件是在Windows平台中的文本编辑器创建的，它会使用<code class="literal">\r\n</code>作为行终止符，你需要使用以下语句来载入数据 ： </p>
      <pre class="programlisting">mysql&gt; <strong class="userinput"><code>LOAD DATA LOCAL INFILE '/path/pet.txt' INTO TABLE pet</code></strong>
    -&gt; <strong class="userinput"><code>LINES TERMINATED BY '\r\n';</code></strong>
</pre>
      <p>
        (在允许OS X的苹果电脑中，你需要使用<code class="literal">LINES TERMINATED BY '\r'</code>语句还替代)
      </p>
      <p>
        你可以<a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD
        DATA</code></a> 语句中指定分隔符和行终止符，但默认的为Tab和换行符，对本章的<code class="filename">pet.txt</code>来说默认的已经足够使用.。</p>
      <p>
        如果语句执行失败，很可能是你安装的MySQL不与使用默认值的本地文件兼容，关于如何修改请参阅<a class="xref" href="security.html#load-data-local" title="6.1.6. Security Issues with LOAD DATA LOCAL">Section 6.1.6, “<code class="literal">LOAD
      DATA LOCAL的安全问题</code>”</a>。</p>
      <p>
        假如你一次只想添加一行记录，这时该使用
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> 语句 。最简单的格式是你按照
        <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>语句的字段顺序提供每个字段的值. 假如Diane得到一只名叫 <span class="quote">“<span class="quote">Puffball.</span>”</span>的新仓鼠，你使用You
        could add a new record using 类似下面的<a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>语句来添加一条新纪录：</p>
      <pre class="programlisting">mysql&gt; <strong class="userinput"><code>INSERT INTO pet</code></strong>
    -&gt; <strong class="userinput"><code>VALUES ('Puffball','Diane','hamster','f','1999-03-30',NULL);</code></strong>
</pre>
      <p>
        注意日期和字符值都是由单引号'括起来的。在<a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>语句中你必须直接使用<code class="literal">NULL</code>来代表不存在的值，而不能像<a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA</code></a>语句使用<code class="literal">\N</code>。</p>
      <p>
        通过这个例子， 你可以看到多次输入<a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> 语句和使用单个<a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA</code></a>
        语句来初始化数据是等效的。</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="retrieving-data"></a>3.3.4. 从表中检索信息</h3>

</div>

</div>

</div>
<div class="toc">
<dl>
  <dt><span class="section"><a href="tutorial.html#selecting-all">3.3.4.1. 检索所有数据</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#selecting-rows">3.3.4.2. 检索指定行</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#selecting-columns">3.3.4.3. 检索指定列</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#sorting-rows">3.3.4.4. 排序</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#date-calculations">3.3.4.5. 日期计算</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#working-with-null">3.3.4.6. 处理<code class="literal">NULL</code>值</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#pattern-matching">3.3.4.7. 模式匹配</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#counting-rows">3.3.4.8. 行计数</a></span></dt>
  <dt><span class="section"><a href="tutorial.html#multiple-tables">3.3.4.9. 使用多个表</a></span></dt>
</dl>
</div>
<a class="indexterm" name="idp7171872"></a><a class="indexterm" name="idp7173360"></a><a class="indexterm" name="idp7174848"></a><a class="indexterm" name="idp7176336"></a>
<p><a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> 语句是用来从表中检索信息，语句的一般格式如下：</p>
<pre class="programlisting">SELECT <em class="replaceable"><code>what_to_select</code></em>
FROM <em class="replaceable"><code>which_table</code></em>
WHERE <em class="replaceable"><code>conditions_to_satisfy</code></em>;
</pre>
<p>
        <em class="replaceable"><code>what_to_select</code></em> 代表你想查看的内容 ，这个可以是一个字段列表，或者是<code class="literal">*</code>(它表示所有字段)。<span class="quote"></span>
        <em class="replaceable"><code>which_table</code></em> 代表你想检索数据的那个表。 <code class="literal">WHERE</code>子句是可选的，如果选择了该项，<em class="replaceable"><code>conditions_to_satisfy</code></em> 表示检索满足指定行所需的一个或多个条件。</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="selecting-all"></a>3.3.4.1. 检索所有数据</h4>
</div>
</div>
</div>
<p><a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>最简单的格式就是检索表中的所有数据：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet;</code></strong>
+----------+--------+---------+------+------------+------------+
| name     | owner  | species | sex  | birth      | death      |
+----------+--------+---------+------+------------+------------+
| Fluffy   | Harold | cat     | f    | 1993-02-04 | NULL       |
| Claws    | Gwen   | cat     | m    | 1994-03-17 | NULL       |
| Buffy    | Harold | dog     | f    | 1989-05-13 | NULL       |
| Fang     | Benny  | dog     | m    | 1990-08-27 | NULL       |
| Bowser   | Diane  | dog     | m    | 1979-08-31 | 1995-07-29 |
| Chirpy   | Gwen   | bird    | f    | 1998-09-11 | NULL       |
| Whistler | Gwen   | bird    | NULL | 1997-12-09 | NULL       |
| Slim     | Benny  | snake   | m    | 1996-04-29 | NULL       |
| Puffball | Diane  | hamster | f    | 1999-03-30 | NULL       |
+----------+--------+---------+------+------------+------------+
</pre>
<p>
          这种<a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>格式的语句很适用于浏览整个表。例如，在你刚刚装载初始化数据集后；你也可能想到Bowser的生日可能不正确，你查看了原始家谱发现它正确的生日是1989而不是1979。 </p>
<p>
          下面有2个方法来修正这个问题：:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>将<code class="filename">pet.txt</code> 文件中错误数据更正，然后使用<a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>和<a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA</code></a>语句来清空表并载入数据到表中：</p>
  <pre class="programlisting">mysql&gt; <strong class="userinput"><code>DELETE FROM pet;</code></strong>
mysql&gt; <strong class="userinput"><code>LOAD DATA LOCAL INFILE 'pet.txt' INTO TABLE pet;</code></strong>
</pre>
  <p>
              然而如果你按上面的做法，你需要重新输入&quot;Puffball&quot;的记录。(原始pet.txt没有它的信息)            </p>
</li><li class="listitem">
            <p>
              用一个<a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>语句可以只修正错误记录：</p>
            <pre class="programlisting">mysql&gt; <strong class="userinput"><code>UPDATE pet SET birth = '1989-08-31' WHERE name = 'Bowser';</code></strong>
</pre>
            <p><a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> 值修改有问题的记录，并需要重新载入数据。</p>
            </li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="selecting-rows"></a>3.3.4.2. 检索指定行</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7203568"></a><a class="indexterm" name="idp7205056"></a>
<p>
          看完上节内容，我们知道检索整个表是很容易的，只需要省略<a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> 语句中的<code class="literal">WHERE</code> 子句。但是通常你不需要查看整个表，特别是整个表变得非常大的时。 相反，你往往更有兴趣来回答一些具体问题，在这种情况下在您想要的信息上做些限制。让我们来看一些他们回答有关宠物问题的查询。</p>
<p>
          你可以只检索表中指定行，例如你想验证Bowser的生日所做的更改，可以使用下面语句来检索Bowser的记录：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name = 'Bowser';</code></strong>
+--------+-------+---------+------+------------+------------+
| name   | owner | species | sex  | birth      | death      |
+--------+-------+---------+------+------------+------------+
| Bowser | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+-------+---------+------+------------+------------+
</pre>
<p>
        输出内容确认了正确的年份是1989而不是1979。</p>
<p>
          字符串比较是不区分大小写的，所以你写成 <code class="literal">'bowser'</code>,
          <code class="literal">'BOWSER'</code>等都是可以的，查询结果是一样的。</p>
<p>
          你可以指定任何字段作为条件，而不仅仅是<code class="literal">name</code>字段。例如你想知道哪些动物出生在1998年之后，可以尝试<code class="literal">birth</code>字段:        </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE birth &gt;= '1998-1-1';</code></strong>
+----------+-------+---------+------+------------+-------+
| name     | owner | species | sex  | birth      | death |
+----------+-------+---------+------+------------+-------+
| Chirpy   | Gwen  | bird    | f    | 1998-09-11 | NULL  |
| Puffball | Diane | hamster | f    | 1999-03-30 | NULL  |
+----------+-------+---------+------+------------+-------+
</pre>
        <p>
        你可以使用复合条件，下面例子是找到雌性狗信息：</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE species = 'dog' AND sex = 'f';</code></strong>
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</pre>
        <p>
          之前查询使用了<a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>逻辑操作符，下面使用了
          <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a> 操作符：:        </p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE species = 'snake' OR species = 'bird';</code></strong>
+----------+-------+---------+------+------------+-------+
| name     | owner | species | sex  | birth      | death |
+----------+-------+---------+------+------------+-------+
| Chirpy   | Gwen  | bird    | f    | 1998-09-11 | NULL  |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL  |
| Slim     | Benny | snake   | m    | 1996-04-29 | NULL  |
+----------+-------+---------+------+------------+-------+
</pre>
        <p>
          <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>和<a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a> 可以混合使用，虽然<a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>的优先级高于n
          <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>，但如果你同时使用这两个操作符，建议使用括号来指明条件分组：</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE (species = 'cat' AND sex = 'm')</code></strong>
    -&gt; <strong class="userinput"><code>OR (species = 'dog' AND sex = 'f');</code></strong>
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="selecting-columns"></a>3.3.4.3. 选择指定列</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7231264"></a><a class="indexterm" name="idp7232752"></a>
<p>
          如果你不想查看表中的整行数据，就只写你感兴趣的字段的名字，中间用逗号隔开。例如，你想知道动物们的出生日期，选择 <code class="literal">name</code>和<code class="literal">birth</code>字段：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet;</code></strong>
+----------+------------+
| name     | birth      |
+----------+------------+
| Fluffy   | 1993-02-04 |
| Claws    | 1994-03-17 |
| Buffy    | 1989-05-13 |
| Fang     | 1990-08-27 |
| Bowser   | 1989-08-31 |
| Chirpy   | 1998-09-11 |
| Whistler | 1997-12-09 |
| Slim     | 1996-04-29 |
| Puffball | 1999-03-30 |
+----------+------------+
</pre>
<p>
        想查明宠物的主人，使用下面查询：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT owner FROM pet;</code></strong>
+--------+
| owner  |
+--------+
| Harold |
| Gwen   |
| Harold |
| Benny  |
| Diane  |
| Gwen   |
| Gwen   |
| Benny  |
| Diane  |
+--------+
</pre><a class="indexterm" name="idp7240064"></a>
<p>
          注意到上面的查询只是简单的检索每行的<code class="literal">owner</code>字段，有些人名重复了多次。为了使输出最小化，使用关键字<code class="literal">DISTINCT</code> 可以检索出唯一输出记录：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT DISTINCT owner FROM pet;</code></strong>
+--------+
| owner  |
+--------+
| Benny  |
| Diane  |
| Gwen   |
| Harold |
+--------+
</pre>
<p>
          可以使用 <code class="literal">WHERE</code>子句来联合行选择和列选择。 例如：只想检索狗和猫的出生日期，可以使用以下查询语句：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, species, birth FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>WHERE species = 'dog' OR species = 'cat';</code></strong>
+--------+---------+------------+
| name   | species | birth      |
+--------+---------+------------+
| Fluffy | cat     | 1993-02-04 |
| Claws  | cat     | 1994-03-17 |
| Buffy  | dog     | 1989-05-13 |
| Fang   | dog     | 1990-08-27 |
| Bowser | dog     | 1989-08-31 |
+--------+---------+------------+
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sorting-rows"></a>3.3.4.4. 排序</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7249552"></a><a class="indexterm" name="idp7250624"></a><a class="indexterm" name="idp7252112"></a><a class="indexterm" name="idp7253600"></a><a class="indexterm" name="idp7255088"></a>
<p>
          你应该注意到上面的哪些查询例子的输出结果行没有特别指定的顺序。然而当行按照某种指定方式排序，通常检查输出会更容易容易检查。使用<code class="literal">ORDER
          BY</code>子句可以排序结果集：</p>
<p>
        下面是动物的出生日期，按照日期来排序：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet ORDER BY birth;</code></strong>
+----------+------------+
| name     | birth      |
+----------+------------+
| Buffy    | 1989-05-13 |
| Bowser   | 1989-08-31 |
| Fang     | 1990-08-27 |
| Fluffy   | 1993-02-04 |
| Claws    | 1994-03-17 |
| Slim     | 1996-04-29 |
| Whistler | 1997-12-09 |
| Chirpy   | 1998-09-11 |
| Puffball | 1999-03-30 |
+----------+------------+
</pre>
<p> 对字符类型字段来说，排序像其他的比较操作一样，都是大小写不敏感的。这意味着，对于等同但大小写不同的列，他们的顺序并没有指定。  你可以使用<a class="link" href="functions.html#operator_binary"><code class="literal">BINARY</code></a>关键字来强制该字段大小写敏感，如: <code class="literal">ORDER BY BINARY <em class="replaceable"><code>col_name</code></em></code> (<a href="example/tutorial/1.0 order by and order by binary.sql">我的例子</a>)</p>
<p>
          默认排序是升序,最小值在前面。要想相反方向排序(降序)，在你排序的字段名字后面添加<code class="literal">DESC</code>关键字：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet ORDER BY birth DESC;</code></strong>
+----------+------------+
| name     | birth      |
+----------+------------+
| Puffball | 1999-03-30 |
| Chirpy   | 1998-09-11 |
| Whistler | 1997-12-09 |
| Slim     | 1996-04-29 |
| Claws    | 1994-03-17 |
| Fluffy   | 1993-02-04 |
| Fang     | 1990-08-27 |
| Bowser   | 1989-08-31 |
| Buffy    | 1989-05-13 |
+----------+------------+
</pre>
<p>
          你可以在多个字段上排序，而且可以在不同的字段上使用不同的排序方向。例如，对动物的种类升序排列，对动物的出生日期降序排序(年龄小的动物排在前面)，使用下面查询：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, species, birth FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>ORDER BY species, birth DESC;</code></strong>
+----------+---------+------------+
| name     | species | birth      |
+----------+---------+------------+
| Chirpy   | bird    | 1998-09-11 |
| Whistler | bird    | 1997-12-09 |
| Claws    | cat     | 1994-03-17 |
| Fluffy   | cat     | 1993-02-04 |
| Fang     | dog     | 1990-08-27 |
| Bowser   | dog     | 1989-08-31 |
| Buffy    | dog     | 1989-05-13 |
| Puffball | hamster | 1999-03-30 |
| Slim     | snake   | 1996-04-29 |
+----------+---------+------------+
</pre>
<p>
          从上面例子可以看出，<code class="literal">DESC</code> 关键字只对它前面的字段生效(<code class="literal">birth</code>)，而不对<code class="literal">species</code> 字段生效。</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="date-calculations"></a>3.3.4.5. 日期计算</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7273312"></a><a class="indexterm" name="idp7274384"></a><a class="indexterm" name="idp7275872"></a><a class="indexterm" name="idp7277360"></a>
<p>
        MySQL提供了一些用于执行日期计算的函数，可以用来计算年龄或者日期的一部分。 </p>
<p>
          使用<a class="link" href="functions.html#function_timestampdiff"><code class="literal">TIMESTAMPDIFF()</code></a>可以确定每只宠物的年龄。这个函数有三个参数，时差单位、两个日期，然后输出它们的差额。下面的查询显示了每只宠物的出生日期，当前日期，它们的年龄。使用别名(<code class="literal">age</code>)可以使最终输出列标注更容易理解。</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth, CURDATE(),</code></strong>
    -&gt; <strong class="userinput"><code>TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet;</code></strong>
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
+----------+------------+------------+------+
</pre>
<p>
          这个语句可以执行，但以某个顺序来排列，结果更容易浏览。使用 <code class="literal">ORDER BY name</code>子句可以使输出结果按照姓名排序。</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth, CURDATE(),</code></strong>
    -&gt; <strong class="userinput"><code>TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet ORDER BY name;</code></strong>
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
+----------+------------+------------+------+
</pre>
<p>
          想对输出结果中的<code class="literal">age</code>字段排序而不是对<code class="literal">name</code>字段排序，只需要使用另外一个<code class="literal">ORDER
          BY</code>子句：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth, CURDATE(),</code></strong>
    -&gt; <strong class="userinput"><code>TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet ORDER BY age;</code></strong>
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
+----------+------------+------------+------+
</pre>
<p>
          类似的查询可以被用来确定宠物已经去世了多少年。你先检查确认下宠物的<code class="literal">death</code>值是否为<code class="literal">NULL</code>，然后对那些非<code class="literal">NULL</code>值，计算 <code class="literal">death</code>和<code class="literal">birth</code>值的差额：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth, death,</code></strong>
    -&gt; <strong class="userinput"><code>TIMESTAMPDIFF(YEAR,birth,death) AS age</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet WHERE death IS NOT NULL ORDER BY age;</code></strong>
+--------+------------+------------+------+
| name   | birth      | death      | age  |
+--------+------------+------------+------+
| Bowser | 1989-08-31 | 1995-07-29 |    5 |
+--------+------------+------------+------+
</pre>
<p>上面的查询使用了<code class="literal">death IS NOT NULL</code>，而没有使用<code class="literal">death &lt;&gt; NULL</code>是因为<code class="literal">NULL</code>是个特殊值，它不能使用比较操作符来进行比较。具体的后面会讲到，请参阅<a class="xref" href="tutorial.html#working-with-null" title="3.3.4.6. Working with NULL Values">章节3.3.4.6, “处理<code class="literal">NULL</code>值”</a>。</p>
<p>
          假使你想知道宠物的出生日期的下个月份是什么？ 对这种类型的计算，年和月就是不相关的；你只想简单的提取<code class="literal">birth</code>字段中的月份部分。MySQL提供了一些用来提取日期的部分的函数，比如
          <a class="link" href="functions.html#function_year"><code class="literal">YEAR()</code></a>，<a class="link" href="functions.html#function_month"><code class="literal">MONTH()</code></a>和<a class="link" href="functions.html#function_dayofmonth"><code class="literal">DAYOFMONTH()</code></a>。<a class="link" href="functions.html#function_month"><code class="literal">MONTH()</code></a>在这里是个适用的函数。来看看它是如何工作的，执行一个简单查询来显示<code class="literal">birth</code>和<a class="link" href="functions.html#function_month"><code class="literal">MONTH(birth)</code></a>：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth, MONTH(birth) FROM pet;</code></strong>
+----------+------------+--------------+
| name     | birth      | MONTH(birth) |
+----------+------------+--------------+
| Fluffy   | 1993-02-04 |            2 |
| Claws    | 1994-03-17 |            3 |
| Buffy    | 1989-05-13 |            5 |
| Fang     | 1990-08-27 |            8 |
| Bowser   | 1989-08-31 |            8 |
| Chirpy   | 1998-09-11 |            9 |
| Whistler | 1997-12-09 |           12 |
| Slim     | 1996-04-29 |            4 |
| Puffball | 1999-03-30 |            3 |
+----------+------------+--------------+
</pre>
<p>
          找到出生日期的下个月份的宠物也很容易，假如当前月份是四月，这个月份值就为4，你可以使用下面语句找到出生在五月(月份值=5)的动物：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet WHERE MONTH(birth) = 5;</code></strong>
+-------+------------+
| name  | birth      |
+-------+------------+
| Buffy | 1989-05-13 |
+-------+------------+
</pre>
<p>
          假如当前月为十二月时会有点小麻烦，你不能简单的在月份值12上加1，这样你查找的宠物出生月份值就变为13了，因为我们没有这样的月份，事实上我们使用出生月份为一月来解决这个问题。</p>
<p>
          你也可以写查询不局限于当前月，这样就不需要使用特定月份的数字。<a class="link" href="functions.html#function_date-add"><code class="literal">DATE_ADD()</code></a>函数能够对给定的日期加上一个时间间隔。如果你对<a class="link" href="functions.html#function_curdate"><code class="literal">CURDATE()</code></a>值加上一个月，然后用<a class="link" href="functions.html#function_month"><code class="literal">MONTH()</code></a>函数提取月份值，这个结果就是你要找生日的月份：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>WHERE MONTH(birth) = MONTH(DATE_ADD(CURDATE(),INTERVAL 1 MONTH));</code></strong>
</pre>
        <p>
          还有一个方法来实现同样的任务：对当前月加1来取得下个月份值，在使用取模函数(<code class="literal">MOD</code>) 后，如果当前月份值为12，它会截断成0。</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, birth FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>WHERE MONTH(birth) = MOD(MONTH(CURDATE()), 12) + 1;</code></strong>
</pre>
        <p>
          <a class="link" href="functions.html#function_month"><code class="literal">MONTH()</code></a> 返回1-12之间的数字，
          <a class="link" href="functions.html#function_mod"><code class="literal">MOD(something,12)</code></a> 返回0-11之间的数字。所以加法操作要在
          <a class="link" href="functions.html#function_mod"><code class="literal">MOD()</code></a>之后，不然你就会从十一月直接跳到一月。 </p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="working-with-null"></a>3.3.4.6. 处理<code class="literal">NULL</code>值</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7341824"></a><a class="indexterm" name="idp7342896"></a>
<p>
          当你开始使用<code class="literal">NULL</code> 值时，你会觉得很奇怪。从概念上来说， <code class="literal">NULL</code> 表示未知值，并且它处理方式和其它值不一样。</p>
<p>想要测试<code class="literal">NULL</code>值，得使用<a class="link" href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a>和<a class="link" href="functions.html#operator_is-not-null"><code class="literal">IS
          NOT NULL</code></a> 操作符，举例如下：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT 1 IS NULL, 1 IS NOT NULL;</code></strong>
+-----------+---------------+
| 1 IS NULL | 1 IS NOT NULL |
+-----------+---------------+
|         0 |             1 |
+-----------+---------------+
</pre>
<p>
          你不能使用算术运算符(比如<a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>，<a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>或 <a class="link" href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a> )来测试<code class="literal">NULL</code>值。你可以使用下面的查询来验证前面的说法：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT 1 = NULL, 1 &lt;&gt; NULL, 1 &lt; NULL, 1 &gt; NULL;</code></strong>
+----------+-----------+----------+----------+
| 1 = NULL | 1 &lt;&gt; NULL | 1 &lt; NULL | 1 &gt; NULL |
+----------+-----------+----------+----------+
|     NULL |      NULL |     NULL |     NULL |
+----------+-----------+----------+----------+
</pre>
<p>
          因为使用任何算术运算符和<code class="literal">NULL</code>比较产生的结果也是<code class="literal">NULL</code>，通过这样的比较你不能得到有意义的结果集。 </p>
<p>
          在MySQL里<code class="literal">0</code>和<code class="literal">NULL</code>表示false，其它值都表示true.T布尔运算的默认真值就是<code class="literal">1</code>。  </p>
<p>
          这就是 <code class="literal">NULL</code>的特殊处理方式，是在先前章节里判断宠物还活着使用<code class="literal">death IS NOT
          NULL</code>而不是使用<code class="literal">death &lt;&gt;
          NULL</code> 的原因。</p>
<p>在<code class="literal">GROUP BY</code>语句中两个<code class="literal">NULL</code>值是被认为是相等的。 </p>
<p>
          在使用<code class="literal">ORDER BY</code>子句时，如果你使用
          <code class="literal">ORDER BY ... ASC</code> ，<code class="literal">NULL</code>值会排在第一；使用
          <code class="literal">ORDER BY ... DESC</code>，它会排在最后一个。</p>
<p>
          在使用<code class="literal">NULL</code>时有个常见错误，认为在定义为<code class="literal">NOT NULL</code>,的字段里不能插入0或者空字符，但事实上并不是这样的。0和空字符是真值，而
          <code class="literal">NULL</code>表示<span class="quote">“<span class="quote">值不存在</span>”。</span>你可以很容易的用<code class="literal">IS [NOT] NULL</code> 语句来测试：as shown:        </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT 0 IS NULL, 0 IS NOT NULL, '' IS NULL, '' IS NOT NULL;</code></strong>
+-----------+---------------+------------+----------------+
| 0 IS NULL | 0 IS NOT NULL | '' IS NULL | '' IS NOT NULL |
+-----------+---------------+------------+----------------+
|         0 |             1 |          0 |              1 |
+-----------+---------------+------------+----------------+
</pre>
<p>
          在<code class="literal">NOT NULL</code>字段完全可以插入0或空字符，因为它们事实上是<code class="literal">NOT NULL</code>。参阅
          <a class="xref" href="error-handling.html#problems-with-null" title="C.5.5.3. Problems with NULL Values">Section C.5.5.3, “与<code class="literal">NULL</code>值相关的问题”</a>.</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="pattern-matching"></a>3.3.4.7. 模式匹配</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7378544"></a><a class="indexterm" name="idp7379616"></a><a class="indexterm" name="idp7381104"></a>
<p>
        MySQL提供标准的SQL模式匹配，也提供了基于像<span class="command"><strong>vi</strong></span>,，<span class="command"><strong>grep</strong></span>和<span class="command"><strong>sed</strong></span>这些Unix工具类似的扩展正则表达式的匹配方式。</p>
<p>
          SQL模式匹配提供了
          <span class="quote">“<span class="quote"><code class="literal">_</code></span>”来匹配单个字符，也提供</span><span class="quote">“<span class="quote"><code class="literal">%</code></span>”来匹配任意长度字符串(包括空字符)</span>。 在MySQL中， SQL模式匹配是默认不区分大小写的。 在下面提供的例子里，当你使用SQL模式匹配时不能使用 <code class="literal">=</code>或<code class="literal">&lt;&gt;</code> ,，应该使用 <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>或<a class="link" href="functions.html#operator_not-like"><code class="literal">NOT LIKE</code></a>。</p>
        <p>
          查找开头为<span class="quote">“<span class="quote"><code class="literal">b</code></span>”的名字</span>：</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name LIKE 'b%';</code></strong>
+--------+--------+---------+------+------------+------------+
| name   | owner  | species | sex  | birth      | death      |
+--------+--------+---------+------+------------+------------+
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |
| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+--------+---------+------+------------+------------+
</pre>
        <p>
          查询结尾为<span class="quote">“<span class="quote"><code class="literal">fy</code></span>”的名字：</span>        </p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name LIKE '%fy';</code></strong>
+--------+--------+---------+------+------------+-------+
| name   | owner  | species | sex  | birth      | death |
+--------+--------+---------+------+------------+-------+
| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |
+--------+--------+---------+------+------------+-------+
</pre>
        <p>
          查询包含<span class="quote">“<span class="quote"><code class="literal">w</code></span>”的名字</span>：</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name LIKE '%w%';</code></strong>
+----------+-------+---------+------+------------+------------+
| name     | owner | species | sex  | birth      | death      |
+----------+-------+---------+------+------------+------------+
| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |
| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |
+----------+-------+---------+------+------------+------------+
</pre>
        <p>
          想要查找只有5个字符的名字，可以使用5个 <span class="quote">“<span class="quote"><code class="literal">_</code></span>”</span> 来匹配字符串：        </p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name LIKE '_____';</code></strong>
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</pre>
        <p>
          MySQL提供的另外一种模式匹配就是扩展的正则表达式。当你试验这种类型的模式匹配时，得使用<a class="link" href="functions.html#operator_regexp"><code class="literal">REGEXP</code></a>和<a class="link" href="functions.html#operator_not-regexp"><code class="literal">NOT
          REGEXP</code></a>操作符(或者使用<a class="link" href="functions.html#operator_regexp"><code class="literal">RLIKE</code></a>和<a class="link" href="functions.html#operator_not-regexp"><code class="literal">NOT RLIKE</code></a>，它们是同义词)。        </p>
        <p>
        下面列举一些扩展正则表达式的字符：</p>
        <div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
              <span class="quote">“<span class="quote"><code class="literal">.</code></span>”</span> 用于匹配任何单个字符。</p>
</li><li class="listitem">
  <p>
              字符串<span class="quote">“<span class="quote"><code class="literal">[...]</code></span>”</span>
              匹配任何在方括号里的任何字符 。例如，<span class="quote">“<span class="quote"><code class="literal">[abc]</code></span>”</span>匹配<span class="quote">“<span class="quote"><code class="literal">a</code></span>”</span>，<span class="quote">“<span class="quote"><code class="literal">b</code></span>”</span>或者<span class="quote">“<span class="quote"><code class="literal">c</code></span>”</span>。定义字符的范围可以使用一个&quot;-&quot;，例如
              <span class="quote">“<span class="quote"><code class="literal">[a-z]</code></span>”</span> 匹配任何字母，而 <span class="quote">“<span class="quote"><code class="literal">[0-9]</code></span>”</span>匹配任何数字。</p>
</li><li class="listitem">
  <p>
              <span class="quote">“<span class="quote"><code class="literal">*</code></span>”</span> 用于匹配零个或多个前面的字符， 例如，
              <span class="quote">“<span class="quote"><code class="literal">x*</code></span>”</span> 匹配任意长度的
              <span class="quote">“<span class="quote"><code class="literal">x</code></span>”</span>字符,
              <span class="quote">“<span class="quote"><code class="literal">[0-9]*</code></span>”匹配任意数量的数字，</span><span class="quote">“<span class="quote"><code class="literal">.*</code></span>”</span>
              匹配任意数量的任意字符。</p>
</li><li class="listitem">
  <p><a class="link" href="functions.html#operator_regexp"><code class="literal">REGEXP</code></a> 模式匹配只要和被测试值任何地方匹配就算匹配成功。(这和<a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> 模式匹配不同，它要整个值被匹配才算成功)。            </p>
</li><li class="listitem">
  <p>
              为了定位一个模式以便它必须匹配被测试值的开始或结尾(To anchor a pattern so that it must match the beginning or
              end of the value being tested)， 在模式开头使用
              <span class="quote">“<span class="quote"><code class="literal">^</code></span>”，或者在模式结尾使用</span><span class="quote">“<span class="quote"><code class="literal">$</code></span>”。</span></p>
</li></ul>
</div>
<p>
          为了示范扩展正则表达式是如何工作的，先前的<a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>查询在这里用<a class="link" href="functions.html#operator_regexp"><code class="literal">REGEXP</code></a>重写了。</p>
<p>
          为了找到以<span class="quote">“<span class="quote"><code class="literal">b</code></span>”</span>开始的名字，使用<span class="quote">“<span class="quote"><code class="literal">^</code></span>”来匹配名字的开头：</span></p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP '^b';</code></strong>
+--------+--------+---------+------+------------+------------+
| name   | owner  | species | sex  | birth      | death      |
+--------+--------+---------+------+------------+------------+
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |
| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+--------+---------+------+------------+------------+
</pre>
<p>
          If如果你想让<a class="link" href="functions.html#operator_regexp"><code class="literal">REGEXP</code></a>比较区分大小写，使用 <a class="link" href="functions.html#operator_binary"><code class="literal">BINARY</code></a> 关键字来把字符串变成二进制字符串。下面的语句只匹配开头为小写 <span class="quote">“<span class="quote"><code class="literal">b</code></span>”</span> 的名字：        </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP BINARY '^b';</code></strong>
</pre>
        <p>
          为了找到以<span class="quote">“<span class="quote"><code class="literal">fy</code></span>”结尾的名字</span>，使用
          <span class="quote">“<span class="quote"><code class="literal">$</code></span>”</span>来匹配名字的结尾：</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP 'fy$';</code></strong>
+--------+--------+---------+------+------------+-------+
| name   | owner  | species | sex  | birth      | death |
+--------+--------+---------+------+------------+-------+
| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |
+--------+--------+---------+------+------------+-------+
</pre>
        <p>
          为了找到包含<span class="quote">“<span class="quote"><code class="literal">w</code></span>”字符的名字</span>，使用以下查询：</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP 'w';</code></strong>
+----------+-------+---------+------+------------+------------+
| name     | owner | species | sex  | birth      | death      |
+----------+-------+---------+------+------------+------------+
| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |
| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |
+----------+-------+---------+------+------------+------------+
</pre>
        <p>
          由于正则表达式时只需要任何位置的值有出现就能匹配，这和SQL模式有区别的，它不需要像SQL模式查询那样要在模式的两边输入挺佩服。</p>
        <p>
          想要查找只有5个字符的名字，使用<span class="quote">“<span class="quote"><code class="literal">^</code></span>”</span>和<span class="quote">“<span class="quote"><code class="literal">$</code></span>”来匹配名字的开头和结尾，中间加5个</span><span class="quote">“<span class="quote"><code class="literal">.</code></span>”</span>：</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP '^.....$';</code></strong>
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</pre>
        <p>
          你也可以使用<code class="literal">{<em class="replaceable"><code>n</code></em>}</code>操作符(重复n次)来书写上面的查询：</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM pet WHERE name REGEXP '^.{5}$';</code></strong>
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</pre>
        <p>
        <a class="xref" href="functions.html#regexp" title="12.5.2. Regular Expressions">章节 12.5.2, “正则表达式”</a>,，提供了更多关于正则表达式的信息。</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="counting-rows"></a>3.3.4.8. 行计数</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7456512"></a><a class="indexterm" name="idp7458000"></a><a class="indexterm" name="idp7459488"></a>
<p>
          数据库经常被用来回答这个问题， <span class="quote">“某种类型的数据在表里多久出现一次？”例如，你可能想知道你有了几只宠物，或者每个人拥有几只宠物，或者你可能想对你的宠物做各种类型的统计。</span></p>
<p>
          计算总共有多少只宠物和 <span class="quote">“<span class="quote"><code class="literal">pet</code>表有多少行？</span>”</span> 是同一个问题，因为每只宠物有一个记录。 <a class="link" href="functions.html#function_count"><code class="literal">COUNT(*)</code></a> 用来计算行数量，所以计算宠物数量的语句就像下面这样：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT COUNT(*) FROM pet;</code></strong>
+----------+
| COUNT(*) |
+----------+
|        9 |
+----------+
</pre>
<p>
          早先，你有检索拥有宠物的人的姓名。如果你想知道每个人拥有的宠物数量<a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a>：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT owner, COUNT(*) FROM pet GROUP BY owner;</code></strong>
+--------+----------+
| owner  | COUNT(*) |
+--------+----------+
| Benny  |        2 |
| Diane  |        2 |
| Gwen   |        3 |
| Harold |        2 |
+--------+----------+
</pre>
<p>
          前面的查询使用<code class="literal">GROUP BY</code> 来对每个<code class="literal">owner</code>的记录进行聚合：。<a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a>和<code class="literal">GROUP BY</code> 一起使用可以用各种方式来分组你的数据。接下来的例子就展示了使用不同方式来进行动物普查操作：</p>
<p>
          每种动物的数量：
        </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT species, COUNT(*) FROM pet GROUP BY species;</code></strong>
+---------+----------+
| species | COUNT(*) |
+---------+----------+
| bird    |        2 |
| cat     |        2 |
| dog     |        3 |
| hamster |        1 |
| snake   |        1 |
+---------+----------+
</pre>
        <p>每个性别的宠物有几只：
        </p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT sex, COUNT(*) FROM pet GROUP BY sex;</code></strong>
+------+----------+
| sex  | COUNT(*) |
+------+----------+
| NULL |        1 |
| f    |        4 |
| m    |        4 |
+------+----------+
</pre>
        <p>
          (在上面的输出中，<code class="literal">NULL</code> 表示性别未知)        </p>
        <p>
        每种类别每种性别的动物数量：</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT species, sex, COUNT(*) FROM pet GROUP BY species, sex;</code></strong>
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| bird    | NULL |        1 |
| bird    | f    |        1 |
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
| hamster | f    |        1 |
| snake   | m    |        1 |
+---------+------+----------+
</pre>
        <p>
          在使用<a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a>时不一定需要检索整个表，例如 ，在前面的查询中我们只想查询狗和猫的数量，应为：</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT species, sex, COUNT(*) FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>WHERE species = 'dog' OR species = 'cat'</code></strong>
    -&gt; <strong class="userinput"><code>GROUP BY species, sex;</code></strong>
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
+---------+------+----------+
</pre>
        <p>
          或者，你只想知道明确性别的每种动物每个性别各有几只：</p>
        <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT species, sex, COUNT(*) FROM pet</code></strong>
    -&gt; <strong class="userinput"><code>WHERE sex IS NOT NULL</code></strong>
    -&gt; <strong class="userinput"><code>GROUP BY species, sex;</code></strong>
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| bird    | f    |        1 |
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
| hamster | f    |        1 |
| snake   | m    |        1 |
+---------+------+----------+
</pre>
        <p>
          如果把指定的字段名添加到<a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a> 子句里，<code class="literal">GROUP
          BY</code> 子句中必须出现同名字段，不然将会出现以下情况：</p>
        <div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
              如果<a class="link" href="server-administration.html#sqlmode_only_full_group_by"><code class="literal">ONLY_FULL_GROUP_BY</code></a> 的SQL模式被启用，则会报错：            </p>
  <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET sql_mode = 'ONLY_FULL_GROUP_BY';</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT owner, COUNT(*) FROM pet;</code></strong>
ERROR 1140 (42000): Mixing of GROUP columns (MIN(),MAX(),COUNT()...)
with no GROUP columns is illegal if there is no GROUP BY clause
</pre></li><li class="listitem">
  <p>
              如果<a class="link" href="server-administration.html#sqlmode_only_full_group_by"><code class="literal">ONLY_FULL_GROUP_BY</code></a>模式没有被启用，这个查询将把所有行处理成一个分组，但每个指定的字段值是不确定的，服务器会随从任何行里选机去一个值：</p>
  <pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET sql_mode = '';</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT owner, COUNT(*) FROM pet;</code></strong>
+--------+----------+
| owner  | COUNT(*) |
+--------+----------+
| Harold |        8 | 
+--------+----------+
1 row in set (0.00 sec)
</pre></li></ul>
</div>
<p>参阅<a class="xref" href="functions.html#group-by-extensions" title="12.17.3. MySQL Extensions to GROUP BY">章节 12.17.3, “MySQL对<code class="literal">GROUP BY</code>的扩展”</a>。</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="multiple-tables"></a>3.3.4.9. 使用多个表</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp7501616"></a>
<p>
          <code class="literal">pet</code>表保存着你的宠物的记录。如果你想记录宠物们的其它信息，例如 ，宠物们一生中要去看几次兽医，宠物后代们何时出生，这些都需要其它表来实现。这个表是怎样的呢?它看起来要包含以下信息： </p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
              宠物的名字，这样你才能知道每个事件是发生在哪只动物身上的。</p>
</li><li class="listitem">
  <p>
              日期，这样你才能知道事件是何时发生的。</p>
</li><li class="listitem">
  <p>
              描述事件的字段。</p>
</li><li class="listitem">
  <p>
              如果你想对事件分类，还需要事件类型字段。</p>
</li></ul>
</div>
<p>
          综上所述， <code class="literal">event</code>的<a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
          TABLE</code></a> 语句应该像如下所示：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE event (name VARCHAR(20), date DATE,</code></strong>
    -&gt; <strong class="userinput"><code>type VARCHAR(15), remark VARCHAR(255));</code></strong>
</pre>
<p>和<code class="literal">pet</code>表类似，最容易的载入初始化数据的方式是创建一个tab符号分隔的包含下面信息的文本文件，然后载入到数据表中。</p>
<div class="informaltable">
<table summary="This table represents pet record data
            that will appear in a tab delimited text file, as described
in the preceding text." border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col">name</th><th scope="col">date</th><th scope="col">type</th><th scope="col">remark</th></tr></thead><tbody><tr><td scope="row">Fluffy</td><td>1995-05-15</td><td>litter</td><td>4 kittens, 3 female, 1 male</td></tr><tr><td scope="row">Buffy</td><td>1993-06-23</td><td>litter</td><td>5 puppies, 2 female, 3 male</td></tr><tr><td scope="row">Buffy</td><td>1994-06-19</td><td>litter</td><td>3 puppies, 3 female</td></tr><tr><td scope="row">Chirpy</td><td>1999-03-21</td><td>vet</td><td>needed beak straightened</td></tr><tr><td scope="row">Slim</td><td>1997-08-03</td><td>vet</td><td>broken rib</td></tr><tr><td scope="row">Bowser</td><td>1991-10-12</td><td>kennel</td><td> </td></tr><tr><td scope="row">Fang</td><td>1991-10-12</td><td>kennel</td><td> </td></tr><tr><td scope="row">Fang</td><td>1998-08-28</td><td>birthday</td><td>Gave him a new chew toy</td></tr><tr><td scope="row">Claws</td><td>1998-03-17</td><td>birthday</td><td>Gave him a new flea collar</td></tr><tr><td scope="row">Whistler</td><td>1998-12-09</td><td>birthday</td><td>First birthday</td></tr></tbody></table>
</div>
<p>
          给event表载入数据：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>LOAD DATA LOCAL INFILE 'event.txt' INTO TABLE event;</code></strong>
</pre>
<p>
          根据你先前学习的运行在<code class="literal">pet</code>表的那些查询，你应该可以对<code class="literal">event</code>表进行检索，它们的操作方式是一样的。但什么情况下<code class="literal">event</code>表内容不足以来回答你的问题呢?          </p>
<p>
          假如你想知道每只宠物的生育年龄。我们前面讲到如何通过2个日期来计算年龄。母亲生育日期记录在<code class="literal">event</code>表中，但是计算她的年龄需要另外一个日期即她的出生日期，这个数据保存在<code class="literal">pet</code>表中。这意味着这个查询同时需要两个表：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT pet.name,</code></strong>
    -&gt; <strong class="userinput"><code>(YEAR(date)-YEAR(birth)) - (RIGHT(date,5)&lt;RIGHT(birth,5)) AS age,</code></strong>
    -&gt; <strong class="userinput"><code>remark</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet INNER JOIN event</code></strong>
    -&gt; <strong class="userinput"><code>  ON pet.name = event.name</code></strong>
    -&gt; <strong class="userinput"><code>WHERE event.type = 'litter';</code></strong>
+--------+------+-----------------------------+
| name   | age  | remark                      |
+--------+------+-----------------------------+
| Fluffy |    2 | 4 kittens, 3 female, 1 male |
| Buffy  |    4 | 5 puppies, 2 female, 3 male |
| Buffy  |    5 | 3 puppies, 3 female         |
+--------+------+-----------------------------+
</pre>
<p>
        在这个查询里我们注意以下内容：</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p><code class="literal">FROM</code>子句联结了2个表，因为这个查询需要从2个表中检索信息。</p>
</li><li class="listitem">
  <p>
              当你联结多个表时，你需要明确指出一个表中的记录怎样才能能与另外表中的记录匹配。这里很简单，因为它们都有<code class="literal">name</code>字段。查询使用一个<code class="literal">ON</code>子句来通过<code class="literal">name</code>值来匹配两个表中记录。</p>
<p>
              这个查询使用<code class="literal">INNER JOIN</code>来联结2个表，<code class="literal">INNER JOIN</code>当仅当两个表都满足<code class="option">ON</code> 子句指定的条件时，允许任意一个表中的行出现在结果集中。 在这个例子里，<code class="literal">ON</code>子句指定了<code class="literal">pet</code>表中的<code class="literal">name</code>字段必须与<code class="literal">event</code>表中的<code class="literal">name</code>字段匹配。如果一个名字只出现在一个表中，这行将不会出现在结果集中，因为这个<code class="literal">ON</code>子句的条件不满足了。</p>
</li><li class="listitem">
              <p>
              由于<code class="literal">name</code>字段在两个表中都存在，当引用到这个字段时，你需要明确指定字段属于哪个表，把表名写在字段前就可以实现了。</p>
            </li></ul>
</div>
<p>
          你不一定得用不同表来进行联结操作。有时表联结它自身也很有用，比如你想比较同一表中的记录。例如，想给你的宠物们寻找配偶，你可以对<code class="literal">pet</code>表与它自身联结，来进行同一种类的雄雌配对：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT p1.name, p1.sex, p2.name, p2.sex, p1.species</code></strong>
    -&gt; <strong class="userinput"><code>FROM pet AS p1 INNER JOIN pet AS p2</code></strong>
    -&gt; <strong class="userinput"><code>  ON p1.species = p2.species AND p1.sex = 'f' AND p2.sex = 'm';</code></strong>
+--------+------+--------+------+---------+
| name   | sex  | name   | sex  | species |
+--------+------+--------+------+---------+
| Fluffy | f    | Claws  | m    | cat     |
| Buffy  | f    | Fang   | m    | dog     |
| Buffy  | f    | Bowser | m    | dog     |
+--------+------+--------+------+---------+
</pre>
<p>
        在这个查询里，我们给表起了别名以便直观的看出每个引用列是属于哪个表实例的。</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="getting-information"></a>3.4. 获取数据库和表的信息</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp7574560"></a><a class="indexterm" name="idp7576048"></a><a class="indexterm" name="idp7577536"></a>
<p>
      假如你忘记了数据库或表的名字，或者忘记了一个指定表的结构(比如这些字段的名字是什么)？ MySQL通过一些提供数据库和表信息的命令解决了这个问题。</p>
<p>
      先前学习过<a class="link" href="sql-syntax.html#show-databases" title="13.7.5.15. SHOW DATABASES Syntax"><code class="literal">SHOW
      DATABASES</code></a>，这个命令可以罗列出服务器中管理的所有数据库。想知道当前选择的是哪个数据库，可以使用
      <a class="link" href="functions.html#function_database"><code class="literal">DATABASE()</code></a>函数：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT DATABASE();</code></strong>
+------------+
| DATABASE() |
+------------+
| menagerie  |
+------------+
</pre>
<p>
      如果你当前没有选择任何数据库，返回结果就是<code class="literal">NULL</code>值。</p>
<p>
    使用下面命令可以找出默认数据库包含哪些表(例如，当你不确定一个表的名字的时候)：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
+---------------------+
| Tables_in_menagerie |
+---------------------+
| event               |
| pet                 |
+---------------------+
</pre>
<p>
      这个语句产生的输出字段的名字格式为<code class="literal">Tables_in_<em class="replaceable"><code>db_name</code></em></code>,
    这个<em class="replaceable"><code>db_name</code></em>就是数据库的名字。 参阅<a class="xref" href="sql-syntax.html#show-tables" title="13.7.5.38. SHOW TABLES Syntax">章节 13.7.5.38, “<code class="literal">SHOW TABLES</code> 语法”</a>可以获取更多相关信息。</p>
<p>
    如果你想知道一个表的结构，可以使用<a class="link" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a>语句，它会显示出这个表的每个字段的信息：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>DESCRIBE pet;</code></strong>
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| name    | varchar(20) | YES  |     | NULL    |       |
| owner   | varchar(20) | YES  |     | NULL    |       |
| species | varchar(20) | YES  |     | NULL    |       |
| sex     | char(1)     | YES  |     | NULL    |       |
| birth   | date        | YES  |     | NULL    |       |
| death   | date        | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+
</pre>
<p>
      <code class="literal">Field</code> 显示字段名字，
      <code class="literal">Type</code> 表示字段的数据类型，
      <code class="literal">NULL</code>表示字段是否允许<code class="literal">NULL</code>值, <code class="literal">Key</code>表示字段是否有索引，<code class="literal">Default</code>指定了该字段的默认值。 <code class="literal">Extra</code>显示了字段的特殊信息：一个字段有<code class="literal">AUTO_INCREMENT</code> 选项，字段值会自增而不为空。</p>
<p>
      <code class="literal">DESC</code>是<a class="link" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a>命令的缩写形式。参阅<a class="xref" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax">章节 13.8.1, “<code class="literal">DESCRIBE</code>语法”</a>，可以获取更多相关信息。</p>
<p>
      你可以使用<a class="link" href="sql-syntax.html#show-create-table" title="13.7.5.12. SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a>命令来获取一个已存在表的<a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>语句。 参阅
      <a class="xref" href="sql-syntax.html#show-create-table" title="13.7.5.12. SHOW CREATE TABLE Syntax">Section 13.7.5.12, “<code class="literal">SHOW CREATE TABLE</code>语法”</a>.    </p>
<p>
      如果表中有索引， <code class="literal">SHOW INDEX FROM
      <em class="replaceable"><code>tbl_name</code></em></code> 会输出索引的相关信息。参阅<a class="xref" href="sql-syntax.html#show-index" title="13.7.5.23. SHOW INDEX Syntax">章节 13.7.5.23, “<code class="literal">SHOW INDEX</code>语法”</a>，可以获取更多相关信息。</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="batch-mode"></a>3.5. 在批处理模式下使用mysql</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp7608464"></a><a class="indexterm" name="idp7609952"></a><a class="indexterm" name="idp7611024"></a><a class="indexterm" name="idp7612512"></a><a class="indexterm" name="idp7613584"></a><a class="indexterm" name="idp7615072"></a>
<p>
      在先前的章节，你使用<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>交互式的输入查询和查看结果。你也可以在批处理模式下使用<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>。要做到这点，只要把你要操作的命令保存在一个文件里，然后告诉<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 来读这个文件中的输入：</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql &lt; <em class="replaceable"><code>batch-file</code></em></code></strong>
</pre>
<p>
    如果你在Windows平台下运行<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>，文件中一些特殊字符可能会让上面的做法产生问题，你可以使用下面语句来避免：</p>
<pre class="programlisting">C:\&gt; <strong class="userinput"><code>mysql -e "source <em class="replaceable"><code>batch-file</code></em>"</code></strong>
</pre>
<p>
      如果你要在命令行中指定连接参数，命令行应为：</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -h <em class="replaceable"><code>host</code></em> -u <em class="replaceable"><code>user</code></em> -p &lt; <em class="replaceable"><code>batch-file</code></em></code></strong>
Enter password: <strong class="userinput"><code>********</code></strong>
</pre>
<p>
    当你在批处理模式下使用<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>时，你需要创建一个脚本文件，然后执行这个脚本。</p>
<p>
      如果你想让脚本中语句执行出错时仍继续执行的话，你需要使用<a class="link" href="programs.html#option_mysql_force"><code class="option">--force</code></a>命令行选项。</p>
<p>
    为什么要使用脚本？有以下原因：</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
          如果你要重复执行一个查询(比如每天或者每星期)，把查询编辑成脚本可以避免每次执行时重复输入。</p>
</li><li class="listitem">
  <p>
          你可以通过拷贝或者编辑已存在类似的脚本文件来生成新查询。</p>
</li><li class="listitem">
  <p>
          批处理模式也很适合用来开发查询，特别是多行命令或者多语句顺序命令。如果出现错误，你不需要重新输入所有内容，只需编辑脚本来更正错误，然后告诉<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><strong>mysql</strong></a>重新执行脚本。</p>
</li><li class="listitem">
          <p>
          如果你的查询产生了很多输出，你可以把输出内容分页显示而不用翻屏到最上面来查看输出：</p>
          <pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql &lt; <em class="replaceable"><code>batch-file</code></em> | more</code></strong>
</pre></li><li class="listitem">
  <p>
          你可以保存输出到文件中来进一步处理：</p>
  <pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql &lt; <em class="replaceable"><code>batch-file</code></em> &gt; mysql.out</code></strong>
</pre></li><li class="listitem">
  <p>
          你可以把脚本分发给其它人，这样他们也可以来执行这些命令。</p>
</li><li class="listitem">
  <p>
          某些场景下不允许使用交互式模式，比如，当你使用<strong>cron</strong>任务来执行脚本，这是必须使用批处理模式。</p>
</li></ul>
</div>
<p>
      批处理方式运行<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>和交互式运行的默认输出格式是不一样的，前者更简洁。例如，交互式下运行 <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>来查询<code class="literal">SELECT DISTINCT
      species FROM pet</code> ，输出结果如下： </p>
<pre class="programlisting">+---------+
| species |
+---------+
| bird    |
| cat     |
| dog     |
| hamster |
| snake   |
+---------+</pre>
    <p>
    在批处理模式下，输出会变成下面这样：,</p>
    <pre class="programlisting">species
bird
cat
dog
hamster
snake</pre>
    <p>
      在批处理模式下如果想获取交互式输出格式，使用<code class="literal">mysql -t</code>。使用 <code class="literal">mysql -vvv</code>可以返回输出当前执行的命令。 </p>
    <a class="indexterm" name="idp7650336"></a><a class="indexterm" name="idp7651424"></a><a class="indexterm" name="idp7652512"></a><a class="indexterm" name="idp7653616"></a>
    <p>
      你也可以在<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>提示符下使用<code class="literal">source</code>或<code class="literal">\.</code>命令来执行脚本：</p>
    <pre class="programlisting">mysql&gt; <strong class="userinput"><code>source <em class="replaceable"><code>filename</code></em>;</code></strong>
mysql&gt; <strong class="userinput"><code>\. <em class="replaceable"><code>filename</code></em></code></strong>
</pre>
    <p>
    参阅<a class="xref" href="programs.html#mysql-batch-commands" title="4.5.1.5. Executing SQL Statements from a Text File">参阅 4.5.1.5, “从文本文件中来执行SQL语句”</a>，可以获取更多相关信息。</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="examples"></a>3.6.常见查询示例</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="tutorial.html#example-maximum-column">3.6.1. 列的最大值</a></span></dt>
<dt><span class="section"><a href="tutorial.html#example-maximum-row">3.6.2. 拥有某列最大值的行</a></span></dt>
<dt><span class="section"><a href="tutorial.html#example-maximum-column-group">3.6.3. 列的分组最大值</a></span></dt><dt><span class="section"><a href="tutorial.html#example-maximum-column-group-row">3.6.4. 拥有某列的分组最大值的行</a></span></dt><dt><span class="section"><a href="tutorial.html#example-user-variables">3.6.5. 使用用户变量</a></span></dt><dt><span class="section"><a href="tutorial.html#example-foreign-keys">3.6.6. 使用外键</a></span></dt><dt><span class="section"><a href="tutorial.html#searching-on-two-keys">3.6.7. 根据2个键来查询</a></span></dt>
<dt><span class="section"><a href="tutorial.html#calculating-days">3.6.8. 计算每天的访问量</a></span></dt><dt><span class="section"><a href="tutorial.html#example-auto-increment">3.6.9. 使用<code class="literal">AUTO_INCREMENT</code></a></span></dt></dl>
</div>
<a class="indexterm" name="idp7662384"></a><a class="indexterm" name="idp7663872"></a>
<p>
    这里有些使用MySQL来解决常见问题的例子。</p>
<p>
      在一些例子里，使用<code class="literal">shop</code>表来记录某个商人(经销商)的每个物品(物品编号)的价格。假设每个供应商对每个商品有一个固定价格，那么(<code class="literal">article</code>,
      <code class="literal">dealer</code>) 就是该记录的主。   </p>
<p>
    启动命令行工具<a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> 并选择一个数据库：</p>
<pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql <em class="replaceable"><code>your-database-name</code></em></code></strong>
</pre>
<p>
      (在大部分MySQL安装中，你可以使用<code class="literal">test</code>数据库)。    </p>
<p>
    用下面的语句可以创建示例表并填充数据：</p>
<pre class="programlisting">CREATE TABLE shop (
    article INT(4) UNSIGNED ZEROFILL DEFAULT '0000' NOT NULL,
    dealer  CHAR(20)                 DEFAULT ''     NOT NULL,
    price   DOUBLE(16,2)             DEFAULT '0.00' NOT NULL,
    PRIMARY KEY(article, dealer));
INSERT INTO shop VALUES
    (1,'A',3.45),(1,'B',3.99),(2,'A',10.99),(3,'B',1.45),
    (3,'C',1.69),(3,'D',1.25),(4,'D',19.95);</pre>
<p>
      执行上面语句后，这个表将包含以下内容：
    </p>
<pre class="programlisting">SELECT * FROM shop;

+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0001 | A      |  3.45 |
|    0001 | B      |  3.99 |
|    0002 | A      | 10.99 |
|    0003 | B      |  1.45 |
|    0003 | C      |  1.69 |
|    0003 | D      |  1.25 |
|    0004 | D      | 19.95 |
+---------+--------+-------+</pre>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-maximum-column"></a>3.6.1. 列的最大值</h3>
</div>
</div>
</div>
<p>
        <span class="quote">“<span class="quote">最大的物品编号是什么？</span>”</span>      </p>
<pre class="programlisting">SELECT MAX(article) AS article FROM shop;

+---------+
| article |
+---------+
|       4 |
+---------+</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-maximum-row"></a>3.6.2. 拥有某列最大值的行</h3>

</div>

</div>

</div>
<p>
        <span class="emphasis"><em>任务：找出最贵的商品的编号，供应商和价格。</em></span>      </p>
<p>
      用子查询来实现很简单：</p>
<pre class="programlisting">SELECT article, dealer, price
FROM   shop
WHERE  price=(SELECT MAX(price) FROM shop);

+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0004 | D      | 19.95 |
+---------+--------+-------+</pre>
<p>
        使用<code class="literal">LEFT JOIN</code>或对所有行按价格逆序排序后使用MySQL特有的<code class="literal">LIMIT</code>子句来取第一行也可以实现该任务：</p>
<pre class="programlisting">SELECT s1.article, s1.dealer, s1.price
FROM shop s1
LEFT JOIN shop s2 ON s1.price &lt; s2.price
WHERE s2.article IS NULL;

SELECT article, dealer, price
FROM shop
ORDER BY price DESC
LIMIT 1;</pre>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">注意</div>
<p xmlns="">
          如果有多个最贵的商品，每个商品价格都是19.95，<code class="literal">LIMIT</code>方案只会去其中的一个商品。 </p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-maximum-column-group"></a>3.6.3. 列的分组最大值</h3>

</div>

</div>

</div>
<p>
        <span class="emphasis"><em>任务: 找出每个物品的最高价。</em></span>      </p>
<pre class="programlisting">SELECT article, MAX(price) AS price
FROM   shop
GROUP BY article;

+---------+-------+
| article | price |
+---------+-------+
|    0001 |  3.99 |
|    0002 | 10.99 |
|    0003 |  1.69 |
|    0004 | 19.95 |
+---------+-------+</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-maximum-column-group-row"></a>3.6.4. 拥有某列的分组最大值的行</h3>

</div>

</div>

</div>
<p>
        <span class="emphasis"><em>任务: 对每个商品，找出其最高价格的供应商。</em></span>      </p>
<p>
      这个问题可以用类似于下面的子查询来解决：</p>
<pre class="programlisting">SELECT article, dealer, price
FROM   shop s1
WHERE  price=(SELECT MAX(s2.price)
              FROM shop s2
              WHERE s1.article = s2.article);

+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0001 | B      |  3.99 |
|    0002 | A      | 10.99 |
|    0003 | C      |  1.69 |
|    0004 | D      | 19.95 |
+---------+--------+-------+</pre>
<p>
        上面的例子使用了关联子查询，它性能可能比较低下(参阅<a class="xref" href="sql-syntax.html#correlated-subqueries" title="13.2.10.7. Correlated Subqueries">章节 13.2.10.7, “关联子查询”</a>)。 其他解决方式有：在<code class="literal">FROM</code>子句中使用非关联子查询或者使用<code class="literal">LEFT JOIN</code>。</p>
<p>
        非关联子查询：
      </p>
<pre class="programlisting">SELECT s1.article, dealer, s1.price
FROM shop s1
JOIN (
  SELECT article, MAX(price) AS price
  FROM shop
  GROUP BY article) AS s2
  ON s1.article = s2.article AND s1.price = s2.price;</pre><p>
        <code class="literal">LEFT JOIN</code>:
      </p><pre class="programlisting">SELECT s1.article, s1.dealer, s1.price
FROM shop s1
LEFT JOIN shop s2 ON s1.article = s2.article AND s1.price &lt; s2.price
WHERE s2.article IS NULL;</pre>
      <p><code class="literal">LEFT JOIN</code>实现这个的原理是：当<code class="literal">s1.price</code>是最大值时，没有一个<code class="literal">s2.price</code>值会比它大，这样<code class="literal">s2</code>所在行值都为<code class="literal">NULL</code>。 参阅 <a class="xref" href="sql-syntax.html#join" title="13.2.9.2. JOIN Syntax">&quot;章节 13.2.9.2, “<code class="literal">JOIN</code>语法”</a>。</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-user-variables"></a>3.6.5. 使用用户变量</h3>

</div>

</div>

</div>
<p>
        你可以使用MySQL的用户变量来存储结果，而无需把它们存在客户端的临时变量里。 (参阅<a class="xref" href="language-structure.html#user-variables" title="9.4. User-Defined Variables">章节9.4, “用户变量”</a>.)      </p>
<p>
      例如，可以用下面语句找出最高和最低价格：</p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT @min_price:=MIN(price),@max_price:=MAX(price) FROM shop;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT * FROM shop WHERE price=@min_price OR price=@max_price;</code></strong>
+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0003 | D      |  1.25 |
|    0004 | D      | 19.95 |
+---------+--------+-------+
</pre>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
注意</div>
<p xmlns="">
          让用户变量用来存储数据库对象名，例如表名或字段名，然后在SQL语句中使用这些变量也是可以的，但是得使用预处理语句。参阅<a class="xref" href="sql-syntax.html#sql-syntax-prepared-statements" title="13.5. SQL Syntax for Prepared Statements">章节 13.5, “预处理语句的SQL语法
”</a>,，来获取更多相关信息。</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-foreign-keys"></a>3.6.6. 使用外键</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7711248"></a><a class="indexterm" name="idp7712320"></a>
<p>
        在MySQL中， <code class="literal">InnoDB</code>表支持外键约束检查。参阅<a class="xref" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine">章节 14.2, “<code class="literal">InnoDB</code>存储引擎</a>,，和<a class="xref" href="introduction.html#ansi-diff-foreign-keys" title="1.8.5.4. Foreign Key Differences">章节 1.8.5.4, “外键”</a>.      </p>
<p>
        外键约束在两表联结时无需外部关键字。除了<code class="literal">InnoDB</code>以外的其他存储引擎，在定义字段时使用<code class="literal">REFERENCES
        <em class="replaceable"><code>tbl_name</code></em>(<em class="replaceable"><code>col_name</code></em>)</code>子句是不生效的，  <span class="emphasis"><em>只把它当作备注或者注释：你当前定义的列引用其它表的一个列。</em></span>在使用该语法时得注意以下内容：</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
            MySQL不会做任何类型的检查来确保<em class="replaceable"><code>col_name字段</code></em>在<em class="replaceable"><code>tbl_name</code></em>表中(甚至也不检查<em class="replaceable"><code>tbl_name</code></em>是否存在)。</p>
</li><li class="listitem">
  <p>
            MySQL不执行<em class="replaceable"><code>tbl_name</code></em>上的操作，换句话说， 该句法不会致使<code class="literal">ON
            DELETE</code>和<code class="literal">ON UPDATE</code>行为发生(即使你在<code class="literal">REFERENCES</code>子句中写了<code class="literal">ON
            DELETE</code>或<code class="literal">ON UPDATE</code>子句，也会被忽略掉)。          </p>
</li><li class="listitem">
            <p>
            使用这个句法建立的字段，不会这个字段上建立任何类型的索引。</p>
          </li></ul>
</div>
<p>
      你可以使用作为联接列创建的列，如下所示：</p>
<pre class="programlisting">CREATE TABLE person (
    id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    name CHAR(60) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE shirt (
    id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    style ENUM('t-shirt', 'polo', 'dress') NOT NULL,
    color ENUM('red', 'blue', 'orange', 'white', 'black') NOT NULL,
    owner SMALLINT UNSIGNED NOT NULL REFERENCES person(id),
    PRIMARY KEY (id)
);

INSERT INTO person VALUES (NULL, 'Antonio Paz');

SELECT @last := LAST_INSERT_ID();

INSERT INTO shirt VALUES
(NULL, 'polo', 'blue', @last),
(NULL, 'dress', 'white', @last),
(NULL, 't-shirt', 'blue', @last);

INSERT INTO person VALUES (NULL, 'Lilliana Angelovska');

SELECT @last := LAST_INSERT_ID();

INSERT INTO shirt VALUES
(NULL, 'dress', 'orange', @last),
(NULL, 'polo', 'red', @last),
(NULL, 'dress', 'blue', @last),
(NULL, 't-shirt', 'white', @last);

SELECT * FROM person;
+----+---------------------+
| id | name                |
+----+---------------------+
|  1 | Antonio Paz         |
|  2 | Lilliana Angelovska |
+----+---------------------+

SELECT * FROM shirt;
+----+---------+--------+-------+
| id | style   | color  | owner |
+----+---------+--------+-------+
|  1 | polo    | blue   |     1 |
|  2 | dress   | white  |     1 |
|  3 | t-shirt | blue   |     1 |
|  4 | dress   | orange |     2 |
|  5 | polo    | red    |     2 |
|  6 | dress   | blue   |     2 |
|  7 | t-shirt | white  |     2 |
+----+---------+--------+-------+


SELECT s.* FROM person p INNER JOIN shirt s
   ON s.owner = p.id
 WHERE p.name LIKE 'Lilliana%'
   AND s.color &lt;&gt; 'white';

+----+-------+--------+-------+
| id | style | color  | owner |
+----+-------+--------+-------+
|  4 | dress | orange |     2 |
|  5 | polo  | red    |     2 |
|  6 | dress | blue   |     2 |
+----+-------+--------+-------+</pre>
<p>
        在下面情况下，<a class="link" href="sql-syntax.html#show-create-table" title="13.7.5.12. SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a>或<a class="link" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a>输出结果不会显示<code class="literal">REFERENCES</code>子句：</p>
<pre class="programlisting">SHOW CREATE TABLE shirt\G
*************************** 1. row ***************************
Table: shirt
Create Table: CREATE TABLE `shirt` (
`id` smallint(5) unsigned NOT NULL auto_increment,
`style` enum('t-shirt','polo','dress') NOT NULL,
`color` enum('red','blue','orange','white','black') NOT NULL,
`owner` smallint(5) unsigned NOT NULL,
PRIMARY KEY  (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1</pre>
      <p>
        在<code class="literal">MyISAM</code>表的列定义里，<code class="literal">REFERENCES</code>只是用作备注或注释。</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="searching-on-two-keys"></a>3.6.7. 根据2个键来查询</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7741840"></a><a class="indexterm" name="idp7742880"></a><a class="indexterm" name="idp7743952"></a><a class="indexterm" name="idp7745440"></a>
<p>
        如同<a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>那样处理方式，<a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a> 使用一个键是可以很好的被优化。</p>
<p>
        一个比较灵活的例子是寻找两个通过<a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>组合到一起的键：</p>
      <pre class="programlisting">SELECT field1_index, field2_index FROM test_table
WHERE field1_index = '1' OR  field2_index = '1'</pre>
      <p>
        该情形是被优化过的。参阅<a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.4. Index Merge Optimization">章节 8.2.1.4, “索引合并优化”</a>.      </p>
      <p>
        你可以使用<a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a> 来合并两个单独的<a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>语句来更好的解决这个问题。        参阅<a class="xref" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax">章节13.2.9.4, “<code class="literal">UNION</code> 语法”</a>.      </p>
      <p>每个<a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> 查询只使用一个键，可以很好的优化：</p>
      <pre class="programlisting">SELECT field1_index, field2_index
    FROM test_table WHERE field1_index = '1'
UNION
SELECT field1_index, field2_index
FROM test_table WHERE field2_index = '1';</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="calculating-days"></a>3.6.8. 计算每天的访问量</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7758144"></a><a class="indexterm" name="idp7759216"></a><a class="indexterm" name="idp7760288"></a><a class="indexterm" name="idp7761376"></a>
<p>
        下面的例子显示了如何使用bit group函数来计算用户每个月访问网页的天数。</p>
<pre class="programlisting">CREATE TABLE t1 (year YEAR(4), month INT(2) UNSIGNED ZEROFILL,
             day INT(2) UNSIGNED ZEROFILL);
INSERT INTO t1 VALUES(2000,1,1),(2000,1,20),(2000,1,30),(2000,2,2),
            (2000,2,23),(2000,2,23);</pre><p>示例表中含有代表用户访问网页的年－月－日值。可以使用以下查询来确定每个月的访问天数：</p>
            <pre class="programlisting">SELECT year,month,BIT_COUNT(BIT_OR(1&lt;&lt;day)) AS days FROM t1
       GROUP BY year,month;</pre>
      <p>
        它返回：</p>
      <pre class="programlisting">+------+-------+------+
| year | month | days |
+------+-------+------+
| 2000 |    01 |    3 |
| 2000 |    02 |    2 |
+------+-------+------+</pre>
      <p>
        这个查询计算表中有多少个每年/月的不同天的组合，并且自动去除重复项。</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="example-auto-increment"></a>3.6.9. 使用<code class="literal">AUTO_INCREMENT</code></h3>

</div>

</div>

</div>
<a class="indexterm" name="idp7770112"></a><a class="indexterm" name="idp7771184"></a><a class="indexterm" name="idp7772256"></a>
<p><code class="literal">AUTO_INCREMENT</code> 属性可以被用来生成每行的唯一标识符： </p>
<pre class="programlisting">CREATE TABLE animals (
     id MEDIUMINT NOT NULL AUTO_INCREMENT,
     name CHAR(30) NOT NULL,
     PRIMARY KEY (id)
);

INSERT INTO animals (name) VALUES
    ('dog'),('cat'),('penguin'),
    ('lax'),('whale'),('ostrich');

SELECT * FROM animals;</pre>
<p>
        它返回：:
      </p>
<pre class="programlisting">+----+---------+
| id | name    |
+----+---------+
|  1 | dog     |
|  2 | cat     |
|  3 | penguin |
|  4 | lax     |
|  5 | whale   |
|  6 | ostrich |
+----+---------+</pre>
<p><code class="literal">AUTO_INCREMENT</code>字段没有指定值，所以MySQL自动分配序列数字。 你可以指定该列值为<code class="literal">NULL</code>或0来生成序列数字</p>
<p>
        你可以使用<a class="link" href="functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a>这个SQL函数或者 <a class="link" href="connectors-apis.html#mysql-insert-id" title="22.8.7.37. mysql_insert_id()"><code class="literal">mysql_insert_id()</code></a>这个C API函数来检索最近的<code class="literal">AUTO_INCREMENT</code>值。这两个函数是会话级的，它们返回值不受其它正在插入操作的连接的影响。 </p>
<p>
        对<code class="literal">AUTO_INCREMENT</code>字段选择使用足够容纳最大序列值的最小整数数据类型。当字段值达到数据类型的最大限制后，尝试生成下一个顺序数字就会出错。可以使用<code class="literal">UNSIGNED</code>属性来获取更大的取值范围。例如，如果你使用<a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">TINYINT</code></a>，它的最大允许值是127。对<a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">TINYINT
        UNSIGNED</code></a>来说，它的最大值是255。 参阅<a class="xref" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT">章节11.2.1, “整型(精确值) - <code class="literal">INTEGER</code>,
        <code class="literal">INT</code>, <code class="literal">SMALLINT</code>,
        <code class="literal">TINYINT</code>, <code class="literal">MEDIUMINT</code>,
        <code class="literal">BIGINT</code>”</a>来获取所有整型的取值范围信息。 </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
注意
</div>
<p xmlns="">
          对多行插入，<a class="link" href="functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a>和<a class="link" href="connectors-apis.html#mysql-insert-id" title="22.8.7.37. mysql_insert_id()"><code class="literal">mysql_insert_id()</code></a>事实上返回第一个插入行的<code class="literal">AUTO_INCREMENT</code>值。这能够保证其他做复制的服务器在重做多行插入时的正确性。</p>
</div>
<p>
        如果<code class="literal">AUTO_INCREMENT</code>字段是复合索引的一部分，MySQL根据该索引的<code class="literal">AUTO_INCREMENT</code> 字段的开始值来生成序列值。例如，如果<code class="literal">animals</code><code class="literal"></code>表包含<code class="literal">PRIMARY KEY (grp, id)</code>和<code class="literal">INDEX
        (id)</code>两个索引，MySQL会忽略<code class="literal">PRIMARY
        KEY</code>来生成序列值。 结果是，这个表只包含一个序列，不会是每个<code class="literal">grp</code>值一个序列。</p>
<p>
        如果想让<code class="literal">AUTO_INCREMENT</code>值不为1，可以使用<a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a>或<a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>语句来修改，如下所示：      </p>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER TABLE tbl AUTO_INCREMENT = 100;</code></strong>
</pre>
<h4><a name="idp7803424"></a>
        InnoDB 注意事项
</h4>
<p>
        对<code class="literal">InnoDB</code>表来说， 在一系列<a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>插入语句当中修改包含自增长值的列要非常小心。<a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"></a> .例如，如果你使用一个<a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>
        语句来对自增长字段输入一个新的更大的值，随后的<a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>可能出现<span class="quote">“<span class="quote">Duplicate entry</span>”</span>错误。. 测试一个自增长值是否已经存在过，你可以在多个<a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>语句之后做个<a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>，或者不在 <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>语句之后<a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>事务。</p>
<h4><a name="idp7811760"></a>
        MyISAM 注意事项
</h4>
<p>对<code class="literal">MyISAM</code> 表来说，你可以指定 <code class="literal">AUTO_INCREMENT</code>在复合索引的第二个字段上。在这种情况下，<code class="literal">AUTO_INCREMENT</code>字段的生成值的规则是<a class="link" href="functions.html#function_max"><code class="literal">MAX(<em class="replaceable"><code>auto_increment_column</code></em>)
        + 1 WHERE
        prefix=<em class="replaceable"><code>given-prefix</code></em></code></a>.。当你想把数据输入成有序的组时是很有用的。</p>
<pre class="programlisting">CREATE TABLE animals (
    grp ENUM('fish','mammal','bird') NOT NULL,
    id MEDIUMINT NOT NULL AUTO_INCREMENT,
    name CHAR(30) NOT NULL,
    PRIMARY KEY (grp,id)
) ENGINE=MyISAM;

INSERT INTO animals (grp,name) VALUES
    ('mammal','dog'),('mammal','cat'),
    ('bird','penguin'),('fish','lax'),('mammal','whale'),
    ('bird','ostrich');

SELECT * FROM animals ORDER BY grp,id;</pre>
<p>
        它返回：</p>
<pre class="programlisting">+--------+----+---------+
| grp    | id | name    |
+--------+----+---------+
| fish   |  1 | lax     |
| mammal |  1 | dog     |
| mammal |  2 | cat     |
| mammal |  3 | whale   |
| bird   |  1 | penguin |
| bird   |  2 | ostrich |
+--------+----+---------+</pre>
      <p>
        在这个情况下 (当<code class="literal">AUTO_INCREMENT</code>字段是复合索引的一部分时)，
        <code class="literal">AUTO_INCREMENT</code> 值会被重用如果你删除了任何分组中的最大的<code class="literal">AUTO_INCREMENT</code>值所在行。 对于<code class="literal">MyISAM</code>表也一样，它的<code class="literal">AUTO_INCREMENT</code> 值一般情况下不会被复用。 </p>
      <h4><a name="idp7823200"></a>其它阅读材料</h4>
<p>
        下面是更多的关于<code class="literal">AUTO_INCREMENT</code>的材料：</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
  <p>
            如何给字段分配<code class="literal">AUTO_INCREMENT</code>属性： <a class="xref" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax">章节 13.1.17, “<code class="literal">CREATE TABLE</code>语法”</a>，和
            <a class="xref" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax">章节 13.1.7, “<code class="literal">ALTER TABLE</code>语法”</a>.
          </p>
</li><li class="listitem">
  <p><code class="literal">AUTO_INCREMENT</code>行为如何取决 <a class="link" href="server-administration.html#sqlmode_no_auto_value_on_zero"><code class="literal">NO_AUTO_VALUE_ON_ZERO</code></a>的SQL模式: <a class="xref" href="server-administration.html#server-sql-mode" title="5.1.7. Server SQL Modes">Section 5.1.7, “服务器SQL模式 ”</a>.          </p>
</li><li class="listitem">
            <p>
            如何使用<a class="link" href="functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a> 函数来找出含有最近<code class="literal">AUTO_INCREMENT</code> 值的行：:<a class="xref" href="functions.html#information-functions" title="12.14. Information Functions">章节 12.14, “信息函数”</a>.          </p>
          </li><li class="listitem">
            <p>
            设置<code class="literal">AUTO_INCREMENT</code>值将被用到：<a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">章节 5.1.4, “服务器系统参数 ”</a>.
          </p>
          </li><li class="listitem">
            <p>
            <code class="literal">AUTO_INCREMENT</code> 和复制：<a class="xref" href="replication.html#replication-features-auto-increment" title="16.4.1.1. Replication and AUTO_INCREMENT">章节 16.4.1.1, “复制和 <code class="literal">AUTO_INCREMENT</code>”</a>.          </p>
          </li><li class="listitem">
            <p>与<code class="literal">AUTO_INCREMENT</code>
            (<a class="link" href="replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a>
            和 <a class="link" href="replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a>)
            相关的用于复制的服务器系统参数：<a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">章节 5.1.4, “服务器系统参数”</a>.</p>
          </li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apache"></a>3.7. 和Apache一起使用MySQL</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp7843152"></a>
<p>还有一些项目，你可以从MySQL数据库鉴别用户，并且你还可以将日志文件写入MySQL数据库表。</p>
<p>
    以把通过下面内容保存到Apache配置文件里，来更改改Apache日志记录格式，让MySQL容易读取：</p>
<pre class="programlisting">LogFormat \
        "\"%h\",%{%Y%m%d%H%M%S}t,%&gt;s,\"%b\",\"%{Content-Type}o\",  \
        \"%U\",\"%{Referer}i\",\"%{User-Agent}i\""</pre>
    <p>
      把日志文件载入到MySQL，你可以使用类似于下面的语句：
    </p>
    <pre class="programlisting">LOAD DATA INFILE '<em class="replaceable"><code>/local/access_log</code></em>' INTO TABLE <em class="replaceable"><code>tbl_name</code></em>
FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"' ESCAPED BY '\\'
</pre>
    <p>所创建的表中的列应与写入日志文件的<code class="literal">LogFormat</code>行锁对应</p>
</div>

</div>
<div class="copyright-footer">
    Copyright © 1997, 2013, Oracle and/or its affiliates. All
    rights reserved.
<a href="preface.html#legalnotice">法律信息</a>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="installing.html">上一章</a></td>
<td width="20%" align="center"><a accesskey="u" href="">页首</a></td>
<td width="40%" align="right"> <a accesskey="n" href="programs.html">下一章</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">第 2 章  安装和升级MySQL</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">首页</a></td>
<td width="40%" align="right" valign="top">第 4 章 MySQL相关程序</td>
</tr>
</table>
</div>
</body>
</html>
